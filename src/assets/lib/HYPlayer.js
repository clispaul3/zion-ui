/*! For license information please see hyplayer.js.LICENSE.txt */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(self,(function(){return(()=>{var e={427:e=>{e.exports=(()=>{"use strict";let e=null,t=!1;const n=window.WebStreamsPolyfill||{},i=window.isSecureContext;let r=/constructor/i.test(window.HTMLElement)||!!window.safari||!!window.WebKitPoint;const s=i||"MozAppearance"in document.documentElement.style?"iframe":"navigate",a={createWriteStream:function(n,l,u){let c={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},h=0,d=null,f=null,p=null;if(Number.isFinite(l)?([u,l]=[l,u],console.warn("[StreamSaver] Depricated pass an object as 2nd argument when creating a write stream"),c.size=u,c.writableStrategy=l):l&&l.highWaterMark?(console.warn("[StreamSaver] Depricated pass an object as 2nd argument when creating a write stream"),c.size=u,c.writableStrategy=l):c=l||{},l.mitm&&(a.mitm=l.mitm),!r){e||(e=i?o(a.mitm):function(e){const t="width=200,height=100",n=document.createDocumentFragment(),i={frame:window.open(e,"popup",t),loaded:!1,isIframe:!1,isPopup:!0,remove(){i.frame.close()},addEventListener(...e){n.addEventListener(...e)},dispatchEvent(...e){n.dispatchEvent(...e)},removeEventListener(...e){n.removeEventListener(...e)},postMessage(...e){i.frame.postMessage(...e)}},r=e=>{e.source===i.frame&&(i.loaded=!0,window.removeEventListener("message",r),i.dispatchEvent(new Event("load")))};return window.addEventListener("message",r),i}(a.mitm)),f=new MessageChannel,n=encodeURIComponent(n.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const r={transferringReadable:t,pathname:c.pathname||Math.random().toString().slice(-6)+"/"+n,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+n}};c.size&&(r.headers["Content-Length"]=c.size);const l=[r,"*",[f.port2]];if(t){const e="iframe"===s?void 0:{transform(e,t){h+=e.length,t.enqueue(e),d&&(location.href=d,d=null)},flush(){d&&(location.href=d)}};p=new a.TransformStream(e,c.writableStrategy,c.readableStrategy);const t=p.readable;f.port1.postMessage({readableStream:t},[t])}f.port1.onmessage=t=>{t.data.download&&("navigate"===s?(e.remove(),e=null,h?location.href=t.data.download:d=t.data.download):(e.isPopup&&(e.remove(),"iframe"===s&&(console.log(a.mitm),o(a.mitm))),o(t.data.download)),c.onDownload&&c.onDownload())},e.loaded?e.postMessage(...l):e.addEventListener("load",(()=>{e.postMessage(...l)}),{once:!0})}let m=[],y=!1,v=!1;return!r&&p&&p.writable||new a.WritableStream({write(e){r?m.push(e):(f.port1.postMessage(e),h+=e.length,d&&(location.href=d,d=null),c.limitSizeCallBack&&h>c.limitSize&&!y&&(y=!0,c.limitSizeCallBack()),c.warnCallBack&&h>c.warnSize&&!v&&(v=!0,c.warnCallBack()))},close(){if(r){const e=new Blob(m,{type:"application/octet-stream; charset=utf-8"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=n,t.click()}else f.port1.postMessage("end")},abort(){m=[],f.port1.postMessage("abort"),f.port1.onmessage=null,f.port1.close(),f.port2.close(),f=null}},c.writableStrategy)},WritableStream:window.WritableStream||n.WritableStream,supported:!0,version:{full:"2.0.0",major:2,minor:0,dot:0},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0"};function o(e){if(!e)throw new Error("meh");const t=document.createElement("iframe");return t.hidden=!0,t.src=e,t.loaded=!1,t.name="iframe",t.isIframe=!0,t.postMessage=(...e)=>t.contentWindow.postMessage(...e),t.addEventListener("load",(()=>{t.loaded=!0}),{once:!0}),document.body.appendChild(t),t}try{new Response(new ReadableStream),i&&!("serviceWorker"in navigator)&&(r=!0)}catch(e){r=!0}return(e=>{try{e()}catch(e){}})((()=>{const{readable:e}=new TransformStream,n=new MessageChannel;n.port1.postMessage(e,[e]),n.port1.close(),n.port2.close(),t=!0,Object.defineProperty(a,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})})),a})()},913:(e,t,n)=>{(t=n(476)(!1)).push([e.id,'.hyplayer-container{position:relative;display:flex;justify-content:center;align-items:center;box-sizing:border-box;overflow:hidden}.hyplayer-container *{box-sizing:border-box}.hyplayer-container .hyplayer-icon{display:inline-flex;justify-content:center;align-items:center;line-height:1.5;cursor:pointer}.hyplayer-container .hyplayer-icon svg{fill:#fff}.hyplayer-container .hyplayer-controls svg{fill:#fff;cursor:pointer}.hyplayer-container .hyplayer_screenshot{display:flex;width:40px}.hyplayer-container .hyplayer_hasAudio{display:flex;width:40px}.hyplayer-container .hyplayer_hasAudio svg{fill:#fff;cursor:pointer}.hyplayer-container .hyplayer-player{position:relative;display:flex;justify-content:center;align-items:center;width:100%;height:100%}.hyplayer-container .hyplayer-player .hyplayer-canvas{cursor:pointer;width:100%;height:100%;background-color:#000}.hyplayer-container .hyplayer-player .hyplayer-poster{position:absolute;z-index:10;left:0;top:0;right:0;bottom:0;height:100%;width:100%;background-position:center center;background-repeat:no-repeat;background-size:contain;pointer-events:none}.hyplayer-container .hyplayer-player .hyplayer-loading{display:none;justify-content:center;align-items:center;position:absolute;z-index:20;left:0;top:0;right:0;bottom:0;width:100%;height:100%;pointer-events:none}.hyplayer-container .hyplayer-player .hyplayer-error{display:none;justify-content:center;align-items:center;text-align:center;position:absolute;z-index:30;left:0;top:0;right:0;bottom:0;width:100%;height:100%;color:#fff;pointer-events:none}.hyplayer-container .hyplayer-player .hyplayer-controls{display:flex;flex-direction:column;justify-content:flex-end;position:absolute;z-index:40;left:0;right:0;bottom:0;height:100px;padding:50px 10px 10px;font-size:14px;color:#fff;opacity:0;visibility:hidden;transition:all 0.2s ease-in-out;user-select:none;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAADGCAYAAAAT+OqFAAAAdklEQVQoz42QQQ7AIAgEF/T/D+kbq/RWAlnQyyazA4aoAB4FsBSA/bFjuF1EOL7VbrIrBuusmrt4ZZORfb6ehbWdnRHEIiITaEUKa5EJqUakRSaEYBJSCY2dEstQY7AuxahwXFrvZmWl2rh4JZ07z9dLtesfNj5q0FU3A5ObbwAAAABJRU5ErkJggg==) repeat-x bottom}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-item{display:flex;justify-content:center;padding:0 7px}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-progress{position:relative;height:3px;border-radius:3px;background:rgba(255,255,255,0.25)}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-progress .hyplayer-loaded{cursor:pointer;position:absolute;left:0;top:0;bottom:0;width:0;height:100%;border-radius:3px;background:rgba(255,255,255,0.5)}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-progress .hyplayer-played{cursor:pointer;position:absolute;left:0;top:0;bottom:0;width:0;height:100%;border-radius:3px;background:#fff}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-progress .hyplayer-played .hyplayer-indicator{position:absolute;top:50%;right:0;width:12px;height:12px;margin:-6px -6px 0 0;border-radius:50%;background:#fff}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-bottom{display:flex;justify-content:space-between;height:22px;margin-top:15px}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-bottom .hyplayer-controls-left{display:flex;align-items:center}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-bottom .hyplayer-controls-left .hyplayer-state{height:100%}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-bottom .hyplayer-controls-left .hyplayer-state .hyplayer-pause{display:none}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-bottom .hyplayer-controls-left .hyplayer-volume{display:flex;height:100%}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-bottom .hyplayer-controls-left .hyplayer-volume .hyplayer-volume-off{display:none}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-bottom .hyplayer-controls-left .hyplayer-volume .hyplayer-volume-panel{position:relative;width:0;height:100%;transition:margin 0.2s cubic-bezier(0.4, 0, 1, 1),width 0.2s cubic-bezier(0.4, 0, 1, 1);overflow:hidden}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-bottom .hyplayer-controls-left .hyplayer-volume .hyplayer-volume-panel .hyplayer-volume-panel-handle{position:absolute;top:50%;left:0;width:12px;height:12px;border-radius:12px;margin-top:-6px;background:#fff}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-bottom .hyplayer-controls-left .hyplayer-volume .hyplayer-volume-panel .hyplayer-volume-panel-handle::before{left:-54px;background:#fff}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-bottom .hyplayer-controls-left .hyplayer-volume .hyplayer-volume-panel .hyplayer-volume-panel-handle::after{left:6px;background:rgba(255,255,255,0.2)}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-bottom .hyplayer-controls-left .hyplayer-volume .hyplayer-volume-panel .hyplayer-volume-panel-handle::before,.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-bottom .hyplayer-controls-left .hyplayer-volume .hyplayer-volume-panel .hyplayer-volume-panel-handle::after{content:"";position:absolute;display:block;top:50%;height:3px;margin-top:-2px;width:60px}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-bottom .hyplayer-controls-left .hyplayer-volume:hover .hyplayer-volume-panel{width:60px;margin-left:5px}.hyplayer-container .hyplayer-player .hyplayer-controls .hyplayer-controls-bottom .hyplayer-controls-right{display:flex;align-items:center}.hyplayer-container .hyplayer-player.hyplayer-loading-show .hyplayer-loading{display:flex}.hyplayer-container .hyplayer-player.hyplayer-error-show .hyplayer-error{display:flex}.hyplayer-container .hyplayer-player.hyplayer-controls-show .hyplayer-controls{opacity:1;visibility:visible}.hyplayer-container .hyplayer-player.hyplayer-controls-hide .hyplayer-controls{opacity:0;visibility:hidden}.hyplayer-container .hyplayer-player.hyplayer-hide-cursor *{cursor:none !important}.hyplayer-container.hyplayer-fullscreen-web{position:fixed;z-index:9999;left:0;top:0;right:0;bottom:0;width:100% !important;height:100% !important;background:#000}\n',""]),e.exports=t},476:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n,i,r,s=e[1]||"",a=e[3];if(!a)return s;if(t&&"function"==typeof btoa){var o=(n=a,i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),"/*# ".concat(r," */")),l=a.sources.map((function(e){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(e," */")}));return[s].concat(l).concat([o]).join("\n")}return[s].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,i){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(i)for(var s=0;s<this.length;s++){var a=this[s][0];null!=a&&(r[a]=!0)}for(var o=0;o<e.length;o++){var l=[].concat(e[o]);i&&r[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},693:function(e){e.exports=function(){"use strict";var e="millisecond",t="second",n="minute",i="hour",r="day",s="week",a="month",o="quarter",l="year",u="date",c=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[^0-9]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,d={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},f=function(e,t,n){var i=String(e);return!i||i.length>=t?e:""+Array(t+1-i.length).join(n)+e},p={s:f,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),i=Math.floor(n/60),r=n%60;return(t<=0?"+":"-")+f(i,2,"0")+":"+f(r,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var i=12*(n.year()-t.year())+(n.month()-t.month()),r=t.clone().add(i,a),s=n-r<0,o=t.clone().add(i+(s?-1:1),a);return+(-(i+(n-r)/(s?r-o:o-r))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(c){return{M:a,y:l,w:s,d:r,D:u,h:i,m:n,s:t,ms:e,Q:o}[c]||String(c||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},m="en",y={};y[m]=d;var v=function(e){return e instanceof w},_=function(e,t,n){var i;if(!e)return m;if("string"==typeof e)y[e]&&(i=e),t&&(y[e]=t,i=e);else{var r=e.name;y[r]=e,i=r}return!n&&i&&(m=i),i||!n&&m},g=function(e,t){if(v(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new w(n)},b=p;b.l=_,b.i=v,b.w=function(e,t){return g(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var w=function(){function d(e){this.$L=_(e.locale,null,!0),this.parse(e)}var f=d.prototype;return f.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(b.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var i=t.match(c);if(i){var r=i[2]-1||0,s=(i[7]||"0").substring(0,3);return n?new Date(Date.UTC(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,s)):new Date(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,s)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},f.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},f.$utils=function(){return b},f.isValid=function(){return!("Invalid Date"===this.$d.toString())},f.isSame=function(e,t){var n=g(e);return this.startOf(t)<=n&&n<=this.endOf(t)},f.isAfter=function(e,t){return g(e)<this.startOf(t)},f.isBefore=function(e,t){return this.endOf(t)<g(e)},f.$g=function(e,t,n){return b.u(e)?this[t]:this.set(n,e)},f.unix=function(){return Math.floor(this.valueOf()/1e3)},f.valueOf=function(){return this.$d.getTime()},f.startOf=function(e,o){var c=this,h=!!b.u(o)||o,d=b.p(e),f=function(e,t){var n=b.w(c.$u?Date.UTC(c.$y,t,e):new Date(c.$y,t,e),c);return h?n:n.endOf(r)},p=function(e,t){return b.w(c.toDate()[e].apply(c.toDate("s"),(h?[0,0,0,0]:[23,59,59,999]).slice(t)),c)},m=this.$W,y=this.$M,v=this.$D,_="set"+(this.$u?"UTC":"");switch(d){case l:return h?f(1,0):f(31,11);case a:return h?f(1,y):f(0,y+1);case s:var g=this.$locale().weekStart||0,w=(m<g?m+7:m)-g;return f(h?v-w:v+(6-w),y);case r:case u:return p(_+"Hours",0);case i:return p(_+"Minutes",1);case n:return p(_+"Seconds",2);case t:return p(_+"Milliseconds",3);default:return this.clone()}},f.endOf=function(e){return this.startOf(e,!1)},f.$set=function(s,o){var c,h=b.p(s),d="set"+(this.$u?"UTC":""),f=(c={},c[r]=d+"Date",c[u]=d+"Date",c[a]=d+"Month",c[l]=d+"FullYear",c[i]=d+"Hours",c[n]=d+"Minutes",c[t]=d+"Seconds",c[e]=d+"Milliseconds",c)[h],p=h===r?this.$D+(o-this.$W):o;if(h===a||h===l){var m=this.clone().set(u,1);m.$d[f](p),m.init(),this.$d=m.set(u,Math.min(this.$D,m.daysInMonth())).$d}else f&&this.$d[f](p);return this.init(),this},f.set=function(e,t){return this.clone().$set(e,t)},f.get=function(e){return this[b.p(e)]()},f.add=function(e,o){var u,c=this;e=Number(e);var h=b.p(o),d=function(t){var n=g(c);return b.w(n.date(n.date()+Math.round(t*e)),c)};if(h===a)return this.set(a,this.$M+e);if(h===l)return this.set(l,this.$y+e);if(h===r)return d(1);if(h===s)return d(7);var f=(u={},u[n]=6e4,u[i]=36e5,u[t]=1e3,u)[h]||1,p=this.$d.getTime()+e*f;return b.w(p,this)},f.subtract=function(e,t){return this.add(-1*e,t)},f.format=function(e){var t=this;if(!this.isValid())return"Invalid Date";var n=e||"YYYY-MM-DDTHH:mm:ssZ",i=b.z(this),r=this.$locale(),s=this.$H,a=this.$m,o=this.$M,l=r.weekdays,u=r.months,c=function(e,i,r,s){return e&&(e[i]||e(t,n))||r[i].substr(0,s)},d=function(e){return b.s(s%12||12,e,"0")},f=r.meridiem||function(e,t,n){var i=e<12?"AM":"PM";return n?i.toLowerCase():i},p={YY:String(this.$y).slice(-2),YYYY:this.$y,M:o+1,MM:b.s(o+1,2,"0"),MMM:c(r.monthsShort,o,u,3),MMMM:c(u,o),D:this.$D,DD:b.s(this.$D,2,"0"),d:String(this.$W),dd:c(r.weekdaysMin,this.$W,l,2),ddd:c(r.weekdaysShort,this.$W,l,3),dddd:l[this.$W],H:String(s),HH:b.s(s,2,"0"),h:d(1),hh:d(2),a:f(s,a,!0),A:f(s,a,!1),m:String(a),mm:b.s(a,2,"0"),s:String(this.$s),ss:b.s(this.$s,2,"0"),SSS:b.s(this.$ms,3,"0"),Z:i};return n.replace(h,(function(e,t){return t||p[e]||i.replace(":","")}))},f.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},f.diff=function(e,u,c){var h,d=b.p(u),f=g(e),p=6e4*(f.utcOffset()-this.utcOffset()),m=this-f,y=b.m(this,f);return y=(h={},h[l]=y/12,h[a]=y,h[o]=y/3,h[s]=(m-p)/6048e5,h[r]=(m-p)/864e5,h[i]=m/36e5,h[n]=m/6e4,h[t]=m/1e3,h)[d]||m,c?y:b.a(y)},f.daysInMonth=function(){return this.endOf(a).$D},f.$locale=function(){return y[this.$L]},f.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),i=_(e,t,!0);return i&&(n.$L=i),n},f.clone=function(){return b.w(this.$d,this)},f.toDate=function(){return new Date(this.valueOf())},f.toJSON=function(){return this.isValid()?this.toISOString():null},f.toISOString=function(){return this.$d.toISOString()},f.toString=function(){return this.$d.toUTCString()},d}(),k=w.prototype;return g.prototype=k,[["$ms",e],["$s",t],["$m",n],["$H",i],["$W",r],["$M",a],["$y",l],["$D",u]].forEach((function(e){k[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),g.extend=function(e,t){return e.$i||(e(t,w,g),e.$i=!0),g},g.locale=_,g.isDayjs=v,g.unix=function(e){return g(1e3*e)},g.en=y[m],g.Ls=y,g.p={},g}()},641:function(e,t,n){e.exports=function(){"use strict";function e(e){return"function"==typeof e}var t=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},i=0,r=void 0,s=void 0,a=function(e,t){f[i]=e,f[i+1]=t,2===(i+=2)&&(s?s(p):g())};var o="undefined"!=typeof window?window:void 0,l=o||{},u=l.MutationObserver||l.WebKitMutationObserver,c="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),h="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function d(){var e=setTimeout;return function(){return e(p,1)}}var f=new Array(1e3);function p(){for(var e=0;e<i;e+=2)(0,f[e])(f[e+1]),f[e]=void 0,f[e+1]=void 0;i=0}var m,y,v,_,g=void 0;function b(e,t){var n=this,i=new this.constructor(S);void 0===i[k]&&P(i);var r=n._state;if(r){var s=arguments[r-1];a((function(){return O(r,i,s,n._result)}))}else R(n,i,e,t);return i}function w(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(S);return L(t,e),t}g=c?function(){return process.nextTick(p)}:u?(y=0,v=new u(p),_=document.createTextNode(""),v.observe(_,{characterData:!0}),function(){_.data=y=++y%2}):h?((m=new MessageChannel).port1.onmessage=p,function(){return m.port2.postMessage(0)}):void 0===o?function(){try{var e=Function("return this")().require("vertx");return void 0!==(r=e.runOnLoop||e.runOnContext)?function(){r(p)}:d()}catch(e){return d()}}():d();var k=Math.random().toString(36).substring(2);function S(){}var E=void 0;function A(t,n,i){n.constructor===t.constructor&&i===b&&n.constructor.resolve===w?function(e,t){1===t._state?T(e,t._result):2===t._state?x(e,t._result):R(t,void 0,(function(t){return L(e,t)}),(function(t){return x(e,t)}))}(t,n):void 0===i?T(t,n):e(i)?function(e,t,n){a((function(e){var i=!1,r=function(e,t,n,i){try{e.call(t,n,i)}catch(e){return e}}(n,t,(function(n){i||(i=!0,t!==n?L(e,n):T(e,n))}),(function(t){i||(i=!0,x(e,t))}),e._label);!i&&r&&(i=!0,x(e,r))}),e)}(t,n,i):T(t,n)}function L(e,t){if(e===t)x(e,new TypeError("You cannot resolve a promise with itself"));else if(r=typeof(i=t),null===i||"object"!==r&&"function"!==r)T(e,t);else{var n=void 0;try{n=t.then}catch(t){return void x(e,t)}A(e,t,n)}var i,r}function C(e){e._onerror&&e._onerror(e._result),D(e)}function T(e,t){e._state===E&&(e._result=t,e._state=1,0!==e._subscribers.length&&a(D,e))}function x(e,t){e._state===E&&(e._state=2,e._result=t,a(C,e))}function R(e,t,n,i){var r=e._subscribers,s=r.length;e._onerror=null,r[s]=t,r[s+1]=n,r[s+2]=i,0===s&&e._state&&a(D,e)}function D(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,r=void 0,s=e._result,a=0;a<t.length;a+=3)i=t[a],r=t[a+n],i?O(n,i,r,s):r(s);e._subscribers.length=0}}function O(t,n,i,r){var s=e(i),a=void 0,o=void 0,l=!0;if(s){try{a=i(r)}catch(e){l=!1,o=e}if(n===a)return void x(n,new TypeError("A promises callback cannot return that same promise."))}else a=r;n._state!==E||(s&&l?L(n,a):!1===l?x(n,o):1===t?T(n,a):2===t&&x(n,a))}var M=0;function P(e){e[k]=M++,e._state=void 0,e._result=void 0,e._subscribers=[]}var B=function(){function e(e,n){this._instanceConstructor=e,this.promise=new e(S),this.promise[k]||P(this.promise),t(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?T(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&T(this.promise,this._result))):x(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===E&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===w){var r=void 0,s=void 0,a=!1;try{r=e.then}catch(e){a=!0,s=e}if(r===b&&e._state!==E)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===I){var o=new n(S);a?x(o,s):A(o,e,r),this._willSettleAt(o,t)}else this._willSettleAt(new n((function(t){return t(e)})),t)}else this._willSettleAt(i(e),t)},e.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===E&&(this._remaining--,2===e?x(i,n):this._result[t]=n),0===this._remaining&&T(i,this._result)},e.prototype._willSettleAt=function(e,t){var n=this;R(e,void 0,(function(e){return n._settledAt(1,t,e)}),(function(e){return n._settledAt(2,t,e)}))},e}();var I=function(){function t(e){this[k]=M++,this._result=this._state=void 0,this._subscribers=[],S!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t((function(t){L(e,t)}),(function(t){x(e,t)}))}catch(t){x(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var n=this,i=n.constructor;return e(t)?n.then((function(e){return i.resolve(t()).then((function(){return e}))}),(function(e){return i.resolve(t()).then((function(){throw e}))})):n.then(t,t)},t}();return I.prototype.then=b,I.all=function(e){return new B(this,e).promise},I.race=function(e){var n=this;return t(e)?new n((function(t,i){for(var r=e.length,s=0;s<r;s++)n.resolve(e[s]).then(t,i)})):new n((function(e,t){return t(new TypeError("You must pass an array to race."))}))},I.resolve=w,I.reject=function(e){var t=new this(S);return x(t,e),t},I._setScheduler=function(e){s=e},I._setAsap=function(e){a=e},I._asap=a,I.polyfill=function(){var e=void 0;if(void 0!==n.g)e=n.g;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var i=null;try{i=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===i&&!t.cast)return}e.Promise=I},I.Promise=I,I}()},343:e=>{"use strict";var t,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,s),i(n)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}m(e,t,s,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,r)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function u(e,t,n,i){var r,s,a,u;if(o(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),a=s[t]),void 0===a)a=s[t]=n,++e._eventsCount;else if("function"==typeof a?a=s[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),(r=l(e))>0&&a.length>r&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,u=c,console&&console.warn&&console.warn(u)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=c.bind(i);return r.listener=n,i.wrapFn=r,r}function d(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):p(r,r.length)}function f(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function m(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(s){i.once&&e.removeEventListener(t,r),n(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,s=this._events;if(void 0!==s)r=r&&void 0===s.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var l=s[e];if(void 0===l)return!1;if("function"==typeof l)i(l,this,t);else{var u=l.length,c=p(l,u);for(n=0;n<u;++n)i(c[n],this,t)}return!0},s.prototype.addListener=function(e,t){return u(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return u(this,e,t,!0)},s.prototype.once=function(e,t){return o(t),this.on(e,h(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,h(this,e,t)),this},s.prototype.removeListener=function(e,t){var n,i,r,s,a;if(o(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){a=n[s].listener,r=s;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,s=Object.keys(n);for(i=0;i<s.length;++i)"removeListener"!==(r=s[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},s.prototype.listeners=function(e){return d(this,e,!0)},s.prototype.rawListeners=function(e){return d(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},s.prototype.listenerCount=f,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},828:function(e){e.exports=function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}var t=Object.prototype.toString,n=function(n){if(void 0===n)return"undefined";if(null===n)return"null";var r=e(n);if("boolean"===r)return"boolean";if("string"===r)return"string";if("number"===r)return"number";if("symbol"===r)return"symbol";if("function"===r)return function(e){return"GeneratorFunction"===i(e)}(n)?"generatorfunction":"function";if(function(e){return Array.isArray?Array.isArray(e):e instanceof Array}(n))return"array";if(function(e){return!(!e.constructor||"function"!=typeof e.constructor.isBuffer)&&e.constructor.isBuffer(e)}(n))return"buffer";if(function(e){try{if("number"==typeof e.length&&"function"==typeof e.callee)return!0}catch(e){if(-1!==e.message.indexOf("callee"))return!0}return!1}(n))return"arguments";if(function(e){return e instanceof Date||"function"==typeof e.toDateString&&"function"==typeof e.getDate&&"function"==typeof e.setDate}(n))return"date";if(function(e){return e instanceof Error||"string"==typeof e.message&&e.constructor&&"number"==typeof e.constructor.stackTraceLimit}(n))return"error";if(function(e){return e instanceof RegExp||"string"==typeof e.flags&&"boolean"==typeof e.ignoreCase&&"boolean"==typeof e.multiline&&"boolean"==typeof e.global}(n))return"regexp";switch(i(n)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(e){return"function"==typeof e.throw&&"function"==typeof e.return&&"function"==typeof e.next}(n))return"generator";switch(r=t.call(n)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return r.slice(8,-1).toLowerCase().replace(/\s/g,"")};function i(e){return e.constructor?e.constructor.name:null}function r(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:["option"];return s(e,t,i),a(e,t,i),function(e,t,i){var o=n(t),l=n(e);if("object"===o){if("object"!==l)throw new Error("[Type Error]: '".concat(i.join("."),"' require 'object' type, but got '").concat(l,"'"));Object.keys(t).forEach((function(n){var o=e[n],l=t[n],u=i.slice();u.push(n),s(o,l,u),a(o,l,u),r(o,l,u)}))}if("array"===o){if("array"!==l)throw new Error("[Type Error]: '".concat(i.join("."),"' require 'array' type, but got '").concat(l,"'"));e.forEach((function(n,o){var l=e[o],u=t[o]||t[0],c=i.slice();c.push(o),s(l,u,c),a(l,u,c),r(l,u,c)}))}}(e,t,i),e}function s(e,t,i){if("string"===n(t)){var r=n(e);if(!(-1<t.indexOf("|")?t.split("|").map((function(e){return e.toLowerCase().trim()})).filter(Boolean).some((function(e){return r===e})):t.toLowerCase().trim()===r))throw new Error("[Type Error]: '".concat(i.join("."),"' require '").concat(t,"' type, but got '").concat(r,"'"))}}function a(e,t,i){if("function"===n(t)){var r=t(e,n(e),i);if(!0!==r){var s=n(r);throw"string"===s?new Error(r):"error"===s?r:new Error("[Validator Error]: The scheme for '".concat(i.join("."),"' validator require return true, but got '").concat(r,"'"))}}}return r.kindOf=n,r}()},754:e=>{!function(){"use strict";var t="undefined"!=typeof window&&void 0!==window.document?window.document:{},n=e.exports,i=function(){for(var e,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],i=0,r=n.length,s={};i<r;i++)if((e=n[i])&&e[1]in t){for(i=0;i<e.length;i++)s[n[0][i]]=e[i];return s}return!1}(),r={change:i.fullscreenchange,error:i.fullscreenerror},s={request:function(e){return new Promise(function(n,r){var s=function(){this.off("change",s),n()}.bind(this);this.on("change",s);var a=(e=e||t.documentElement)[i.requestFullscreen]();a instanceof Promise&&a.then(s).catch(r)}.bind(this))},exit:function(){return new Promise(function(e,n){if(this.isFullscreen){var r=function(){this.off("change",r),e()}.bind(this);this.on("change",r);var s=t[i.exitFullscreen]();s instanceof Promise&&s.then(r).catch(n)}else e()}.bind(this))},toggle:function(e){return this.isFullscreen?this.exit():this.request(e)},onchange:function(e){this.on("change",e)},onerror:function(e){this.on("error",e)},on:function(e,n){var i=r[e];i&&t.addEventListener(i,n,!1)},off:function(e,n){var i=r[e];i&&t.removeEventListener(i,n,!1)},raw:i};i?(Object.defineProperties(s,{isFullscreen:{get:function(){return Boolean(t[i.fullscreenElement])}},element:{enumerable:!0,get:function(){return t[i.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(t[i.fullscreenEnabled])}}}),n?e.exports=s:window.screenfull=s):n?e.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}()},421:(e,t,n)=>{var i=n(892),r=n(913);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.id,r,""]]);var s=(i(r,{insert:"head",singleton:!1}),r.locals?r.locals:{});e.exports=s},892:(e,t,n)=>{"use strict";var i,r=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),s=[];function a(e){for(var t=-1,n=0;n<s.length;n++)if(s[n].identifier===e){t=n;break}return t}function o(e,t){for(var n={},i=[],r=0;r<e.length;r++){var o=e[r],l=t.base?o[0]+t.base:o[0],u=n[l]||0,c="".concat(l," ").concat(u);n[l]=u+1;var h=a(c),d={css:o[1],media:o[2],sourceMap:o[3]};-1!==h?(s[h].references++,s[h].updater(d)):s.push({identifier:c,updater:m(d,t),references:1}),i.push(c)}return i}function l(e){var t=document.createElement("style"),i=e.attributes||{};if(void 0===i.nonce){var s=n.nc;s&&(i.nonce=s)}if(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),"function"==typeof e.insert)e.insert(t);else{var a=r(e.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}return t}var u,c=(u=[],function(e,t){return u[e]=t,u.filter(Boolean).join("\n")});function h(e,t,n,i){var r=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(e.styleSheet)e.styleSheet.cssText=c(t,r);else{var s=document.createTextNode(r),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(s,a[t]):e.appendChild(s)}}function d(e,t,n){var i=n.css,r=n.media,s=n.sourceMap;if(r?e.setAttribute("media",r):e.removeAttribute("media"),s&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var f=null,p=0;function m(e,t){var n,i,r;if(t.singleton){var s=p++;n=f||(f=l(t)),i=h.bind(null,n,s,!1),r=h.bind(null,n,s,!0)}else n=l(t),i=d.bind(null,n,t),r=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else r()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i));var n=o(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var i=0;i<n.length;i++){var r=a(n[i]);s[r].references--}for(var l=o(e,t),u=0;u<n.length;u++){var c=a(n[u]);0===s[c].references&&(s[c].updater(),s.splice(c,1))}n=l}}}},27:e=>{e.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='36' width='36' viewBox='0 0 36 36'%3E %3Cpath d='m 10,16 2,0 0,-4 4,0 0,-2 L 10,10 l 0,6 0,0 z'%3E%3C/path%3E %3Cpath d='m 20,10 0,2 4,0 0,4 2,0 L 26,10 l -6,0 0,0 z'%3E%3C/path%3E %3Cpath d='m 24,24 -4,0 0,2 L 26,26 l 0,-6 -2,0 0,4 0,0 z'%3E%3C/path%3E %3Cpath d='M 12,20 10,20 10,26 l 6,0 0,-2 -4,0 0,-4 0,0 z'%3E%3C/path%3E %3C/svg%3E"},971:e=>{e.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='50px' height='50px' viewBox='0 0 100 100' preserveAspectRatio='xMidYMid' class='uil-default'%3E %3Crect x='0' y='0' width='100' height='100' fill='none' class='bk'/%3E %3Crect x='47' y='40' width='6' height='20' rx='5' ry='5' fill='%23ffffff' transform='rotate(0 50 50) translate(0 -30)'%3E %3Canimate attributeName='opacity' from='1' to='0' dur='1s' begin='-1s' repeatCount='indefinite'/%3E %3C/rect%3E %3Crect x='47' y='40' width='6' height='20' rx='5' ry='5' fill='%23ffffff' transform='rotate(30 50 50) translate(0 -30)'%3E %3Canimate attributeName='opacity' from='1' to='0' dur='1s' begin='-0.9166666666666666s' repeatCount='indefinite'/%3E %3C/rect%3E %3Crect x='47' y='40' width='6' height='20' rx='5' ry='5' fill='%23ffffff' transform='rotate(60 50 50) translate(0 -30)'%3E %3Canimate attributeName='opacity' from='1' to='0' dur='1s' begin='-0.8333333333333334s' repeatCount='indefinite'/%3E %3C/rect%3E %3Crect x='47' y='40' width='6' height='20' rx='5' ry='5' fill='%23ffffff' transform='rotate(90 50 50) translate(0 -30)'%3E %3Canimate attributeName='opacity' from='1' to='0' dur='1s' begin='-0.75s' repeatCount='indefinite'/%3E%3C/rect%3E %3Crect x='47' y='40' width='6' height='20' rx='5' ry='5' fill='%23ffffff' transform='rotate(120 50 50) translate(0 -30)'%3E %3Canimate attributeName='opacity' from='1' to='0' dur='1s' begin='-0.6666666666666666s' repeatCount='indefinite'/%3E %3C/rect%3E %3Crect x='47' y='40' width='6' height='20' rx='5' ry='5' fill='%23ffffff' transform='rotate(150 50 50) translate(0 -30)'%3E %3Canimate attributeName='opacity' from='1' to='0' dur='1s' begin='-0.5833333333333334s' repeatCount='indefinite'/%3E %3C/rect%3E %3Crect x='47' y='40' width='6' height='20' rx='5' ry='5' fill='%23ffffff' transform='rotate(180 50 50) translate(0 -30)'%3E %3Canimate attributeName='opacity' from='1' to='0' dur='1s' begin='-0.5s' repeatCount='indefinite'/%3E%3C/rect%3E %3Crect x='47' y='40' width='6' height='20' rx='5' ry='5' fill='%23ffffff' transform='rotate(210 50 50) translate(0 -30)'%3E %3Canimate attributeName='opacity' from='1' to='0' dur='1s' begin='-0.4166666666666667s' repeatCount='indefinite'/%3E %3C/rect%3E %3Crect x='47' y='40' width='6' height='20' rx='5' ry='5' fill='%23ffffff' transform='rotate(240 50 50) translate(0 -30)'%3E %3Canimate attributeName='opacity' from='1' to='0' dur='1s' begin='-0.3333333333333333s' repeatCount='indefinite'/%3E %3C/rect%3E %3Crect x='47' y='40' width='6' height='20' rx='5' ry='5' fill='%23ffffff' transform='rotate(270 50 50) translate(0 -30)'%3E %3Canimate attributeName='opacity' from='1' to='0' dur='1s' begin='-0.25s' repeatCount='indefinite'/%3E%3C/rect%3E %3Crect x='47' y='40' width='6' height='20' rx='5' ry='5' fill='%23ffffff' transform='rotate(300 50 50) translate(0 -30)'%3E %3Canimate attributeName='opacity' from='1' to='0' dur='1s' begin='-0.16666666666666666s' repeatCount='indefinite'/%3E %3C/rect%3E %3Crect x='47' y='40' width='6' height='20' rx='5' ry='5' fill='%23ffffff' transform='rotate(330 50 50) translate(0 -30)'%3E %3Canimate attributeName='opacity' from='1' to='0' dur='1s' begin='-0.08333333333333333s' repeatCount='indefinite'/%3E %3C/rect%3E %3C/svg%3E"},757:e=>{e.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='22' width='22' viewBox='0 0 22 22'%3E %3Cpath d='M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zM15 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z'%3E%3C/path%3E %3C/svg%3E"},878:e=>{e.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='22' width='22' viewBox='0 0 22 22'%3E %3Cpath d='M17.982 9.275L8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z'%3E%3C/path%3E %3C/svg%3E"},879:e=>{e.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='22' width='22' viewBox='0 0 22 22'%3E %3Cpath d='M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z'%3E%3C/path%3E %3Cpath d='M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zM18.778 18.778l-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z'%3E%3C/path%3E %3C/svg%3E"},164:e=>{e.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='22' width='22' viewBox='0 0 22 22'%3E %3Cpath d='M10.188 4.65L6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zM14.446 3.778a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z'%3E%3C/path%3E %3Cpath d='M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z'%3E%3C/path%3E %3C/svg%3E"},396:e=>{var t=arguments[3],n=arguments[4],i=arguments[5],r=JSON.stringify;e.exports=function(e,s){for(var a,o=Object.keys(i),l=0,u=o.length;l<u;l++){var c=o[l],h=i[c].exports;if(h===e||h&&h.default===e){a=c;break}}if(!a){a=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var d={};for(l=0,u=o.length;l<u;l++)d[c=o[l]]=c;n[a]=["function(require,module,exports){"+e+"(self); }",d]}var f=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[a]=a,n[f]=["function(require,module,exports){var f = require("+r(a)+");(f.default ? f.default : f)(self);}",p];var m={};!function e(t){for(var i in m[t]=!0,n[t][1]){var r=n[t][1][i];m[r]||e(r)}}(f);var y="("+t+")({"+Object.keys(m).map((function(e){return r(e)+":["+n[e][0]+","+r(n[e][1])+"]"})).join(",")+"},{},["+r(f)+"])",v=window.URL||window.webkitURL||window.mozURL||window.msURL,_=new Blob([y],{type:"text/javascript"});if(s&&s.bare)return _;var g=v.createObjectURL(_),b=new Worker(g);return b.objectURL=g,b}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={id:i,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";n.r(i),n.d(i,{HYPlayer:()=>en,Recorder:()=>T});var e={};function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.r(e),n.d(e,{calculationRate:()=>E,checkIsIos:()=>C,clamp:()=>g,createWorker:()=>p,debounce:()=>v,eventPath:()=>A,getNowTime:()=>y,getStyle:()=>w,hasOwnProperty:()=>h,isMobile:()=>u,isWechat:()=>c,loadScript:()=>k,mergeBuffer:()=>f,proxyPropertys:()=>S,readBuffer:()=>d,secondToTime:()=>m,setCanvas:()=>L,setStyle:()=>b,throttle:()=>_});var a=n(427),o=n.n(a);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function c(){return/MicroMessenger/i.test(navigator.userAgent)}function h(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function d(e){var t=0;function n(i){for(var r=new Uint8Array(i),s=0;s<i;s+=1)r[s]=e[t],t+=1;return n.index=t,r}return n.index=0,n}function f(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0].constructor;return t.reduce((function(e,t){var n=new i((0|e.byteLength)+(0|t.byteLength));return n.set(e,0),n.set(t,0|e.byteLength),n}),new i)}function p(e){return new Worker(URL.createObjectURL(new Blob([e],{type:"application/javascript"})))}function m(e){var t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60),i=Math.floor(e-3600*t-60*n);return(t>0?[t,n,i]:[n,i]).map((function(e){return e<10?"0".concat(e):String(e)})).join(":")}function y(){return performance&&"function"==typeof performance.now?performance.now():Date.now()}function v(e,t,n){var i;function r(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];var o=function(){i=null,e.apply(n,s)};clearTimeout(i),i=setTimeout(o,t)}return r.clearTimeout=function(){clearTimeout(i)},r}function _(e,t){var n,i,r=!1;return function s(){for(var a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];if(r)return n=o,void(i=this);r=!0,e.apply(this,o),setTimeout((function(){r=!1,n&&(s.apply(i,n),n=null,i=null)}),t)}}function g(e,t,n){return Math.max(Math.min(e,Math.max(t,n)),Math.min(t,n))}function b(e,t,n){return"object"===l(t)&&Object.keys(t).forEach((function(n){b(e,n,t[n])})),e.style[t]=n,e}function w(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=getComputedStyle(e,null).getPropertyValue(t);return n?parseFloat(i):i}function k(e,t){return new Promise((function(n,i){var r=document.createElement("script");r.type="text/javascript",r.onload=function(){window[t]?n(window[t]):i(new Error("Unable to find global variable '".concat(t,"' from '").concat(e,"'")))},r.onerror=function(){i(new Error("Resource loading failed '".concat(e,"'")))},r.src=e,document.head.appendChild(r)}))}function S(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return n.reduce((function(e,t){return Object.getOwnPropertyNames(t).forEach((function(n){if(h(e,n))throw new Error("Target attribute name is duplicated: ".concat(n));Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}),e)}function E(e){var t=0,n=y();return function(i){t+=i;var r=y(),s=r-n;s>=1e3&&(e(t/s*1e3),n=r,t=0)}}function A(e){var t=e.composedPath&&e.composedPath()||e.path,n=e.target;return null!=t?t.indexOf(window)<0?t.concat(window):t:n===window?[window]:[n].concat(function e(t,n){n=n||[];var i=t.parentNode;return i?e(i,n.concat(i)):n}(n),window)}function L(e,t){var n=t.width,i=t.height;window.devicePixelRatio&&(e.style.width=n+"px",e.style.height=i+"px",e.height=i*window.devicePixelRatio,e.width=n*window.devicePixelRatio,e.scale(window.devicePixelRatio,window.devicePixelRatio))}var C=function(){var e=navigator.userAgent.toLowerCase();return/iphone|ipad|ipod/.test(e)||!("MediaSource"in window)},T=function(){function e(n,i){t(this,e),this.flv=n,this.writed=!1,this.opts={},this.decoder=i,this.msePlayer=!C(),this.url=this.flv.options.url,this._startEvent=null,this._stopEvent=null}return s(e,[{key:"start",value:function(e){var t=this,n=e.fileName,i=e.callback,r=e.size,s=e.onDownload,a=e.warnSize,l=e.warnCallBack;this.opts={mitm:this.flv.options.mitm,limitSize:r,onDownload:function(){s&&s()}},i&&(this.opts.callback=i),null!=r&&(this.opts.limitSizeCallBack=function(){t.stop(),t.opts.callback&&t.opts.callback(2)}),null!=a&&(this.opts.warnSize=a,this.opts.warnCallBack=function(){l&&l()});var u=o().createWriteStream(n,this.opts),c=new TransformStream({transform:function(e,t){return e.arrayBuffer().then((function(e){return t.enqueue(new Uint8Array(e))}))}}),h=c.readable,d=c.writable;return this.writer=d.getWriter(),h.pipeTo(u).then((function(){return console.log("done writing")})),this.writed=!0,this._startEvent&&this._startEvent(),!0}},{key:"stop",value:function(e){this.writer&&this.writer.close(),this.writed=!1,e&&this.opts.callback&&this.opts.callback(1),this.ws&&this.ws.close(),this.ws=null,this._stopEvent&&this._stopEvent()}},{key:"onMessage",value:function(e){this.writer.write(e)}},{key:"appendBuffer",value:function(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer}},{key:"updateCurrentTime",value:function(e){var t=this.decoder.startTime.add(e,"second").format("YYYY-MM-DDTHH:mm:ss"),n=this.decoder.endTime.format("YYYY-MM-DDTHH:mm:ss"),i=this.flv.options.url.slice(0,-40);this.url="".concat(i,"/").concat(t,"/").concat(n)}},{key:"startRecord",value:function(e){var t=this;console.log("startRecord",e);var n=e.fileName,i=e.callback,r=e.size,s=e.onDownload,a=e.warnSize,o=e.warnCallBack;this.flv.options.live||this.decoder.rtspurl||this.updateCurrentTime(this.decoder.currentTime),this.msePlayer&&(this.url=this.url.replace("/flv","")),this.ws=new WebSocket(this.url),this.ws.binaryType="arraybuffer";var l,u=!0;this.ws.onclose=function(){t.writed&&(i&&i(1),t.writer.close(),t.writed=!1)},this.ws.onopen=function(e){},this.ws.onmessage=function(e){if(u){var c=new Uint8Array(e.data);l=(l=new TextDecoder("utf-8").decode(c)).replace(/\s\u0000/g,"");try{var h=JSON.parse(l);0===h.param.errorID?(t.flv.options.live||(t.ws.send(JSON.stringify({SN:"1",Ack:"0",FC:"FC_WS_STREAM_CONTINUE",param:{}})),t.decoder.rtspurl&&t.ws.send(JSON.stringify({SN:"3",Ack:"0",FC:"FC_WS_STREAM_SEEK",param:{time_pos:1e3*t.decoder.currentTime}}))),t.start({fileName:n,callback:i,size:r,warnSize:a,onDownload:function(){s&&s()},warnCallBack:function(){o&&o()}})):(console.log("下载连接失败:"+JSON.stringify(h.param)),s&&s(),errorCallBack&&errorCallBack(h.param.errorID,h.param.errorDesc))}catch(e){console.log(e)}u=!1}else t.writed&&t.onMessage(new Blob([e.data],{type:"video/mp4"}))}}},{key:"downloadFile",value:function(e){var t=this,n=e.url,i=e.fileName,r=e.size,s=e.callback,a=e.onDownload,o=e.warnSize,l=e.warnCallBack,u=e.errorCallBack;this.ws=new WebSocket(n),this.ws.binaryType="arraybuffer";var c,h=!0;this.ws.onclose=function(){t.writed&&(s&&s(1),t.writer.close(),t.writed=!1)},this.ws.onopen=function(e){},this.ws.onmessage=function(e){if(h){var n=new Uint8Array(e.data);c=(c=new TextDecoder("utf-8").decode(n)).replace(/\s\u0000/g,"");try{var d=JSON.parse(c);0===d.param.errorID?(t.ws.send(JSON.stringify({SN:"1",Ack:"0",FC:"FC_WS_STREAM_CONTINUE",param:{}})),t.start({fileName:i,callback:s,size:r,warnSize:o,onDownload:function(){a&&a()},warnCallBack:function(){l&&l()}})):(console.log("下载连接失败:"+JSON.stringify(d.param)),a&&a(),u&&u(d.param.errorID,d.param.errorDesc))}catch(e){console.log(e)}h=!1}else t.writed&&t.onMessage(new Blob([e.data],{type:"video/mp4"}))}}},{key:"startEvent",get:function(){return this._startEvent}},{key:"startCallBack",set:function(e){this._startEvent=e}},{key:"stopEvent",get:function(){return this._stopEvent},set:function(e){this._stopEvent=e}}]),e}();function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?O(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var B=n(828),I=n.n(B);function U(){return function(){try{if("object"===l(window.WebAssembly)&&"function"==typeof window.WebAssembly.instantiate){var e=new window.WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof window.WebAssembly.Module)return new window.WebAssembly.Instance(e)instanceof window.WebAssembly.Instance}return!1}catch(e){return!1}}()&&"function"==typeof window.Worker&&"function"==typeof window.fetch&&"function"==typeof window.Blob&&function(){try{return!!new window.Blob}catch(e){return!1}}()&&"function"==typeof window.ArrayBuffer&&window.URL&&"function"==typeof window.URL.createObjectURL&&("probably"===(e=(new Audio).canPlayType("audio/aac;"))||"maybe"===e)&&(window.AudioContext||window.webkitAudioContext)&&function(){if(window.WebGLRenderingContext){for(var e=document.createElement("canvas"),t=["webgl2","webgl","experimental-webgl","moz-webgl","webkit-3d"],n=!1,i=0;i<t.length;i+=1)try{if((n=e.getContext(t[i]))&&"function"==typeof n.getParameter)return!0}catch(e){}return!1}return!1}();var e}var F=function(){function e(){t(this,e)}return s(e,[{key:"on",value:function(e,t,n){var i=this.e||(this.e={});return(i[e]||(i[e]=[])).push({fn:t,ctx:n}),this}},{key:"once",value:function(e,t,n){var i=this;function r(){i.off(e,r);for(var s=arguments.length,a=new Array(s),o=0;o<s;o++)a[o]=arguments[o];t.apply(n,a)}return r._=t,this.on(e,r,n)}},{key:"emit",value:function(e){for(var t=((this.e||(this.e={}))[e]||[]).slice(),n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(var s=0;s<t.length;s+=1)t[s].fn.apply(t[s].ctx,i);return this}},{key:"off",value:function(e,t){var n=this.e||(this.e={}),i=n[e],r=[];if(i&&t)for(var s=0,a=i.length;s<a;s+=1)i[s].fn!==t&&i[s].fn._!==t&&r.push(i[s]);return r.length?n[e]=r:delete n[e],this}}]),e}();function N(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function j(e,t,n){return(j=N()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&R(r,n.prototype),r}).apply(null,arguments)}function z(e){var t="function"==typeof Map?new Map:void 0;return(z=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return j(e,arguments,P(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),R(i,e)})(e)}function $(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var V=function(e){D(r,e);var n,i=(n=r,function(){var e,t=P(n);if($()){var i=P(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return M(this,e)});function r(e){var n;return t(this,r),(n=i.call(this,e)).name="HYPlayerError",n}return r}(z(Error)),G=function e(n){t(this,e);var i=n.options.debug;this.log=function(e){if(i){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];(t=console).log.apply(t,["HYPlayer: [".concat(e,"]")].concat(r))}},this.warn=function(e){if(!e&&i){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];(t=console).warn.apply(t,r)}},this.error=function(e,t){if(!e)throw new V(t)}},W=function(){function e(n){var i=this;t(this,e),this.destroys=[],this.proxy=this.proxy.bind(this),n.on("destroy",(function(){i.destroy()}))}return s(e,[{key:"proxy",value:function(e,t,n){var i=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(Array.isArray(t))return t.map((function(t){return i.proxy(e,t,n,r)}));e.addEventListener(t,n,r);var s=function(){return e.removeEventListener(t,n,r)};return this.destroys.push(s),s}},{key:"destroy",value:function(){this.destroys.forEach((function(e){return e()}))}}]),e}(),H=function e(n){t(this,e),function(e,t){var n=e.options,i=n.container.style.cssText;n.container.classList.add("hyplayer-container"),C()?n.container.innerHTML='\n    <div class="hyplayer-player">\n        <canvas class="hyplayer-canvas" width="'.concat(n.width,'" height="').concat(n.height,'"></canvas>\n    </div>\n'):n.container.innerHTML='\n    <div class="hyplayer-player">\n        <video style="width:100%;height:100%;object-fit:'.concat(n.filled?"fill":"contain",'"  oncontextmenu="return false"  class="hyplayer-canvas"  muted></video>\n    </div>\n    '),e.on("destroy",(function(){n.container.innerHTML="",n.container.style.cssText=i,n.container.classList.remove("hyplayer-container")})),Object.defineProperty(t,"$container",{value:n.container}),Object.defineProperty(t,"$player",{value:n.container.querySelector(".hyplayer-player")}),Object.defineProperty(t,"$canvas",{value:n.container.querySelector(".hyplayer-canvas")})}(n,this),function(e,t){Object.defineProperty(t,"rect",{get:function(){return t.$container.getBoundingClientRect()}}),["bottom","height","left","right","top","width"].forEach((function(e){Object.defineProperty(t,e,{get:function(){return t.rect[e]}})})),Object.defineProperty(t,"currentTime",{get:function(){return C()?e.decoder.currentTime:e.decoder.flvPlayer.currentTime},set:function(t){C()?setTimeout((function(){e.decoder.currentTime=t}),1e3):e.decoder.flvPlayer.currentTime=t}}),Object.defineProperty(t,"muted",{get:function(){return C()?e.decoder.audio.muted:e.decoder.muted},set:function(t){C()?e.decoder.audio.muted=t:e.decoder.muted=t}}),Object.defineProperty(t,"duration",{get:function(){if(!e.decoder)return e.options.duration;try{return C()?e.decoder.video.duration||e.options.duration:e.decoder.duration||e.options.duration}catch(t){return e.options.duration}},set:function(t){e.decoder&&(C()?e.decoder.video.duration=t:e.decoder.duration=t)}}),Object.defineProperty(t,"volume",{get:function(){try{return C()?e.decoder.audio.volume:e.decoder.volume}catch(e){return 0}},set:function(t){if(C())try{e.decoder.audio.volume=g(t,0,1)}catch(e){}else try{e.decoder.volume=g(t,0,1)}catch(e){}}}),Object.defineProperty(t,"frameRate",{get:function(){var t=Math.round(e.options.frameRate||30);try{return Math.round(e.scripMeta.framerate)||t}catch(e){return t}}}),Object.defineProperty(t,"frameDuration",{get:function(){return 1e3/t.frameRate|0}}),Object.defineProperty(t,"loaded",{get:function(){return e.decoder.loaded}}),Object.defineProperty(t,"playing",{get:function(){return!!e.decoder&&e.decoder.playing}}),Object.defineProperty(t,"ended",{get:function(){return e.decoder.ended}}),Object.defineProperty(t,"hasAudio",{get:function(){return e.decoder.hasAudio},set:function(t){e.decoder.hasAudio=t}}),Object.defineProperty(t,"play",{value:function(){t.playing||e.decoder.play()}}),Object.defineProperty(t,"pause",{value:function(){e.decoder.pause()}}),Object.defineProperty(t,"seeked",{value:function(t){e.decoder.seeked(t)}}),Object.defineProperty(t,"setTimes",{value:function(t,n){return e.decoder.setTimes(t,n)}}),Object.defineProperty(t,"setSpeed",{value:function(t){e.decoder.setSpeed(t)}}),Object.defineProperty(t,"toggle",{value:function(){t.playing?t.pause():t.play()}}),Object.defineProperty(t,"flow",{value:function(t){return e.decoder.flow(t)}}),Object.defineProperty(t,"screenshot",{value:function(){if(C())return e.$canvas.toDataURL("image/jpeg",1);var t=document.createElement("canvas"),n=t.getContext("2d");return t.width=1*e.$canvas.videoWidth,t.height=1*e.$canvas.videoHeight,n.drawImage(e.$canvas,0,0,t.width,t.height),t.toDataURL("image/jpeg",1)}}),Object.defineProperty(t,"setPlayerSize",{value:function(n,i){e.options.width=n,e.options.height=i,t.$canvas.height=i/n*t.$canvas.width}}),Object.defineProperty(t,"setScale",{value:function(n){if(C())if(n)e.$canvas.width=e.decoder.video.videoWidth,e.$canvas.height=e.decoder.video.videoHeight,e.autoSized=!0,e.control.autoSize();else{var i=t.$canvas.width;t.$canvas.height=t.$container.clientHeight/t.$container.clientWidth*i,e.autoSized=!1,e.control.autoSize()}else n?(e.$canvas.style.objectFit="fill",e.options.filled=!0):(e.$canvas.style.objectFit="contain",e.options.filled=!1)}}),Object.defineProperty(t,"startRecord",{value:function(t){e.decoder.record.start(t)}}),Object.defineProperty(t,"endRecord",{value:function(){e.decoder.record.stop()}})}(n,this),function(e,t){var n=e.events.proxy;e.on("scripMeta",(function(n){var i=n.width,r=n.height;e.scripMeta=n,e.options.filled?i&&r&&(t.$canvas.width=i,t.$canvas.height=t.$container.clientHeight/t.$container.clientWidth*i):i&&r&&(t.$canvas.width=i,t.$canvas.height=r)})),n(t.$canvas,"click",(function(){!e.isMobile&&e.options.live}))}(n,this)},q=(n(421),n(878)),K=n.n(q),Y=n(757),X=n.n(Y),J=n(164),Z=n.n(J),Q=n(879),ee=n.n(Q),te=n(27),ne=n.n(te),ie=n(971),re=n.n(ie),se={play:K(),pause:X(),volume:Z(),volumeClose:ee(),fullscreen:ne(),loading:re()};Object.keys(se).reduce((function(e,t){return e[t]='<i class="hyplayer-icon hyplayer-icon-'.concat(t,'"><svg ').concat(se[t]," /></i>"),e}),{});var ae=n(754),oe=n.n(ae);const le=function e(n){t(this,e),function(e,t){var n=e.options;n.control?e.player.$player.classList.add("hyplayer-controls-show"):e.player.$player.classList.add("hyplayer-controls-hide"),n.live&&e.player.$player.classList.add("hyplayer-live"),e.player.$player.insertAdjacentHTML("beforeend","\n        ".concat(n.poster?'<div class="hyplayer-poster" style="background-image: url('.concat(n.poster,')"></div>'):"",'\n            <div class="hyplayer-loading">\n            <svg xmlns="http://www.w3.org/2000/svg" width="50px" height="50px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default">\n            <rect x="0" y="0" width="100" height="100" fill="none" class="bk"/>\n            <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(0 50 50) translate(0 -30)">\n              <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-1s" repeatCount="indefinite"/>\n            </rect>\n            <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(30 50 50) translate(0 -30)">\n              <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"/>\n            </rect>\n            <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(60 50 50) translate(0 -30)">\n              <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"/>\n            </rect>\n            <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(90 50 50) translate(0 -30)">\n              <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect>\n            <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(120 50 50) translate(0 -30)">\n              <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"/>\n            </rect>\n            <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(150 50 50) translate(0 -30)">\n              <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"/>\n            </rect>\n            <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(180 50 50) translate(0 -30)">\n              <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect>\n            <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(210 50 50) translate(0 -30)">\n              <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"/>\n            </rect>\n            <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(240 50 50) translate(0 -30)">\n              <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"/>\n            </rect>\n            <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(270 50 50) translate(0 -30)">\n              <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect>\n            <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(300 50 50) translate(0 -30)">\n              <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"/>\n            </rect>\n            <rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#ffffff" transform="rotate(330 50 50) translate(0 -30)">\n              <animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"/>\n            </rect>\n            </svg>\n          </div>\n          <div class="hyplayer-error"></div>\n            <div class="hyplayer-controls">\n                ').concat(n.live?"":'\n                    <div class="hyplayer-controls-progress">\n                        <div class="hyplayer-loaded"></div>\n                        <div class="hyplayer-played">\n                            <div class="hyplayer-indicator"></div>\n                        </div>\n                    </div>\n                   ','\n                <div class="hyplayer-controls-bottom">\n                    <div class="hyplayer-controls-left">\n                        <div class="hyplayer-controls-item hyplayer-state">\n                        \n                            <div class="hyplayer-play"><svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22">\n                            <path d="M17.982 9.275L8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z"></path>\n                          </svg></div>\n                            <div class="hyplayer-pause"><svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22">\n                            <path d="M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zM15 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z"></path>\n                        </svg></div>\n\n                        </div>\n                       \n                            <div class="hyplayer-controls-item hyplayer-volume">\n                                <div class="hyplayer-volume-on"><svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22">\n                                <path d="M10.188 4.65L6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zM14.446 3.778a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z"></path>\n                                <path d="M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z"></path>\n                            </svg></div>\n                                <div class="hyplayer-volume-off"><svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 22 22">\n                                <path d="M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z"></path>\n                                <path d="M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zM18.778 18.778l-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z"></path>\n                            </svg></div>\n                                ').concat(e.isMobile?"":'\n                                    <div class="hyplayer-volume-panel">\n                                        <div class="hyplayer-volume-panel-handle"></div>\n                                    </div>\n                                ',"\n                            </div>\n                       \n                        ").concat(n.live?"":'\n                            <div class="hyplayer-controls-item hyplayer-time">\n                                <span class="hyplayer-current">00:00</span> / <span class="hyplayer-duration">00:00</span>\n                            </div>\n                        ',"\n                        ").concat(n.hasAudioIcon?'<div class="hyplayer_hasAudio">\n                          <div class="hyplayer-hasAudio-on">\n                          <svg t="1618984336874" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1126" xmlns:xlink="http://www.w3.org/1999/xlink" width="20" height="20"><defs><style type="text/css"></style></defs><path d="M465.49 363.13c0-21.44 17.33-38.82 38.54-38.82 21.47 0 38.8 17.38 38.8 38.82v440.98c0 21.47-17.33 38.54-38.8 38.54-21.21 0-38.54-17.07-38.54-38.54V363.13z m352.87 303.89c0-21.44 17.1-39.08 38.54-39.08 21.47 0 39.1 17.64 39.1 39.08v89.22h89.18c21.47 0 38.82 17.33 38.82 38.8 0 21.16-17.35 38.54-38.82 38.54H896v89.46c0 21.46-17.63 38.54-39.1 38.54-21.44 0-38.54-17.08-38.54-38.54v-89.46h-89.71c-21.19 0-38.57-17.38-38.57-38.54 0-21.47 17.38-38.8 38.57-38.8h89.71v-89.22zM288.23 537.39c0-21.5 17.33-38.82 39.05-38.82 21.49 0 38.54 17.32 38.54 38.82v266.72c0 21.47-17.05 38.54-38.54 38.54-21.72 0-39.05-17.07-39.05-38.54V537.39zM38.82 961.58C17.35 961.58 0 944.5 0 923.04c0-21.47 17.35-38.54 38.82-38.54h555.76c21.47 0 38.82 17.07 38.82 38.54 0 21.46-17.35 38.54-38.82 38.54H38.82z m72.66-663.13c0-21.19 17.63-38.54 39.1-38.54 20.91 0 38.54 17.35 38.54 38.54v505.66c0 21.47-17.63 38.54-38.54 38.54-21.47 0-39.1-17.07-39.1-38.54V298.45z m708-80.67c0-21.47 17.61-39.07 38.52-39.07 21.49 0 39.1 17.61 39.1 39.07v309.96c0 20.91-17.61 38.54-39.1 38.54-20.91 0-38.52-17.63-38.52-38.54V217.78zM642.47 96.14c0-21.47 17.35-38.54 38.54-38.54 21.75 0 38.82 17.07 38.82 38.54v462.44c0 21.47-17.07 38.83-38.82 38.83-21.19 0-38.54-17.35-38.54-38.83V96.14z" fill="#ffffff" p-id="1127"></path></svg>\n                          </div>\n                          <div class="hyplayer-hasAudio-off">\n                          <svg t="1618984746237" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2659" xmlns:xlink="http://www.w3.org/1999/xlink" width="20" height="20"><defs><style type="text/css"></style></defs><path d="M293.02 540.21c0-21.81 17.03-39.69 38.86-39.69 22.06 0 39.4 17.88 39.4 39.69v270.93c0 21.81-17.34 39.43-39.4 39.43-21.83 0-38.86-17.63-38.86-39.43V540.21z m663.46 135.32c15.38-15.66 40.54-15.66 56.18 0 15.12 15.12 15.12 40.26 0 55.64L926 817.56l86.65 86.4c15.12 15.66 15.12 40.54 0 55.92-15.64 15.38-40.8 15.38-56.18 0l-86.4-86.65-86.11 86.65c-15.66 15.38-40.82 15.38-56.2 0s-15.38-40.54 0-55.92l86.68-86.4-86.68-86.39c-15.38-15.38-15.38-40.26 0-55.64 15.38-15.66 40.54-15.66 56.2 0l86.11 86.68 86.41-86.68zM39.12 971.34C17.34 971.34 0 953.71 0 931.91c0-21.52 17.34-39.15 39.12-39.15h564.8c21.52 0 39.12 17.63 39.12 39.15 0 21.81-17.6 39.43-39.12 39.43H39.12z m73.86-673.81c0-21.55 17.32-39.15 39.12-39.15s39.43 17.6 39.43 39.15v513.61c0 21.81-17.63 39.43-39.43 39.43s-39.12-17.63-39.12-39.43V297.53z m719.09-82.22c0-21.81 17.88-39.69 39.15-39.69 21.81 0 39.69 17.88 39.69 39.69v346.15c0 21.81-17.88 39.71-39.69 39.71-21.26 0-39.15-17.91-39.15-39.71V215.31zM652.03 92.02c0-21.53 17.88-39.43 39.66-39.43 21.55 0 39.17 17.9 39.17 39.43v469.45c0 21.81-17.63 39.71-39.17 39.71-21.78 0-39.66-17.91-39.66-39.71V92.02zM472.21 363.23c0-21.53 18.19-39.43 39.43-39.43 21.81 0 39.71 17.9 39.71 39.43v447.91c0 21.81-17.91 39.43-39.71 39.43-21.24 0-39.43-17.63-39.43-39.43V363.23z" fill="#ffffff" p-id="2660"></path></svg>\n                          </div>\n                          </div>':"","\n                        ").concat(n.screenshot?' <div class="hyplayer_screenshot">\n                           <div class="hy_screenshot_icon ">\n                                <svg t="1588834637587" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7536" width="20" height="20"><path d="M312.32 711.68V384H215.04v430.08h491.52v163.84h97.28v-163.84h163.84V716.8H312.32v-5.12z m399.36-66.56h97.28V215.04H317.44V51.2H220.16v163.84H51.2v97.28h660.48v332.8z" p-id="7537"></path>\n                                </svg>\n                              </div>\n                          </div>':"",'\n\n                    </div>\n                   \n\n                    <div class="hyplayer-controls-right">\n                        <div class="hyplayer-controls-item hyplayer-fullscreen"><svg xmlns="http://www.w3.org/2000/svg" height="36" width="36" viewBox="0 0 36 36">\n                        <path d="m 10,16 2,0 0,-4 4,0 0,-2 L 10,10 l 0,6 0,0 z"></path>\n                        <path d="m 20,10 0,2 4,0 0,4 2,0 L 26,10 l -6,0 0,0 z"></path>\n                        <path d="m 24,24 -4,0 0,2 L 26,26 l 0,-6 -2,0 0,4 0,0 z"></path>\n                        <path d="M 12,20 10,20 10,26 l 6,0 0,-2 -4,0 0,-4 0,0 z"></path>\n                    </svg></div>\n                   \n                    </div>\n                </div>\n            </div>\n        ')),Object.defineProperty(t,"$poster",{value:n.container.querySelector(".hyplayer-poster")}),Object.defineProperty(t,"$loading",{value:n.container.querySelector(".hyplayer-loading")}),Object.defineProperty(t,"$error",{value:n.container.querySelector(".hyplayer-error")}),Object.defineProperty(t,"$controls",{value:n.container.querySelector(".hyplayer-controls")}),Object.defineProperty(t,"$state",{value:n.container.querySelector(".hyplayer-state")}),Object.defineProperty(t,"$play",{value:n.container.querySelector(".hyplayer-play")}),Object.defineProperty(t,"$pause",{value:n.container.querySelector(".hyplayer-pause")}),Object.defineProperty(t,"$current",{value:n.container.querySelector(".hyplayer-current")}),Object.defineProperty(t,"$duration",{value:n.container.querySelector(".hyplayer-duration")}),Object.defineProperty(t,"$volume",{value:n.container.querySelector(".hyplayer-volume")}),Object.defineProperty(t,"$volumeOn",{value:n.container.querySelector(".hyplayer-volume-on")}),Object.defineProperty(t,"$volumeOff",{value:n.container.querySelector(".hyplayer-volume-off")}),Object.defineProperty(t,"$hasAudioOn",{value:n.container.querySelector(".hyplayer-hasAudio-on")}),Object.defineProperty(t,"$hasAudioOff",{value:n.container.querySelector(".hyplayer-hasAudio-off")}),Object.defineProperty(t,"$volumePanel",{value:n.container.querySelector(".hyplayer-volume-panel")}),Object.defineProperty(t,"$volumeHandle",{value:n.container.querySelector(".hyplayer-volume-panel-handle")}),Object.defineProperty(t,"$fullscreen",{value:n.container.querySelector(".hyplayer-fullscreen")}),Object.defineProperty(t,"$screenshot",{value:n.container.querySelector(".hyplayer_screenshot")}),Object.defineProperty(t,"$progress",{value:n.container.querySelector(".hyplayer-controls-progress")}),Object.defineProperty(t,"$loaded",{value:n.container.querySelector(".hyplayer-loaded")}),Object.defineProperty(t,"$played",{value:n.container.querySelector(".hyplayer-played")}),Object.defineProperty(t,"$indicator",{value:n.container.querySelector(".hyplayer-indicator")})}(n,this),function(e){var t=e.events.proxy,n=e.player,i=document.createElement("object");i.setAttribute("aria-hidden","true"),i.setAttribute("tabindex",-1),i.type="text/html",i.data="about:blank",b(i,{display:"block",position:"absolute",top:"0",left:"0",height:"100%",width:"100%",overflow:"hidden",pointerEvents:"none",zIndex:"-1"});var r=n.width,s=n.height;t(i,"load",(function(){t(i.contentDocument.defaultView,"resize",(function(){n.width===r&&n.height===s||(r=n.width,s=n.height,e.emit("resize"))}))})),n.$container.appendChild(i)}(n),function(e,t){var n=e.player;Object.defineProperty(t,"controls",{get:function(){return n.$player.classList.contains("hyplayer-controls-show")},set:function(e){e?n.$player.classList.add("hyplayer-controls-show"):n.$player.classList.remove("hyplayer-controls-show")}}),Object.defineProperty(t,"loading",{get:function(){return n.$player.classList.contains("hyplayer-loading-show")},set:function(e){e?n.$player.classList.add("hyplayer-loading-show"):n.$player.classList.remove("hyplayer-loading-show")}}),Object.defineProperty(t,"error",{get:function(){return n.$player.classList.contains("hyplayer-error-show")},set:function(e){e?(n.$player.classList.add("hyplayer-error-show"),t.$error.innerText=e):n.$player.classList.remove("hyplayer-error-show")}});try{var i=function(){t.fullscreen?n.$container.classList.add("hyplayer-fullscreen"):n.$container.classList.remove("hyplayer-fullscreen"),t.autoSize()};oe().on("change",i),e.events.destroys.push((function(){oe().off("change",i)}))}catch(e){}Object.defineProperty(t,"fullscreen",{get:function(){return oe().isFullscreen||n.$container.classList.contains("hyplayer-fullscreen-web")},set:function(e){if(e)try{oe().request(n.$container)}catch(e){n.$container.classList.add("hyplayer-fullscreen-web"),t.autoSize()}else try{oe().exit()}catch(e){n.$container.classList.remove("hyplayer-fullscreen-web"),t.autoSize()}}}),Object.defineProperty(t,"autoSize",{value:function(){if(C()){n.$container.style.padding="0 0";var t=n.width,i=n.height,r=t/i,s=n.$canvas.width/n.$canvas.height;if(e.options.filled)if(e.autoSized)if(r>s){var a=(t-i*s)/2;n.$container.style.padding="0 ".concat(a,"px")}else{var o=(i-t/s)/2;n.$container.style.padding="".concat(o,"px 0")}else n.$container.style.padding="0 0";else if(r>s){var l=(t-i*s)/2;n.$container.style.padding="0 ".concat(l,"px")}else{var u=(i-t/s)/2;n.$container.style.padding="".concat(u,"px 0")}}else e.options.filled?n.$canvas.style.objectFit="fill":n.$canvas.style.objectFit="contain"}})}(n,this),function(e,t){var n=e.options.poster,i=e.events.proxy,r=e.player;i(window,["click","contextmenu"],(function(e){A(e).indexOf(r.$container)>-1?t.isFocus=!0:t.isFocus=!1})),t.autoSize(),e.on("resize",(function(){t.autoSize()})),e.on("scripMeta",(function(){t.autoSize()})),i(window,"orientationchange",(function(){setTimeout((function(){t.autoSize()}),300)})),n&&(e.once("play",(function(){t.$poster.style.display="none"})),e.once("seeked",(function(){t.$poster.style.display="none"}))),e.on("waiting",(function(){t.loading=!0})),e.on("ended",(function(){t.loading=!1})),e.on("timeupdate",(function(){t.loading=!1})),i(t.$play,"click",(function(){r.play()})),i(t.$pause,"click",(function(){r.pause()}));var s=_((function(e){var n=g(e/r.duration,0,1);t.$loaded.style.width="".concat(100*n,"%")}),500);e.on("videoLoaded",(function(t){e.options.live||s(t)}));var a=_((function(e){var n=e;n>=r.duration&&(n=r.duration),t.$played.style.width="".concat(n/r.duration*100,"%"),t.$current.innerText=m(n)}),500),o=v((function(n){e.emit("seekedTo",n);var i=n;i>=r.duration&&(i=r.duration),t.$played.style.width="".concat(i/r.duration*100,"%"),t.$current.innerText=m(i)}),50);e.on("timeupdate",(function(t){e.options.live||a(t)})),e.on("seeked",(function(t){e.options.live||a(t)})),e.on("play",(function(){t.$play.style.display="none",t.$pause.style.display="block"})),e.on("ended",(function(){t.controls=!0,t.$play.style.display="block",t.$pause.style.display="none"})),e.on("loop",(function(){t.controls=!1})),e.on("pause",(function(){t.$play.style.display="block",t.$pause.style.display="none",t.loading=!1})),e.on("hasAudioChange",(function(e){t.$volume&&(t.$volume.style.display=e?"block":"none")})),e.on("updateDuration",(function(n){e.options.live||(t.$duration.innerText=m(n))})),i(t.$fullscreen,"click",(function(){t.fullscreen?t.fullscreen=!1:t.fullscreen=!0})),e.options.screenshot&&i(t.$screenshot,"click",(function(t){if(e){var n=document.createElement("canvas"),i=n.getContext("2d");n.width=1*e.$canvas.videoWidth,n.height=1*e.$canvas.videoHeight,i.drawImage(e.$canvas,0,0,n.width,n.height),e.decoder.downloadFile(n.toDataURL("image/jpeg",1))}}));var l=v((function(){r.$player.classList.add("hyplayer-hide-cursor"),t.controls=!1}),5e3);function u(n){var i=t.$volumePanel.getBoundingClientRect(),r=i.left,s=i.width,a=t.$volumeHandle.getBoundingClientRect().width,o=g(n.x-r-a/2,0,s-a/2)/(s-a);return e.emit("volumechange",o),o}function c(n){if(0===n)e.isMobile||b(t.$volumeHandle,"left","0"),b(t.$volumeOn,"display","none"),b(t.$volumeOff,"display","flex");else{if(!e.isMobile){var i=((w(t.$volumePanel,"width")||60)-w(t.$volumeHandle,"width"))*n;b(t.$volumeHandle,"left","".concat(i,"px"))}b(t.$volumeOn,"display","flex"),b(t.$volumeOff,"display","none")}}if(i(r.$player,"mousemove",(function(){l.clearTimeout(),r.$player.classList.remove("hyplayer-hide-cursor"),t.controls=!0})),e.options.hasAudioIcon&&(i(t.$hasAudioOn,"click",(function(){t.$hasAudioOn.style.display="none",t.$hasAudioOff.style.display="block",t.$volume.style.display="none",e.emit("setHasAudio",!1)})),i(t.$hasAudioOff,"click",(function(){t.$hasAudioOn.style.display="block",t.$hasAudioOff.style.display="none",t.$volume.style.display="block",e.emit("setHasAudio",!0)}))),e.options.hasAudio){e.options.hasAudioIcon&&(t.$hasAudioOn.style.display="block",t.$hasAudioOff.style.display="none");var h=0,d=!1;e.options.muted?c(0):c(e.options.volume),e.on("volumechange",(function(e){c(e)})),i(t.$volumeOn,"click",(function(){t.$volumeOn.style.display="none",t.$volumeOff.style.display="block",h=r.volume,r.volume=0,e.emit("setvolume",r.volume)})),i(t.$volumeOff,"click",(function(){t.$volumeOn.style.display="block",t.$volumeOff.style.display="none",r.volume=h||.7,e.emit("setvolume",r.volume)})),e.isMobile||(i(t.$volumePanel,"click",(function(t){r.volume=u(t),e.emit("setvolume",r.volume)})),i(t.$volumeHandle,"mousedown",(function(){d=!0})),i(t.$volumeHandle,"mousemove",(function(t){d&&(r.volume=u(t),e.emit("setvolume",r.volume))}))),i(document,"mouseup",(function(){d&&(d=!1)}))}else e.options.hasAudioIcon&&(t.$hasAudioOn.style.display="none",t.$hasAudioOff.style.display="block"),t.$volume.style.display="none";function f(e){var n=t.$progress,i=n.getBoundingClientRect().left,s=g(e.x-i,0,n.clientWidth),a=s/n.clientWidth*r.duration;return{second:a,time:m(a),width:s,percentage:g(s/n.clientWidth,0,1)}}function p(e){var n=t.$progress,i=g(e-n.getBoundingClientRect().left,0,n.clientWidth),s=i/n.clientWidth*r.duration;return{second:s,time:m(s),width:i,percentage:g(i/n.clientWidth,0,1)}}if(!e.options.live)if(e.isMobile){var y,k,S=!1;i(t.$progress,"touchstart",(function(e){var t=e.targetTouches[0];y=t.pageX})),i(t.$progress,"touchend",(function(n){if(n.target!==t.$indicator){var i=p(y),r=i.second;i.percentage,r&&(e.decoder.seeking=!0,o(r))}})),i(t.$indicator,"touchstart",(function(t){var n=t.targetTouches[0];y=n.pageX,e.decoder.seeking=!0,S=!0})),i(document,"touchmove",(function(e){if(S){var n=e.targetTouches[0],i=p(k=n.pageX),r=i.second,s=i.percentage;r&&(t.$played.style.width="".concat(100*s,"%"))}})),i(document,"touchend",(function(){if(S){var e=p(k),n=e.second,i=e.percentage;n&&(t.$played.style.width="".concat(100*i,"%"),o(n)),S=!1}}))}else{i(t.$progress,"click",(function(n){if(n.target!==t.$indicator){var i=f(n),r=i.second,s=i.percentage;r&&(e.decoder.seeking=!0,t.$played.style.width="".concat(100*s,"%"),o(r))}}));var E=!1;i(t.$indicator,"mousedown",(function(){e.decoder.seeking=!0,E=!0})),i(document,"mousemove",(function(e){if(E){var n=f(e),i=n.second,r=n.percentage;i&&(t.$played.style.width="".concat(100*r,"%"))}})),i(document,"mouseup",(function(e){if(E){var n=f(e),i=n.second,r=n.percentage;i&&(t.$played.style.width="".concat(100*r,"%"),o(Math.floor(i))),E=!1}}))}}(n,this),n.options.hotkey&&function(e,t){var n=e.events.proxy,i=e.player,r={};function s(e,t){r[e]?r[e].push(t):r[e]=[t]}s(27,(function(){t.fullscreen&&(i.fullscreen=!1)})),s(32,(function(){i.toggle()})),s(37,(function(){i.currentTime-=5})),s(38,(function(){i.volume+=.1})),s(39,(function(){i.currentTime+=5})),s(40,(function(){i.volume-=.1})),n(window,"keydown",(function(e){if(t.isFocus){var n=document.activeElement.tagName.toUpperCase(),i=document.activeElement.getAttribute("contenteditable");if("INPUT"!==n&&"TEXTAREA"!==n&&""!==i&&"true"!==i){var s=r[e.keyCode];s&&(e.preventDefault(),s.forEach((function(e){return e()})))}}}))}(n,this)};var ue=n(693),ce=n.n(ue),he={.0625:{rfps:1.875,fps:1.5625,correct:6},.125:{rfps:3.75,fps:3.125,correct:6},.25:{rfps:7.5,fps:6.25,correct:6},.5:{rfps:15,fps:12.5,correct:6},1:{rfps:30,fps:25,correct:6},2:{rfps:60,fps:50,correct:6},4:{rfps:60,fps:50,correct:6},8:{rfps:60,fps:50,correct:6},16:{rfps:60,fps:50,correct:6}};function de(e){this.init(e)}de.prototype.init=function(e){this.option=Object.assign({},{encoding:"16bitInt",channels:1,sampleRate:8e3,flushingTime:1e3},e),this.samples=new Float32Array,this.flush=this.flush.bind(this),this.interval=setInterval(this.flush,this.option.flushingTime),this.maxValue=this.getMaxValue(),this.typedArray=this.getTypedArray(),this.createContext()},de.prototype.getMaxValue=function(){var e={"8bitInt":128,"16bitInt":32768,"32bitInt":2147483648,"32bitFloat":1};return e[this.option.encoding]?e[this.option.encoding]:e["16bitInt"]},de.prototype.getTypedArray=function(){var e={"8bitInt":Int8Array,"16bitInt":Int16Array,"32bitInt":Int32Array,"32bitFloat":Float32Array};return e[this.option.encoding]?e[this.option.encoding]:e["16bitInt"]},de.prototype.createContext=function(){this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.gainNode=this.audioCtx.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioCtx.destination),this.startTime=this.audioCtx.currentTime},de.prototype.isTypedArray=function(e){return e.byteLength&&e.buffer&&e.buffer.constructor==ArrayBuffer},de.prototype.feed=function(e){if(this.isTypedArray(e)){e=this.getFormatedValue(e);var t=new Float32Array(this.samples.length+e.length);t.set(this.samples,0),t.set(e,this.samples.length),this.samples=t}},de.prototype.getFormatedValue=function(e){e=new this.typedArray(e.buffer);var t,n=new Float32Array(e.length);for(t=0;t<e.length;t++)n[t]=e[t]/this.maxValue;return n},de.prototype.volume=function(e){this.gainNode.gain.value=e},de.prototype.destroy=function(){this.interval&&clearInterval(this.interval),this.samples=null,this.audioCtx.close(),this.audioCtx=null},de.prototype.flush=function(){if(this.samples.length){var e,t,n,i,r,s=this.audioCtx.createBufferSource(),a=this.samples.length/this.option.channels,o=this.audioCtx.createBuffer(this.option.channels,a,this.option.sampleRate);for(t=0;t<this.option.channels;t++)for(e=o.getChannelData(t),n=t,r=50,i=0;i<a;i++)e[i]=this.samples[n],i<50&&(e[i]=e[i]*i/50),i>=a-51&&(e[i]=e[i]*r--/50),n+=this.option.channels;this.startTime<this.audioCtx.currentTime&&(this.startTime=this.audioCtx.currentTime),s.buffer=o,s.connect(this.gainNode),s.start(this.startTime),this.startTime+=o.duration,this.samples=new Float32Array}},de.prototype.getTimestamp=function(){return this.audioCtx?this.audioCtx.currentTime:0},de.prototype.play=function(e){if(this.isTypedArray(e)&&(e=this.getFormatedValue(e)).length){var t,n,i,r,s,a=this.audioCtx.createBufferSource(),o=e.length/this.option.channels,l=this.audioCtx.createBuffer(this.option.channels,o,this.option.sampleRate);for(n=0;n<this.option.channels;n++)for(t=l.getChannelData(n),i=n,s=50,r=0;r<o;r++)t[r]=e[i],r<50&&(t[r]=t[r]*r/50),r>=o-51&&(t[r]=t[r]*s--/50),i+=this.option.channels;this.startTime<this.audioCtx.currentTime&&(this.startTime=this.audioCtx.currentTime),a.buffer=l,a.connect(this.gainNode),a.start(this.startTime),this.startTime+=l.duration}},de.prototype.pause=function(){"running"===this.audioCtx.state&&this.audioCtx.suspend()},de.prototype.resume=function(){"suspended"===this.audioCtx.state&&this.audioCtx.resume()};var fe=function(){function e(n,i){var r=this;t(this,e),this.flv=n,this.decoder=i,this.firstAudioFrame=!0,this.volume=this.flv.options.volume,n.on("restartAudio",(function(e){r.pcmPlayer&&r.pcmPlayer.destroy(),r.pcmPlayer=null,r.pcmPlayer=new de({encoding:r.audioEncoding,channels:r.audioChannels,sampleRate:r.audioSampleRate,flushingTime:5e3})})),n.on("setvolume",(function(e){r.pcmPlayer&&r.pcmPlayer.volume(e)})),n.on("setAudioParam",(function(e){r.setAudioParam(e)})),n.on("destroy",(function(){r.pcmPlayer&&r.pcmPlayer.destroy(),r.pcmPlayer=null}))}return s(e,[{key:"displayAudioFrame",value:function(e){return this.firstAudioFrame&&(this.firstAudioFrame=!1,this.decoder.beginTimeOffset=e.s),this.pcmPlayer.play(new Uint8Array(e.d)),!0}},{key:"setAudioParam",value:function(e){if(e){var t=e.f,n=e.c,i=e.r,r="16bitInt";switch(t){case 0:r="8bitInt";break;case 1:r="16bitInt";break;case 2:r="32bitInt";break;case 3:r="32bitFloat";break;default:this.flv.debug.log("Unsupported audio sampleFmt "+t+"!")}this.flv.debug.log("Audio encoding "+r+"."),console.log("encoding:",r,"channels:",n,"sampleRate:",i),this.pcmPlayer=new de({encoding:r,channels:n,sampleRate:i,flushingTime:5e3}),this.flv.options.muted&&(this.volume=0),this.pcmPlayer.volume(this.volume),this.audioEncoding=r,this.audioChannels=n,this.audioSampleRate=i}}},{key:"setVolume",value:function(e){this.pcmPlayer&&this.pcmPlayer.volume(e)}},{key:"muted",get:function(){return 0===this.volume},set:function(e){e?(this.volume=0,this.setVolume(0)):(this.volume=1,this.setVolume(1))}}]),e}(),pe=function(){function e(n){t(this,e),this.gl=n,this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}return s(e,[{key:"bind",value:function(e,t,n){var i=this.gl;i.activeTexture([i.TEXTURE0,i.TEXTURE1,i.TEXTURE2][e]),i.bindTexture(i.TEXTURE_2D,this.texture),i.uniform1i(i.getUniformLocation(t,n),e)}},{key:"fill",value:function(e,t,n){var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.LUMINANCE,e,t,0,i.LUMINANCE,i.UNSIGNED_BYTE,n)}}]),e}(),me=function(){function e(n,i){t(this,e),this.canvas=n,this.gl=n.getContext("webgl",i)||n.getContext("experimental-webgl",i),this.initGL()}return s(e,[{key:"initGL",value:function(){if(this.gl){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,1);var t=e.createProgram(),n=["attribute highp vec4 aVertexPosition;","attribute vec2 aTextureCoord;","varying highp vec2 vTextureCoord;","void main(void) {"," gl_Position = aVertexPosition;"," vTextureCoord = aTextureCoord;","}"].join("\n"),i=e.createShader(e.VERTEX_SHADER);e.shaderSource(i,n),e.compileShader(i);var r=["precision highp float;","varying lowp vec2 vTextureCoord;","uniform sampler2D YTexture;","uniform sampler2D UTexture;","uniform sampler2D VTexture;","const mat4 YUV2RGB = mat4","("," 1.1643828125, 0, 1.59602734375, -.87078515625,"," 1.1643828125, -.39176171875, -.81296875, .52959375,"," 1.1643828125, 2.017234375, 0, -1.081390625,"," 0, 0, 0, 1",");","void main(void) {"," gl_FragColor = vec4( texture2D(YTexture, vTextureCoord).x, texture2D(UTexture, vTextureCoord).x, texture2D(VTexture, vTextureCoord).x, 1) * YUV2RGB;","}"].join("\n"),s=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(s,r),e.compileShader(s),e.attachShader(t,i),e.attachShader(t,s),e.linkProgram(t),e.useProgram(t),e.getProgramParameter(t,e.LINK_STATUS)||console.log("[ER] Shader link failed.");var a=e.getAttribLocation(t,"aVertexPosition");e.enableVertexAttribArray(a);var o=e.getAttribLocation(t,"aTextureCoord");e.enableVertexAttribArray(o),this.verticesBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.verticesBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0]),e.STATIC_DRAW),e.vertexAttribPointer(a,3,e.FLOAT,!1,0,0),this.texCoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texCoordBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),e.STATIC_DRAW),e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0),e.y=new pe(e),e.u=new pe(e),e.v=new pe(e),e.y.bind(0,t,"YTexture"),e.u.bind(1,t,"UTexture"),e.v.bind(2,t,"VTexture")}else console.log("[ER] WebGL not supported.")}},{key:"renderFrame",value:function(e,t,n,i,r){if(this.gl){var s=this.gl;s.viewport(0,0,s.canvas.width,s.canvas.height),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),s.y.fill(t,n,e.subarray(0,i)),s.u.fill(t>>1,n>>1,e.subarray(i,i+r)),s.v.fill(t>>1,n>>1,e.subarray(i+r,e.length)),s.drawArrays(s.TRIANGLE_STRIP,0,4)}else console.log("[ER] Render frame failed due to WebGL not supported.")}},{key:"fullscreen",value:function(){var e=this.canvas;e.RequestFullScreen?e.RequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():alert("This browser doesn't supporter fullscreen")}},{key:"exitfullscreen",value:function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():alert("Exit fullscreen doesn't work")}},{key:"destroy",value:function(){if(this.gl){var e=this.gl;e.bufferData(e.ARRAY_BUFFER,1,e.STATIC_DRAW),e.deleteBuffer(this.verticesBuffer),e.deleteBuffer(this.texCoordBuffer),e.deleteTexture(e.y.texture),e.deleteTexture(e.u.texture),e.deleteTexture(e.v.texture),e.getExtension("WEBGL_lose_context").loseContext()}else console.log("[ER] Render frame failed due to WebGL not supported.")}}]),e}(),ye=function(){function e(n,i){var r=this;t(this,e),this.flv=n,this.decoder=i,this.videoTime=0,this.duration=n.options.duration,this.webglPlayer=new me(n.player.$canvas,{preserveDrawingBuffer:!0}),n.on("setVideoParam",(function(e){r.setVideoParam(e)})),n.on("destroy",(function(){r.webglPlayer.destroy(),r.webglPlayer.gl=null,r.webglPlayer=null}))}return s(e,[{key:"setVideoParam",value:function(e){if(e){if(this.scripMeta={width:e.w,height:e.h,duration:e.d/1e3,pixFmt:e.p},!this.flv.options.live){if(0===this.flv.options.duration){var t=this.flv.options.url;e.d?this.duration=e.d/1e3:this.duration=ce()(t.slice(-19)).unix()-ce()(t.slice(-39,-20)).unix()}this.flv.emit("updateDuration",this.duration)}this.pFmixt=e.p,this.videoWidth=e.w,this.videoHeight=e.h,this.yLength=this.videoWidth*this.videoHeight,this.uvLength=this.videoWidth/2*(this.videoHeight/2),console.log("videoWidth:",this.videoWidth,"videoHeight:",this.videoHeight),this.flv.emit("scripMeta",this.scripMeta)}}},{key:"renderVideoFrame",value:function(e){this.webglPlayer&&this.webglPlayer.renderFrame(e,this.videoWidth,this.videoHeight,this.yLength,this.uvLength)}},{key:"displayVideoFrame",value:function(e){var t=new Uint8Array(e.d);return this.renderVideoFrame(t),this.flv.options.live||this.flv.emit("timeupdate",e.p),!0}}]),e}(),ve=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(e){clearTimeout(e)},_e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)},ge={SN:"0",Ack:"0",FC:"FC_WS_STREAM_HEARTBEAT"},be=function(){function e(n){var i=this;t(this,e),this.flv=n,this.playing=!1,this.waiting=!1,this.animationFrameTimer=null,this.currentTime=0,this.esLen=0,this.esAudioLen=0,this.decodeInterval=0,this.chunkSize=524288,this.frameBufferVideo=[],this.frameBufferAudio=[],this.wsStatus=2,this.isInitDecoder=!1,this.seeking=!1,this.isConnect=!1,this.intervalHeartbeat=null,this.fps=30,this.lastTime=0,this.reconnectTimer=null,this.isDestroy=!1,this.lastRednerTime=0,this.speed=n.options.speed||1,this.slowSpeed=!1,this.correct=0,this.wsMessageOne=!0,this.speeds=he,this.autoPlay=null==n.options.autoPlay||n.options.autoPlay,this.slice=30,this.hasFlow=!1,this.maxBufferTimeLength=1,this.beginTimeOffset=0,this.wsCount=0,this.isUserClose=!1,this.initDecodeWorker(),this.audio=new fe(n,this),this.video=new ye(n,this),this.record=new T(n,this),n.on("destroy",(function(){console.log("------decoder destroy--------"),n.options.live||clearInterval(i.intervalHeartbeat),i.destroy()})),n.on("timeupdate",(function(e){i.currentTime=e,!n.options.live&&e>=n.player.duration&&(n.options.loop?i.seeked(0):n.emit("ended"))})),n.on("ended",(function(){i.pause()})),n.on("ready",(function(){i.readyed=!0})),n.on("seekedTo",(function(e){null!=e&&i.seeked(e)}));var r=!1;n.events.proxy(document,"visibilitychange",(function(){document.hidden||"hidden"===document.visibilityState?(r=i.playing,i.pause()):r&&(n.options.live||i.isConnect?i.play():(i.autoPlay=!0,i.requestStream()))})),this.initDecoder(),n.options.live||this.requestStream(),this.displayLoop=this.displayLoop.bind(this)}return s(e,[{key:"getBufferTimerLength",value:function(){if(!this.frameBuffer||0==this.frameBuffer.length)return 0;var e=this.frameBuffer[0];return this.frameBuffer[this.frameBuffer.length-1].s-e.s}},{key:"destroy",value:function(){this.isUserClose=!0,this.ws&&this.ws.close(),ve(this.animationFrameTimer),this.animationFrameTimer=null,this.playing=!1,this.pauseDecoding(),this.unitDecoder(),this.decodeWorker&&this.decodeWorker.terminate()}},{key:"flow",value:function(e){var t=this;return new Promise((function(n,i){t.flv.options.live?(t.isUserClose=!0,t.ws&&t.ws.close(),t.ws=null,t.unitDecoder(),t.initDecoder(),t.flv.options.url=t.flv.options.url.slice(0,-1)+e,t.requestStream().then((function(t){n(e)}),(function(e){i(e)})).catch((function(e){}))):i("当前不是预览流，无法切换主子流！")})).catch((function(e){}))}},{key:"setTimes",value:function(e,t,n){var i=this;return new Promise((function(r,s){if(i.flv.options.live)s("当前不是回放流，无法重设时间！");else{i.currentTime=0,i.autoPlay=n||!0,i.playing=n||!0,i.wsStatus=2;var a=i.flv.options.url.slice(0,-40);i.flv.decoder.video.duration=ce()(t).unix()-ce()(e).unix(),i.flv.options.url="".concat(a,"/").concat(e,"/").concat(t),i.flv.emit("ended"),i.isUserClose=!0,i.ws&&i.ws.close(),i.ws=null,i.requestStream().then((function(e){r(n)}),(function(e){s(e)})).catch((function(e){}))}})).catch((function(e){}))}},{key:"initDecoder",value:function(){this.decodeWorker.postMessage({t:0,s:0,c:this.chunkSize}),this.decodeWorker.postMessage({t:8,i:this.flv.options.hasAudio?1:0})}},{key:"unitDecoder",value:function(){this.isUserClose=!0,this.ws&&this.ws.close(),this.ws=null,this.decodeWorker.postMessage({t:3}),this.decodeWorker.postMessage({t:1})}},{key:"play",value:function(){var e=this;if(this.playing=!0,this.flv.options.live)this.isInitDecoder||this.initDecoder(),this.requestStream(),this.startDecoding(),this.displayLoop(),this.flv.emit("play");else{if(!this.isInitDecoder)return;this.isConnect?this.recodPlay():this.flv.isDestroy||(this.isUserClose=!0,this.ws&&this.ws.close(),this.ws=null,this.requestStream().then((function(t){e.recodPlay()})))}}},{key:"recodPlay",value:function(){this.esContinue(),this.decodeWorker.postMessage({t:9}),this.setSpeed(this.speed),this.basePlay()}},{key:"recodPause",value:function(){this.esPause(),this.decodeWorker.postMessage({t:10}),this.basePause()}},{key:"esContinue",value:function(){this.isConnect&&(this.ws.send(JSON.stringify({SN:"1",Ack:"0",FC:"FC_WS_STREAM_CONTINUE",param:{}})),this.wsStatus=1,this.startDecoding())}},{key:"esPause",value:function(){this.isConnect&&(this.ws.send(JSON.stringify({SN:"2",Ack:"0",FC:"FC_WS_STREAM_PAUSE",param:{}})),this.wsStatus=2,this.pauseDecoding())}},{key:"basePlay",value:function(){this.playing=!0,this.displayLoop(),this.flv.emit("play")}},{key:"basePause",value:function(){this.playing=!1,ve(this.animationFrameTimer),this.animationFrameTimer=null,this.flv.emit("pause")}},{key:"pause",value:function(){this.isInitDecoder&&(this.flv.options.live?(this.unitDecoder(),this.basePause()):this.isConnect?this.recodPause():this.basePause())}},{key:"setSpeed",value:function(e,t){"number"==typeof e&&(this.flv.options.live||(t||(this.speed=e),1===this.wsStatus&&(this.isConnect&&this.ws&&this.ws.send(JSON.stringify({SN:"4",Ack:"0",FC:"FC_WS_STREAM_FORWARD",param:{speed:e}})),1!=t&&0!=t&&this.decodeWorker.postMessage({t:11,speed:e}))))}},{key:"seekto",value:function(e){this.isConnect&&this.ws&&this.ws.send(JSON.stringify({SN:"3",Ack:"0",FC:"FC_WS_STREAM_SEEK",param:{time_pos:1e3*e}})),this.decodeWorker.postMessage({t:7,ms:1e3*e}),this.decodeWorker.postMessage({t:16}),this.beginTimeOffset=e,this.flv.emit("restartAudio",e)}},{key:"seeked",value:function(e){var t=this;this.flv.options.live||(this.currentTime=e,console.log("进度条拖动至："+e,this.isConnect),this.isConnect?this.seekto(e):(this.isUserClose=!0,this.ws&&this.ws.close(),this.ws=null,this.requestStream().then((function(n){t.recodPlay(),t.seekto(e)}))))}},{key:"onSeekToRsp",value:function(e){this.seeking=!1}},{key:"onInitDecoder",value:function(e){this.flv.debug.log("Init decoder response "+e.e+"."),this.isInitDecoder=!0,this.flv.options.live&&(console.log("onInitDecoder emit ready"),this.autoPlay&&this.play())}},{key:"onUnInitDecoder",value:function(e){this.flv.debug.log("UnInit decoder response "+e.e+"."),this.isInitDecoder=!1}},{key:"onOpenDecoder",value:function(e){2===e.t&&(this.flv.debug.log("Open decoder response "+e.e+"."),this.flv.emit("setVideoParam",e.v),this.flv.emit("setAudioParam",e.a))}},{key:"startDecoding",value:function(){var e={t:5,i:this.decodeInterval};this.decodeWorker.postMessage(e),this.decoding=!0}},{key:"pauseDecoding",value:function(){this.decodeWorker.postMessage({t:6}),this.decoding=!1}},{key:"onVideoFrame",value:function(e){this.bufferFrame(e)}},{key:"onAudioFrame",value:function(e){this.frameBufferAudio.push(e)}},{key:"bufferFrame",value:function(e){this.decoding&&(this.frameBufferVideo.push(e),this.frameBufferVideo.length>=2&&this.pauseDecoding(),this.esLen>200&&!this.flv.options.live&&this.speed>.5&&!this.slowSpeed&&(this.slowSpeed=!0,this.setSpeed(.5,!0),console.log("慢放开始")))}},{key:"displayLoop",value:function(e){if(!this.playing)return ve(this.animationFrameTimer),!1;this.animationFrameTimer=_e(this.displayLoop),this.frameBufferVideo.length<2&&this.startDecoding(),0!=this.frameBufferVideo.length&&(this.frameBufferAudio,this.frameBufferVideo,this.frameBufferAudio[0]&&this.audio.displayAudioFrame(this.frameBufferAudio[0])&&this.frameBufferAudio.shift(),this.frameBufferVideo[0]&&this.video.displayVideoFrame(this.frameBufferVideo[0])&&this.frameBufferVideo.shift(),this.esLen<100&&!this.flv.options.live&&this.slowSpeed&&(this.slowSpeed=!1,this.setSpeed(this.speed,!1),console.log("慢放结束")))}},{key:"onDecodeFinished",value:function(e){}},{key:"requestStream",value:function(){var e=this;return this.isUserClose=!1,new Promise((function(t,n){e.createWebSocket().then((function(n){t(),e.flv.options.live||e.heartBeat()}),(function(e){n()}))})).catch((function(e){}))}},{key:"createWebSocket",value:function(){var e=this;return new Promise((function(t,n){if(e.ws)n();else try{e.ws=new WebSocket(e.flv.options.url),e.ws.binaryType="arraybuffer",e.wsCount++,e.ws.count=e.wsCount,e.initWebsocket().then((function(e){t()}))}catch(t){console.log("尝试创建连接失败",t),e.flv.isDestroy}})).catch((function(e){}))}},{key:"initWebsocket",value:function(){var e=this;return new Promise((function(t,n){var i;e.ws.onopen=function(t){e.isConnect=!0,e.wsMessageOne=!0,console.log("websocket isConnect connected",e.isConnect),e.flv.debug.log("ws connected."),!e.flv.options.live&&e.playing&&e.play()},e.ws.onerror=function(t){e.isConnect=!1,console.log("websocket isConnect onerror",t),e.flv.debug.log("ws connect error "+t.data)},e.ws.onclose=function(t){t.currentTarget.count==e.wsCount&&(e.isConnect=!1,e.hasFlow=!1,e.flv.options.live||(e.pause(),clearInterval(e.intervalHeartbeat)),e.flv.debug.log("ws connect close "),e.record.writed&&e.record.stop(!0),e.isUserClose?e.flv.emit("close",1):e.flv.emit("close",0))};var r=null;e.ws.onmessage=function(s){var a=new Uint8Array(s.data);if(e.wsMessageOne){i=(i=new TextDecoder("utf-8").decode(a)).replace(/\s\u0000/g,"");try{var o=JSON.parse(i);console.log("errorID:",o.param.errorID,"errorDesc:",o.param.errorDesc),0===o.param.errorID?(e.flv.options.live||(console.log("----------ready recodPlay autoPlay----------",e.autoPlay),e.autoPlay&&(clearTimeout(r),r=setTimeout((function(){e.recodPlay()})))),t()):(e.flv.emit("error",o.param.errorID),n())}catch(e){n(),console.log(e)}e.wsMessageOne=!1}if(e.playing&&!e.wsMessageOne){if(!e.hasFlow){i=(i=new TextDecoder("utf-8").decode(a)).replace(/\s\u0000/g,"");try{JSON.parse(i)}catch(t){e.flv.emit("ready"),e.hasFlow=!0}}e.record.writed&&e.record.onMessage(new Blob([s.data],{type:"video/mp4"})),e.seeking=!1;var l=a.byteLength,u=0;if(l>e.chunkSize)do{var c=Math.min(e.chunkSize,l),h=a.buffer.slice(u,u+c);l-=c,u+=c;var d={t:4,d:h};e.decodeWorker.postMessage(d,[d.d])}while(l>0);else d={t:4,d:a.buffer},e.decodeWorker.postMessage(d,[d.d])}}})).catch((function(e){}))}},{key:"heartBeat",value:function(){var e=this;this.intervalHeartbeat=setInterval((function(){e.isConnect&&e.ws&&e.ws.send(JSON.stringify(ge))}),5e3)}},{key:"downloadFile",value:function(e,t){var n=document.createElement("a"),i=this.base64ToBlob(t);document.createEvent("HTMLEvents").initEvent("click",!0,!0),n.download=e,n.href=URL.createObjectURL(i),n.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))}},{key:"base64ToBlob",value:function(e){for(var t=e.split(";base64,"),n=t[0].split(":")[1],i=window.atob(t[1]),r=i.length,s=new Uint8Array(r),a=0;a<r;++a)s[a]=i.charCodeAt(a);return new Blob([s],{type:n})}},{key:"initDecodeWorker",value:function(){var e=this;this.flv.options.decoderURL&&(this.decodeWorker=new Worker(this.flv.options.decoderURL),this.decodeWorker.onmessage=function(t){var n=t.data;switch(n.t){case 0:e.onInitDecoder(n);break;case 1:e.onUnInitDecoder(n);break;case 2:e.onOpenDecoder(n);break;case 4:e.onVideoFrame(n);break;case 5:e.onAudioFrame(n);break;case 8:e.onDecodeFinished(n);break;case 9:e.onRequestData(n.o,n.a);break;case 10:e.onSeekToRsp(n.r);break;case 11:e.downfile=self.appendBuffer(self.downfile,n.d);break;case 12:break;case 13:e.esLen=n.l;break;case 15:e.esAudioLen=n.l}})}}]),e}(),we=function(){function e(){t(this,e)}return s(e,null,[{key:"install",value:function(){Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Object.assign=Object.assign||function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r])}return t},"function"!=typeof self.Promise&&n(641).polyfill()}}]),e}();we.install();const ke=we;var Se=n(343),Ee=n.n(Se),Ae=function(){function e(){t(this,e)}return s(e,null,[{key:"e",value:function(t,n){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="[".concat(t,"] > ").concat(n);e.ENABLE_CALLBACK&&e.emitter.emit("log","error",i),e.ENABLE_ERROR&&(console.error?console.error(i):console.warn?console.warn(i):console.log(i))}},{key:"i",value:function(t,n){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="[".concat(t,"] > ").concat(n);e.ENABLE_CALLBACK&&e.emitter.emit("log","info",i),e.ENABLE_INFO&&(console.info?console.info(i):console.log(i))}},{key:"w",value:function(t,n){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="[".concat(t,"] > ").concat(n);e.ENABLE_CALLBACK&&e.emitter.emit("log","warn",i),e.ENABLE_WARN&&(console.warn?console.warn(i):console.log(i))}},{key:"d",value:function(t,n){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="[".concat(t,"] > ").concat(n);e.ENABLE_CALLBACK&&e.emitter.emit("log","debug",i),e.ENABLE_DEBUG&&(console.debug?console.debug(i):console.log(i))}},{key:"v",value:function(t,n){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="[".concat(t,"] > ").concat(n);e.ENABLE_CALLBACK&&e.emitter.emit("log","verbose",i),e.ENABLE_VERBOSE&&console.log(i)}}]),e}();Ae.GLOBAL_TAG="flv.js",Ae.FORCE_GLOBAL_TAG=!1,Ae.ENABLE_ERROR=!0,Ae.ENABLE_INFO=!0,Ae.ENABLE_WARN=!0,Ae.ENABLE_DEBUG=!0,Ae.ENABLE_VERBOSE=!0,Ae.ENABLE_CALLBACK=!1,Ae.emitter=new(Ee());const Le=Ae,Ce=function(){function e(){t(this,e),this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return s(e,[{key:"reset",value:function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0}},{key:"addBytes",value:function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())}},{key:"currentKBps",get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0==e&&(e=1),this._intervalBytes/e/1024}},{key:"lastSecondKBps",get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0}},{key:"averageKBps",get:function(){var e=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/e/1024}}]),e}();function Te(e){return function(){var t,n=P(e);if(xe()){var i=P(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return M(this,t)}}function xe(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Re=function(){function e(n){t(this,e),this._message=n}return s(e,[{key:"toString",value:function(){return this.name+": "+this.message}},{key:"name",get:function(){return"RuntimeException"}},{key:"message",get:function(){return this._message}}]),e}(),De=function(e){D(i,e);var n=Te(i);function i(e){return t(this,i),n.call(this,e)}return s(i,[{key:"name",get:function(){return"IllegalStateException"}}]),i}(Re),Oe=function(e){D(i,e);var n=Te(i);function i(e){return t(this,i),n.call(this,e)}return s(i,[{key:"name",get:function(){return"InvalidArgumentException"}}]),i}(Re),Me=function(e){D(i,e);var n=Te(i);function i(e){return t(this,i),n.call(this,e)}return s(i,[{key:"name",get:function(){return"NotImplementedException"}}]),i}(Re),Pe={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},Be={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},Ie=function(){function e(n){t(this,e),this._type=n||"undefined",this._status=Pe.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return s(e,[{key:"destroy",value:function(){this._status=Pe.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}},{key:"isWorking",value:function(){return this._status===Pe.kConnecting||this._status===Pe.kBuffering}},{key:"open",value:function(e,t){throw new Me("Unimplemented abstract function!")}},{key:"abort",value:function(){throw new Me("Unimplemented abstract function!")}},{key:"type",get:function(){return this._type}},{key:"status",get:function(){return this._status}},{key:"needStashBuffer",get:function(){return this._needStash}},{key:"onContentLengthKnown",get:function(){return this._onContentLengthKnown},set:function(e){this._onContentLengthKnown=e}},{key:"onURLRedirect",get:function(){return this._onURLRedirect},set:function(e){this._onURLRedirect=e}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onComplete",get:function(){return this._onComplete},set:function(e){this._onComplete=e}}]),e}();function Ue(e,t,n){return(Ue="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=P(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}var Fe={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],n=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],i={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:n[0]||""},r={};if(i.browser){r[i.browser]=!0;var s=i.majorVersion.split(".");r.version={major:parseInt(i.majorVersion,10),string:i.version},s.length>1&&(r.version.minor=parseInt(s[1],10)),s.length>2&&(r.version.build=parseInt(s[2],10))}if(i.platform&&(r[i.platform]=!0),(r.chrome||r.opr||r.safari)&&(r.webkit=!0),r.rv||r.iemobile){r.rv&&delete r.rv;i.browser="msie",r.msie=!0}if(r.edge){delete r.edge;i.browser="msedge",r.msedge=!0}if(r.opr){i.browser="opera",r.opera=!0}if(r.safari&&r.android){i.browser="android",r.android=!0}for(var a in r.name=i.browser,r.platform=i.platform,Fe)Fe.hasOwnProperty(a)&&delete Fe[a];Object.assign(Fe,r)}();const Ne=Fe;function je(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}const ze=function(e){D(r,e);var n,i=(n=r,function(){var e,t=P(n);if(je()){var i=P(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return M(this,e)});function r(e,n){var s;return t(this,r),(s=i.call(this,"fetch-stream-loader")).TAG="FetchStreamLoader",s._seekHandler=e,s._config=n,s._needStash=!0,s._requestAbort=!1,s._contentLength=null,s._receivedLength=0,s}return s(r,null,[{key:"isSupported",value:function(){try{var e=Ne.msedge&&Ne.version.minor>=15048,t=!Ne.msedge||e;return self.fetch&&self.ReadableStream&&t}catch(e){return!1}}}]),s(r,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),Ue(P(r.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){var n=this;this._dataSource=e,this._range=t;var i=e.url;this._config.reuseRedirectedURL&&null!=e.redirectedURL&&(i=e.redirectedURL);var r=this._seekHandler.getConfig(i,t),s=new self.Headers;if("object"===l(r.headers)){var a=r.headers;for(var o in a)a.hasOwnProperty(o)&&s.append(o,a[o])}var u={method:"GET",headers:s,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if("object"===l(this._config.headers))for(var c in this._config.headers)s.append(c,this._config.headers[c]);!1===e.cors&&(u.mode="same-origin"),e.withCredentials&&(u.credentials="include"),e.referrerPolicy&&(u.referrerPolicy=e.referrerPolicy),this._status=Pe.kConnecting,self.fetch(r.url,u).then((function(e){if(n._requestAbort)return n._requestAbort=!1,void(n._status=Pe.kIdle);if(e.ok&&e.status>=200&&e.status<=299){if(e.url!==r.url&&n._onURLRedirect){var t=n._seekHandler.removeURLParameters(e.url);n._onURLRedirect(t)}var i=e.headers.get("Content-Length");return null!=i&&(n._contentLength=parseInt(i),0!==n._contentLength&&n._onContentLengthKnown&&n._onContentLengthKnown(n._contentLength)),n._pump.call(n,e.body.getReader())}if(n._status=Pe.kError,!n._onError)throw new Re("FetchStreamLoader: Http code invalid, "+e.status+" "+e.statusText);n._onError(Be.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})})).catch((function(e){if(n._status=Pe.kError,!n._onError)throw e;n._onError(Be.EXCEPTION,{code:-1,msg:e.message})}))}},{key:"abort",value:function(){this._requestAbort=!0}},{key:"_pump",value:function(e){var t=this;return e.read().then((function(n){if(n.done)if(null!==t._contentLength&&t._receivedLength<t._contentLength){t._status=Pe.kError;var i=Be.EARLY_EOF,r={code:-1,msg:"Fetch stream meet Early-EOF"};if(!t._onError)throw new Re(r.msg);t._onError(i,r)}else t._status=Pe.kComplete,t._onComplete&&t._onComplete(t._range.from,t._range.from+t._receivedLength-1);else{if(!0===t._requestAbort)return t._requestAbort=!1,t._status=Pe.kComplete,e.cancel();t._status=Pe.kBuffering;var s=n.value.buffer,a=t._range.from+t._receivedLength;t._receivedLength+=s.byteLength,t._onDataArrival&&t._onDataArrival(s,a,t._receivedLength),t._pump(e)}})).catch((function(e){if(11!==e.code||!Ne.msedge){t._status=Pe.kError;var n=0,i=null;if(19!==e.code&&"network error"!==e.message||!(null===t._contentLength||null!==t._contentLength&&t._receivedLength<t._contentLength)?(n=Be.EXCEPTION,i={code:e.code,msg:e.message}):(n=Be.EARLY_EOF,i={code:e.code,msg:"Fetch stream meet Early-EOF"}),!t._onError)throw new Re(i.msg);t._onError(n,i)}}))}}]),r}(Ie);function $e(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}const Ve=function(e){D(r,e);var n,i=(n=r,function(){var e,t=P(n);if($e()){var i=P(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return M(this,e)});function r(e,n){var s;return t(this,r),(s=i.call(this,"xhr-moz-chunked-loader")).TAG="MozChunkedLoader",s._seekHandler=e,s._config=n,s._needStash=!0,s._xhr=null,s._requestAbort=!1,s._contentLength=null,s._receivedLength=0,s}return s(r,null,[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(e){return Le.w("MozChunkedLoader",e.message),!1}}}]),s(r,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),Ue(P(r.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._dataSource=e,this._range=t;var n=e.url;this._config.reuseRedirectedURL&&null!=e.redirectedURL&&(n=e.redirectedURL);var i=this._seekHandler.getConfig(n,t);this._requestURL=i.url;var r=this._xhr=new XMLHttpRequest;if(r.open("GET",i.url,!0),r.responseType="moz-chunked-arraybuffer",r.onreadystatechange=this._onReadyStateChange.bind(this),r.onprogress=this._onProgress.bind(this),r.onloadend=this._onLoadEnd.bind(this),r.onerror=this._onXhrError.bind(this),e.withCredentials&&(r.withCredentials=!0),"object"===l(i.headers)){var s=i.headers;for(var a in s)s.hasOwnProperty(a)&&r.setRequestHeader(a,s[a])}if("object"===l(this._config.headers)){var o=this._config.headers;for(var u in o)o.hasOwnProperty(u)&&r.setRequestHeader(u,o[u])}this._status=Pe.kConnecting,r.send()}},{key:"abort",value:function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=Pe.kComplete}},{key:"_onReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState){if(null!=t.responseURL&&t.responseURL!==this._requestURL&&this._onURLRedirect){var n=this._seekHandler.removeURLParameters(t.responseURL);this._onURLRedirect(n)}if(0!==t.status&&(t.status<200||t.status>299)){if(this._status=Pe.kError,!this._onError)throw new Re("MozChunkedLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(Be.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}else this._status=Pe.kBuffering}}},{key:"_onProgress",value:function(e){if(this._status!==Pe.kError){null===this._contentLength&&null!==e.total&&0!==e.total&&(this._contentLength=e.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var t=e.target.response,n=this._range.from+this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,n,this._receivedLength)}}},{key:"_onLoadEnd",value:function(e){!0!==this._requestAbort?this._status!==Pe.kError&&(this._status=Pe.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1}},{key:"_onXhrError",value:function(e){this._status=Pe.kError;var t=0,n=null;if(this._contentLength&&e.loaded<this._contentLength?(t=Be.EARLY_EOF,n={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(t=Be.EXCEPTION,n={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new Re(n.msg);this._onError(t,n)}}]),r}(Ie);function Ge(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}const We=function(e){D(r,e);var n,i=(n=r,function(){var e,t=P(n);if(Ge()){var i=P(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return M(this,e)});function r(e,n){var s;return t(this,r),(s=i.call(this,"xhr-range-loader")).TAG="RangeLoader",s._seekHandler=e,s._config=n,s._needStash=!1,s._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],s._currentChunkSizeKB=384,s._currentSpeedNormalized=0,s._zeroSpeedChunkCount=0,s._xhr=null,s._speedSampler=new Ce,s._requestAbort=!1,s._waitForTotalLength=!1,s._totalLengthReceived=!1,s._currentRequestURL=null,s._currentRedirectedURL=null,s._currentRequestRange=null,s._totalLength=null,s._contentLength=null,s._receivedLength=0,s._lastTimeLoaded=0,s}return s(r,null,[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="arraybuffer","arraybuffer"===e.responseType}catch(e){return Le.w("RangeLoader",e.message),!1}}}]),s(r,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),Ue(P(r.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._dataSource=e,this._range=t,this._status=Pe.kConnecting;var n=!1;null!=this._dataSource.filesize&&0!==this._dataSource.filesize&&(n=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||n?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))}},{key:"_openSubRange",value:function(){var e=1024*this._currentChunkSizeKB,t=this._range.from+this._receivedLength,n=t+e;null!=this._contentLength&&n-this._range.from>=this._contentLength&&(n=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:n},this._internalOpen(this._dataSource,this._currentRequestRange)}},{key:"_internalOpen",value:function(e,t){this._lastTimeLoaded=0;var n=e.url;this._config.reuseRedirectedURL&&(null!=this._currentRedirectedURL?n=this._currentRedirectedURL:null!=e.redirectedURL&&(n=e.redirectedURL));var i=this._seekHandler.getConfig(n,t);this._currentRequestURL=i.url;var r=this._xhr=new XMLHttpRequest;if(r.open("GET",i.url,!0),r.responseType="arraybuffer",r.onreadystatechange=this._onReadyStateChange.bind(this),r.onprogress=this._onProgress.bind(this),r.onload=this._onLoad.bind(this),r.onerror=this._onXhrError.bind(this),e.withCredentials&&(r.withCredentials=!0),"object"===l(i.headers)){var s=i.headers;for(var a in s)s.hasOwnProperty(a)&&r.setRequestHeader(a,s[a])}if("object"===l(this._config.headers)){var o=this._config.headers;for(var u in o)o.hasOwnProperty(u)&&r.setRequestHeader(u,o[u])}r.send()}},{key:"abort",value:function(){this._requestAbort=!0,this._internalAbort(),this._status=Pe.kComplete}},{key:"_internalAbort",value:function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)}},{key:"_onReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState){if(null!=t.responseURL){var n=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&n!==this._currentRedirectedURL&&(this._currentRedirectedURL=n,this._onURLRedirect&&this._onURLRedirect(n))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=Pe.kBuffering}else{if(this._status=Pe.kError,!this._onError)throw new Re("RangeLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(Be.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}}}},{key:"_onProgress",value:function(e){if(this._status!==Pe.kError){if(null===this._contentLength){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var n=e.total;this._internalAbort(),null!=n&0!==n&&(this._totalLength=n)}if(-1===this._range.to?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var i=e.loaded-this._lastTimeLoaded;this._lastTimeLoaded=e.loaded,this._speedSampler.addBytes(i)}}},{key:"_normalizeSpeed",value:function(e){var t=this._chunkSizeKBList,n=t.length-1,i=0,r=0,s=n;if(e<t[0])return t[0];for(;r<=s;){if((i=r+Math.floor((s-r)/2))===n||e>=t[i]&&e<t[i+1])return t[i];t[i]<e?r=i+1:s=i-1}}},{key:"_onLoad",value:function(e){if(this._status!==Pe.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(0===t&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps)),0!==t){var n=this._normalizeSpeed(t);this._currentSpeedNormalized!==n&&(this._currentSpeedNormalized=n,this._currentChunkSizeKB=n)}var i=e.target.response,r=this._range.from+this._receivedLength;this._receivedLength+=i.byteLength;var s=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():s=!0,this._onDataArrival&&this._onDataArrival(i,r,this._receivedLength),s&&(this._status=Pe.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}}},{key:"_onXhrError",value:function(e){this._status=Pe.kError;var t=0,n=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=Be.EARLY_EOF,n={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=Be.EXCEPTION,n={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new Re(n.msg);this._onError(t,n)}},{key:"currentSpeed",get:function(){return this._speedSampler.lastSecondKBps}}]),r}(Ie);function He(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}const qe=function(e){D(r,e);var n,i=(n=r,function(){var e,t=P(n);if(He()){var i=P(this).constructor;e=Reflect.construct(t,arguments,i)}else e=t.apply(this,arguments);return M(this,e)});function r(e,n){var s;return t(this,r),(s=i.call(this,"websocket-loader")).TAG="WebSocketLoader",s._config=n,s._decoder=n.decoder,s._needStash=!0,s._wsFrist=!0,s._ws=null,s._requestAbort=!1,s._receivedLength=0,s._header=new Uint8Array,s._sendHead=!1,s._headCount=0,s._decoder.record.stopEvent=s.recordStopEvent.bind(O(s)),s}return s(r,null,[{key:"isSupported",value:function(){try{return void 0!==self.WebSocket}catch(e){return!1}}}]),s(r,[{key:"destroy",value:function(){this._ws&&this.abort(),Ue(P(r.prototype),"destroy",this).call(this)}},{key:"recordStartEvent",value:function(){}},{key:"recordStopEvent",value:function(){this._sendHead=!1}},{key:"appendBuffer",value:function(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer}},{key:"open",value:function(e){try{var t=this._ws=new self.WebSocket(e.url);t.binaryType="arraybuffer",t.onopen=this._onWebSocketOpen.bind(this),t.onclose=this._onWebSocketClose.bind(this),t.onmessage=this._onWebSocketMessage.bind(this),t.onerror=this._onWebSocketError.bind(this),this._status=Pe.kConnecting}catch(e){this._status=Pe.kError;var n={code:e.code,msg:e.message};if(!this._onError)throw new Re(n.msg);this._onError(Be.EXCEPTION,n)}}},{key:"abort",value:function(){var e=this._ws;!e||0!==e.readyState&&1!==e.readyState||(this._requestAbort=!0,e.close()),this._ws=null,this._status=Pe.kComplete}},{key:"_onWebSocketOpen",value:function(e){this._wsFrist=!0,this._sendHead=!1,this._headCount=0,this._status=Pe.kBuffering,this._config.ioCallback&&this._config.ioCallback("open",this._ws)}},{key:"_onWebSocketClose",value:function(e){!0!==this._requestAbort?(this._status=Pe.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1}},{key:"_onWebSocketMessage",value:function(e){var t=this,n=this;if(n._wsFrist){try{var i=new Uint8Array(e.data),r=new TextDecoder("utf-8").decode(i);r=r.replace(/\s\u0000/g,"");var s=JSON.parse(r);n._config.ioCallback&&this._config.ioCallback("ready",s.param.errorID)}catch(e){console.log(e)}n._wsFrist=!1}else if(this._headCount<2&&(this._headCount++,this._header=this.appendBuffer(this._header,new Uint8Array(e.data)),console.log("this._header",this._header)),this._decoder.record.writed&&(this._sendHead?this._decoder.record.onMessage(new Blob([e.data],{type:"video/x-flv"})):(console.log("下载头部信息：",this._header),this._decoder.record.onMessage(new Blob([this._header],{type:"video/x-flv"})),this._sendHead=!0)),e.data instanceof ArrayBuffer)this._dispatchArrayBuffer(e.data);else if(e.data instanceof Blob){var a=new FileReader;a.onload=function(){t._dispatchArrayBuffer(a.result)},a.readAsArrayBuffer(e.data)}else{this._status=Pe.kError;var o={code:-1,msg:"Unsupported WebSocket message type: "+e.data.constructor.name};if(!this._onError)throw new Re(o.msg);this._onError(Be.EXCEPTION,o)}}},{key:"_dispatchArrayBuffer",value:function(e){var t=e,n=this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,n,this._receivedLength)}},{key:"appendBuffer",value:function(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n.buffer}},{key:"_onWebSocketError",value:function(e){this._status=Pe.kError;var t={code:e.code,msg:e.message};if(!this._onError)throw new Re(t.msg);this._onError(Be.EXCEPTION,t)}}]),r}(Ie),Ke=function(){function e(n){t(this,e),this._zeroStart=n||!1}return s(e,[{key:"getConfig",value:function(e,t){var n,i={};return 0!==t.from||-1!==t.to?(n=-1!==t.to?"bytes=".concat(t.from.toString(),"-").concat(t.to.toString()):"bytes=".concat(t.from.toString(),"-"),i.Range=n):this._zeroStart&&(i.Range="bytes=0-"),{url:e,headers:i}}},{key:"removeURLParameters",value:function(e){return e}}]),e}(),Ye=function(){function e(n,i){t(this,e),this._startName=n,this._endName=i}return s(e,[{key:"getConfig",value:function(e,t){var n=e;if(0!==t.from||-1!==t.to){var i=!0;-1===n.indexOf("?")&&(n+="?",i=!1),i&&(n+="&"),n+="".concat(this._startName,"=").concat(t.from.toString()),-1!==t.to&&(n+="&".concat(this._endName,"=").concat(t.to.toString()))}return{url:n,headers:{}}}},{key:"removeURLParameters",value:function(e){var t=e.split("?")[0],n=void 0,i=e.indexOf("?");-1!==i&&(n=e.substring(i+1));var r="";if(null!=n&&n.length>0)for(var s=n.split("&"),a=0;a<s.length;a++){var o=s[a].split("="),l=a>0;o[0]!==this._startName&&o[0]!==this._endName&&(l&&(r+="&"),r+=s[a])}return 0===r.length?t:t+"?"+r}}]),e}(),Xe=function(){function e(n,i,r){t(this,e),this.TAG="IOController",this._config=i,this._extraData=r,this._stashInitialSize=393216,null!=i.stashInitialSize&&i.stashInitialSize>0&&(this._stashInitialSize=i.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,!1===i.enableStashBuffer&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=n,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(n.url),this._refTotalLength=n.filesize?n.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new Ce,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return s(e,[{key:"destroy",value:function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null}},{key:"isWorking",value:function(){return this._loader&&this._loader.isWorking()&&!this._paused}},{key:"isPaused",value:function(){return this._paused}},{key:"_selectSeekHandler",value:function(){var e=this._config;if("range"===e.seekType)this._seekHandler=new Ke(this._config.rangeLoadZeroStart);else if("param"===e.seekType){var t=e.seekParamStart||"bstart",n=e.seekParamEnd||"bend";this._seekHandler=new Ye(t,n)}else{if("custom"!==e.seekType)throw new Oe("Invalid seekType in config: ".concat(e.seekType));if("function"!=typeof e.customSeekHandler)throw new Oe("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new e.customSeekHandler}}},{key:"_selectLoader",value:function(){if(null!=this._config.customLoader)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=qe;else if(ze.isSupported())this._loaderClass=ze;else if(Ve.isSupported())this._loaderClass=Ve;else{if(!We.isSupported())throw new Re("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=We}}},{key:"_createLoader",value:function(){this._loader=new this._loaderClass(this._seekHandler,this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)}},{key:"open",value:function(e){this._currentRange={from:0,to:-1},e&&(this._currentRange.from=e),this._speedSampler.reset(),e||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))}},{key:"abort",value:function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)}},{key:"pause",value:function(){this.isWorking()&&(this._loader.abort(),0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)}},{key:"resume",value:function(){if(this._paused){this._paused=!1;var e=this._resumeFrom;this._resumeFrom=0,this._internalSeek(e,!0)}}},{key:"seek",value:function(e){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(e,!0)}},{key:"_internalSeek",value:function(e,t){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(t),this._loader.destroy(),this._loader=null;var n={from:e,to:-1};this._currentRange={from:n.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,n),this._onSeeked&&this._onSeeked()}},{key:"updateUrl",value:function(e){if(!e||"string"!=typeof e||0===e.length)throw new Oe("Url must be a non-empty string!");this._dataSource.url=e}},{key:"_expandBuffer",value:function(e){for(var t=this._stashSize;t+1048576<e;)t*=2;if((t+=1048576)!==this._bufferSize){var n=new ArrayBuffer(t);if(this._stashUsed>0){var i=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(n,0,t).set(i,0)}this._stashBuffer=n,this._bufferSize=t}}},{key:"_normalizeSpeed",value:function(e){var t=this._speedNormalizeList,n=t.length-1,i=0,r=0,s=n;if(e<t[0])return t[0];for(;r<=s;){if((i=r+Math.floor((s-r)/2))===n||e>=t[i]&&e<t[i+1])return t[i];t[i]<e?r=i+1:s=i-1}}},{key:"_adjustStashSize",value:function(e){var t=0;(t=this._config.isLive||e<512?e:e>=512&&e<=1024?Math.floor(1.5*e):2*e)>8192&&(t=8192);var n=1024*t+1048576;this._bufferSize<n&&this._expandBuffer(n),this._stashSize=1024*t}},{key:"_dispatchChunks",value:function(e,t){return this._currentRange.to=t+e.byteLength-1,this._onDataArrival(e,t)}},{key:"_onURLRedirect",value:function(e){this._redirectedURL=e,this._onRedirect&&this._onRedirect(e)}},{key:"_onContentLengthKnown",value:function(e){e&&this._fullRequestFlag&&(this._totalLength=e,this._fullRequestFlag=!1)}},{key:"_onLoaderChunkArrival",value:function(e,t,n){if(!this._onDataArrival)throw new De("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(e.byteLength);var i=this._speedSampler.lastSecondKBps;if(0!==i){var r=this._normalizeSpeed(i);this._speedNormalized!==r&&(this._speedNormalized=r,this._adjustStashSize(r))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=t),this._stashUsed+e.byteLength<=this._stashSize)new Uint8Array(this._stashBuffer,0,this._stashSize).set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;else{var s=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var a=this._stashBuffer.slice(0,this._stashUsed),o=this._dispatchChunks(a,this._stashByteStart);if(o<a.byteLength){if(o>0){var l=new Uint8Array(a,o);s.set(l,0),this._stashUsed=l.byteLength,this._stashByteStart+=o}}else this._stashUsed=0,this._stashByteStart+=o;this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),s=new Uint8Array(this._stashBuffer,0,this._bufferSize)),s.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var u=this._dispatchChunks(e,t);if(u<e.byteLength){var c=e.byteLength-u;c>this._bufferSize&&(this._expandBuffer(c),s=new Uint8Array(this._stashBuffer,0,this._bufferSize)),s.set(new Uint8Array(e,u),0),this._stashUsed+=c,this._stashByteStart=t+u}}}else if(0===this._stashUsed){var h=this._dispatchChunks(e,t);if(h<e.byteLength){var d=e.byteLength-h;d>this._bufferSize&&this._expandBuffer(d),new Uint8Array(this._stashBuffer,0,this._bufferSize).set(new Uint8Array(e,h),0),this._stashUsed+=d,this._stashByteStart=t+h}}else{this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength);var f=new Uint8Array(this._stashBuffer,0,this._bufferSize);f.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;var p=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(p<this._stashUsed&&p>0){var m=new Uint8Array(this._stashBuffer,p);f.set(m,0)}this._stashUsed-=p,this._stashByteStart+=p}}}},{key:"_flushStashBuffer",value:function(e){if(this._stashUsed>0){var t=this._stashBuffer.slice(0,this._stashUsed),n=this._dispatchChunks(t,this._stashByteStart),i=t.byteLength-n;if(n<t.byteLength){if(!e){if(n>0){var r=new Uint8Array(this._stashBuffer,0,this._bufferSize),s=new Uint8Array(t,n);r.set(s,0),this._stashUsed=s.byteLength,this._stashByteStart+=n}return 0}Le.w(this.TAG,"".concat(i," bytes unconsumed data remain when flush buffer, dropped"))}return this._stashUsed=0,this._stashByteStart=0,i}return 0}},{key:"_onLoaderComplete",value:function(e,t){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)}},{key:"_onLoaderError",value:function(e,t){switch(Le.e(this.TAG,"Loader error, code = ".concat(t.code,", msg = ").concat(t.msg)),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,e=Be.UNRECOVERABLE_EARLY_EOF),e){case Be.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var n=this._currentRange.to+1;return void(n<this._totalLength&&(Le.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(n,!1)))}e=Be.UNRECOVERABLE_EARLY_EOF}if(!this._onError)throw new Re("IOException: "+t.msg);this._onError(e,t)}},{key:"status",get:function(){return this._loader.status}},{key:"extraData",get:function(){return this._extraData},set:function(e){this._extraData=e}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onSeeked",get:function(){return this._onSeeked},set:function(e){this._onSeeked=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onComplete",get:function(){return this._onComplete},set:function(e){this._onComplete=e}},{key:"onRedirect",get:function(){return this._onRedirect},set:function(e){this._onRedirect=e}},{key:"onRecoveredEarlyEof",get:function(){return this._onRecoveredEarlyEof},set:function(e){this._onRecoveredEarlyEof=e}},{key:"currentURL",get:function(){return this._dataSource.url}},{key:"hasRedirect",get:function(){return null!=this._redirectedURL||null!=this._dataSource.redirectedURL}},{key:"currentRedirectedURL",get:function(){return this._redirectedURL||this._dataSource.redirectedURL}},{key:"currentSpeed",get:function(){return this._loaderClass===We?this._loader.currentSpeed:this._speedSampler.lastSecondKBps}},{key:"loaderType",get:function(){return this._loader.type}}]),e}();var Je={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function Ze(){return Object.assign({},Je)}const Qe=function(){function e(){t(this,e)}return s(e,null,[{key:"supportMSEH264Playback",value:function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"supportNetworkStreamIO",value:function(){var e=new Xe({},Ze()),t=e.loaderType;return e.destroy(),"fetch-stream-loader"==t||"xhr-moz-chunked-loader"==t}},{key:"getNetworkLoaderTypeName",value:function(){var e=new Xe({},Ze()),t=e.loaderType;return e.destroy(),t}},{key:"supportNativeMediaPlayback",value:function(t){null==e.videoElement&&(e.videoElement=window.document.createElement("video"));var n=e.videoElement.canPlayType(t);return"probably"===n||"maybe"==n}},{key:"getFeatureList",value:function(){var t={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return t.mseFlvPlayback=e.supportMSEH264Playback(),t.networkStreamIO=e.supportNetworkStreamIO(),t.networkLoaderName=e.getNetworkLoaderTypeName(),t.mseLiveFlvPlayback=t.mseFlvPlayback&&t.networkStreamIO,t.nativeMP4H264Playback=e.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),t.nativeWebmVP8Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),t.nativeWebmVP9Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp9"'),t}}]),e}(),et={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};var tt=function(){function e(){t(this,e)}return s(e,null,[{key:"getConfig",value:function(){return{globalTag:Le.GLOBAL_TAG,forceGlobalTag:Le.FORCE_GLOBAL_TAG,enableVerbose:Le.ENABLE_VERBOSE,enableDebug:Le.ENABLE_DEBUG,enableInfo:Le.ENABLE_INFO,enableWarn:Le.ENABLE_WARN,enableError:Le.ENABLE_ERROR,enableCallback:Le.ENABLE_CALLBACK}}},{key:"applyConfig",value:function(e){Le.GLOBAL_TAG=e.globalTag,Le.FORCE_GLOBAL_TAG=e.forceGlobalTag,Le.ENABLE_VERBOSE=e.enableVerbose,Le.ENABLE_DEBUG=e.enableDebug,Le.ENABLE_INFO=e.enableInfo,Le.ENABLE_WARN=e.enableWarn,Le.ENABLE_ERROR=e.enableError,Le.ENABLE_CALLBACK=e.enableCallback}},{key:"_notifyChange",value:function(){var t=e.emitter;if(t.listenerCount("change")>0){var n=e.getConfig();t.emit("change",n)}}},{key:"registerListener",value:function(t){e.emitter.addListener("change",t)}},{key:"removeListener",value:function(t){e.emitter.removeListener("change",t)}},{key:"addLogListener",value:function(t){Le.emitter.addListener("log",t),Le.emitter.listenerCount("log")>0&&(Le.ENABLE_CALLBACK=!0,e._notifyChange())}},{key:"removeLogListener",value:function(t){Le.emitter.removeListener("log",t),0===Le.emitter.listenerCount("log")&&(Le.ENABLE_CALLBACK=!1,e._notifyChange())}},{key:"forceGlobalTag",get:function(){return Le.FORCE_GLOBAL_TAG},set:function(t){Le.FORCE_GLOBAL_TAG=t,e._notifyChange()}},{key:"globalTag",get:function(){return Le.GLOBAL_TAG},set:function(t){Le.GLOBAL_TAG=t,e._notifyChange()}},{key:"enableAll",get:function(){return Le.ENABLE_VERBOSE&&Le.ENABLE_DEBUG&&Le.ENABLE_INFO&&Le.ENABLE_WARN&&Le.ENABLE_ERROR},set:function(t){Le.ENABLE_VERBOSE=t,Le.ENABLE_DEBUG=t,Le.ENABLE_INFO=t,Le.ENABLE_WARN=t,Le.ENABLE_ERROR=t,e._notifyChange()}},{key:"enableDebug",get:function(){return Le.ENABLE_DEBUG},set:function(t){Le.ENABLE_DEBUG=t,e._notifyChange()}},{key:"enableVerbose",get:function(){return Le.ENABLE_VERBOSE},set:function(t){Le.ENABLE_VERBOSE=t,e._notifyChange()}},{key:"enableInfo",get:function(){return Le.ENABLE_INFO},set:function(t){Le.ENABLE_INFO=t,e._notifyChange()}},{key:"enableWarn",get:function(){return Le.ENABLE_WARN},set:function(t){Le.ENABLE_WARN=t,e._notifyChange()}},{key:"enableError",get:function(){return Le.ENABLE_ERROR},set:function(t){Le.ENABLE_ERROR=t,e._notifyChange()}}]),e}();tt.emitter=new(Ee());const nt=tt,it=function(){function e(){t(this,e),this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return s(e,[{key:"isComplete",value:function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&e&&t}},{key:"isSeekable",value:function(){return!0===this.hasKeyframesIndex}},{key:"getNearestKeyframe",value:function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,n=this._search(t.times,e);return{index:n,milliseconds:t.times[n],fileposition:t.filepositions[n]}}},{key:"_search",value:function(e,t){var n=0,i=e.length-1,r=0,s=0,a=i;for(t<e[0]&&(n=0,s=a+1);s<=a;){if((r=s+Math.floor((a-s)/2))===i||t>=e[r]&&t<e[r+1]){n=r;break}e[r]<t?s=r+1:a=r-1}return n}}]),e}();function rt(e,t,n){var i=e;if(t+n<i.length){for(;n--;)if(128!=(192&i[++t]))return!1;return!0}return!1}const st=function(e){for(var t=[],n=e,i=0,r=e.length;i<r;)if(n[i]<128)t.push(String.fromCharCode(n[i])),++i;else{if(n[i]<192);else if(n[i]<224){if(rt(n,i,1)){var s=(31&n[i])<<6|63&n[i+1];if(s>=128){t.push(String.fromCharCode(65535&s)),i+=2;continue}}}else if(n[i]<240){if(rt(n,i,2)){var a=(15&n[i])<<12|(63&n[i+1])<<6|63&n[i+2];if(a>=2048&&55296!=(63488&a)){t.push(String.fromCharCode(65535&a)),i+=3;continue}}}else if(n[i]<248&&rt(n,i,3)){var o=(7&n[i])<<18|(63&n[i+1])<<12|(63&n[i+2])<<6|63&n[i+3];if(o>65536&&o<1114112){o-=65536,t.push(String.fromCharCode(o>>>10|55296)),t.push(String.fromCharCode(1023&o|56320)),i+=4;continue}}t.push(String.fromCharCode(65533)),++i}return t.join("")};var at,ot=(at=new ArrayBuffer(2),new DataView(at).setInt16(0,256,!0),256===new Int16Array(at)[0]);const lt=function(){function e(){t(this,e)}return s(e,null,[{key:"parseScriptData",value:function(t,n,i){var r={};try{var s=e.parseValue(t,n,i),a=e.parseValue(t,n+s.size,i-s.size);r[s.data]=a.data}catch(e){Le.e("AMF",e.toString())}return r}},{key:"parseObject",value:function(t,n,i){if(i<3)throw new De("Data not enough when parse ScriptDataObject");var r=e.parseString(t,n,i),s=e.parseValue(t,n+r.size,i-r.size),a=s.objectEnd;return{data:{name:r.data,value:s.data},size:r.size+s.size,objectEnd:a}}},{key:"parseVariable",value:function(t,n,i){return e.parseObject(t,n,i)}},{key:"parseString",value:function(e,t,n){if(n<2)throw new De("Data not enough when parse String");var i=new DataView(e,t,n).getUint16(0,!ot);return{data:i>0?st(new Uint8Array(e,t+2,i)):"",size:2+i}}},{key:"parseLongString",value:function(e,t,n){if(n<4)throw new De("Data not enough when parse LongString");var i=new DataView(e,t,n).getUint32(0,!ot);return{data:i>0?st(new Uint8Array(e,t+4,i)):"",size:4+i}}},{key:"parseDate",value:function(e,t,n){if(n<10)throw new De("Data size invalid when parse Date");var i=new DataView(e,t,n),r=i.getFloat64(0,!ot),s=i.getInt16(8,!ot);return{data:new Date(r+=60*s*1e3),size:10}}},{key:"parseValue",value:function(t,n,i){if(i<1)throw new De("Data not enough when parse Value");var r,s=new DataView(t,n,i),a=1,o=s.getUint8(0),l=!1;try{switch(o){case 0:r=s.getFloat64(1,!ot),a+=8;break;case 1:r=!!s.getUint8(1),a+=1;break;case 2:var u=e.parseString(t,n+1,i-1);r=u.data,a+=u.size;break;case 3:r={};var c=0;for(9==(16777215&s.getUint32(i-4,!ot))&&(c=3);a<i-4;){var h=e.parseObject(t,n+a,i-a-c);if(h.objectEnd)break;r[h.data.name]=h.data.value,a+=h.size}a<=i-3&&9==(16777215&s.getUint32(a-1,!ot))&&(a+=3);break;case 8:r={},a+=4;var d=0;for(9==(16777215&s.getUint32(i-4,!ot))&&(d=3);a<i-8;){var f=e.parseVariable(t,n+a,i-a-d);if(f.objectEnd)break;r[f.data.name]=f.data.value,a+=f.size}a<=i-3&&9==(16777215&s.getUint32(a-1,!ot))&&(a+=3);break;case 9:r=void 0,a=1,l=!0;break;case 10:r=[];var p=s.getUint32(1,!ot);a+=4;for(var m=0;m<p;m++){var y=e.parseValue(t,n+a,i-a);r.push(y.data),a+=y.size}break;case 11:var v=e.parseDate(t,n+1,i-1);r=v.data,a+=v.size;break;case 12:var _=e.parseString(t,n+1,i-1);r=_.data,a+=_.size;break;default:a=i,Le.w("AMF","Unsupported AMF value type "+o)}}catch(e){Le.e("AMF",e.toString())}return{data:r,size:a,objectEnd:l}}}]),e}(),ut=function(){function e(n){t(this,e),this.TAG="ExpGolomb",this._buffer=n,this._buffer_index=0,this._total_bytes=n.byteLength,this._total_bits=8*n.byteLength,this._current_word=0,this._current_word_bits_left=0}return s(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new De("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),n=new Uint8Array(4);n.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(n.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t}},{key:"readBits",value:function(e){if(e>32)throw new Oe("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var n=this._current_word_bits_left?this._current_word:0;n>>>=32-this._current_word_bits_left;var i=e-this._current_word_bits_left;this._fillCurrentWord();var r=Math.min(i,this._current_word_bits_left),s=this._current_word>>>32-r;return this._current_word<<=r,this._current_word_bits_left-=r,n<<r|s}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}(),ct=function(){function e(){t(this,e)}return s(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,n=t.byteLength,i=new Uint8Array(n),r=0,s=0;s<n;s++)s>=2&&3===t[s]&&0===t[s-1]&&0===t[s-2]||(i[r]=t[s],r++);return new Uint8Array(i.buffer,0,r)}},{key:"parseSPS",value:function(t){var n=e._ebsp2rbsp(t),i=new ut(n);i.readByte();var r=i.readByte();i.readByte();var s=i.readByte();i.readUEG();var a=e.getProfileString(r),o=e.getLevelString(s),l=1,u=420,c=8;if((100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r)&&(3===(l=i.readUEG())&&i.readBits(1),l<=3&&(u=[0,420,422,444][l]),c=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool()))for(var h=3!==l?8:12,d=0;d<h;d++)i.readBool()&&(d<6?e._skipScalingList(i,16):e._skipScalingList(i,64));i.readUEG();var f=i.readUEG();if(0===f)i.readUEG();else if(1===f){i.readBits(1),i.readSEG(),i.readSEG();for(var p=i.readUEG(),m=0;m<p;m++)i.readSEG()}var y=i.readUEG();i.readBits(1);var v=i.readUEG(),_=i.readUEG(),g=i.readBits(1);0===g&&i.readBits(1),i.readBits(1);var b=0,w=0,k=0,S=0;i.readBool()&&(b=i.readUEG(),w=i.readUEG(),k=i.readUEG(),S=i.readUEG());var E=1,A=1,L=0,C=!0,T=0,x=0;if(i.readBool()){if(i.readBool()){var R=i.readByte();R>0&&R<16?(E=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][R-1],A=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][R-1]):255===R&&(E=i.readByte()<<8|i.readByte(),A=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){var D=i.readBits(32),O=i.readBits(32);C=i.readBool(),L=(T=O)/(x=2*D)}}var M=1;1===E&&1===A||(M=E/A);var P=0,B=0;0===l?(P=1,B=2-g):(P=3===l?1:2,B=(1===l?2:1)*(2-g));var I=16*(v+1),U=16*(_+1)*(2-g);I-=(b+w)*P,U-=(k+S)*B;var F=Math.ceil(I*M);return i.destroy(),i=null,{profile_string:a,level_string:o,bit_depth:c,ref_frames:y,chroma_format:u,chroma_format_string:e.getChromaFormatString(u),frame_rate:{fixed:C,fps:L,fps_den:x,fps_num:T},sar_ratio:{width:E,height:A},codec_size:{width:I,height:U},present_size:{width:F,height:U}}}},{key:"_skipScalingList",value:function(e,t){for(var n=8,i=8,r=0;r<t;r++)0!==i&&(i=(n+e.readSEG()+256)%256),n=0===i?n:i}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]),e}(),ht="FormatError",dt="FormatUnsupported",ft="CodecUnsupported",pt=function(){function e(n,i){t(this,e),this.TAG="FLVDemuxer",this._config=i,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=n.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=n.hasAudioTrack,this._hasVideo=n.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new it,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}()}return s(e,[{key:"destroy",value:function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null}},{key:"bindDataSource",value:function(e){return e.onDataArrival=this.parseChunks.bind(this),this}},{key:"resetMediaInfo",value:function(){this._mediaInfo=new it}},{key:"_isInitialMetadataDispatched",value:function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched}},{key:"parseChunks",value:function(t,n){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new De("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var i=0,r=this._littleEndian;if(0===n){if(!(t.byteLength>13))return 0;i=e.probe(t).dataOffset}for(this._firstParse&&(this._firstParse=!1,n+i!==this._dataOffset&&Le.w(this.TAG,"First time parsing but chunk byteStart invalid!"),0!==new DataView(t,i).getUint32(0,!r)&&Le.w(this.TAG,"PrevTagSize0 !== 0 !!!"),i+=4);i<t.byteLength;){this._dispatch=!0;var s=new DataView(t,i);if(i+11+4>t.byteLength)break;var a=s.getUint8(0),o=16777215&s.getUint32(0,!r);if(i+11+o+4>t.byteLength)break;if(8===a||9===a||18===a){var l=s.getUint8(4),u=s.getUint8(5),c=s.getUint8(6)|u<<8|l<<16|s.getUint8(7)<<24;0!=(16777215&s.getUint32(7,!r))&&Le.w(this.TAG,"Meet tag which has StreamID != 0!");var h=i+11;switch(a){case 8:this._parseAudioData(t,h,o,c);break;case 9:this._parseVideoData(t,h,o,c,n+i);break;case 18:this._parseScriptData(t,h,o)}var d=s.getUint32(11+o,!r);d!==11+o&&Le.w(this.TAG,"Invalid PrevTagSize ".concat(d)),i+=11+o+4}else Le.w(this.TAG,"Unsupported tag type ".concat(a,", skipped")),i+=11+o+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),i}},{key:"_parseScriptData",value:function(e,t,n){var i=lt.parseScriptData(e,t,n);if(i.hasOwnProperty("onMetaData")){if(null==i.onMetaData||"object"!==l(i.onMetaData))return void Le.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&Le.w(this.TAG,"Found another onMetaData tag!"),this._metadata=i;var r=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},r)),"boolean"==typeof r.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=r.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof r.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=r.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof r.audiodatarate&&(this._mediaInfo.audioDataRate=r.audiodatarate),"number"==typeof r.videodatarate&&(this._mediaInfo.videoDataRate=r.videodatarate),"number"==typeof r.width&&(this._mediaInfo.width=r.width),"number"==typeof r.height&&(this._mediaInfo.height=r.height),"number"==typeof r.duration){if(!this._durationOverrided){var s=Math.floor(r.duration*this._timescale);this._duration=s,this._mediaInfo.duration=s}}else this._mediaInfo.duration=0;if("number"==typeof r.framerate){var a=Math.floor(1e3*r.framerate);if(a>0){var o=a/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=o,this._referenceFrameRate.fps_num=a,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=o}}if("object"===l(r.keyframes)){this._mediaInfo.hasKeyframesIndex=!0;var u=r.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(u),r.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=r,Le.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(i).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},i))}},{key:"_parseKeyframesIndex",value:function(e){for(var t=[],n=[],i=1;i<e.times.length;i++){var r=this._timestampBase+Math.floor(1e3*e.times[i]);t.push(r),n.push(e.filepositions[i])}return{times:t,filepositions:n}}},{key:"_parseAudioData",value:function(e,t,n,i){if(n<=1)Le.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){this._littleEndian;var r=new DataView(e,t,n).getUint8(0),s=r>>>4;if(2===s||10===s){var a=0,o=(12&r)>>>2;if(o>=0&&o<=4){a=this._flvSoundRateTable[o];var l=1&r,u=this._audioMetadata,c=this._audioTrack;if(u||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(u=this._audioMetadata={}).type="audio",u.id=c.id,u.timescale=this._timescale,u.duration=this._duration,u.audioSampleRate=a,u.channelCount=0===l?1:2),10===s){var h=this._parseAACAudioData(e,t+1,n-1);if(null==h)return;if(0===h.packetType){u.config&&Le.w(this.TAG,"Found another AudioSpecificConfig!");var d=h.data;u.audioSampleRate=d.samplingRate,u.channelCount=d.channelCount,u.codec=d.codec,u.originalCodec=d.originalCodec,u.config=d.config,u.refSampleDuration=1024/u.audioSampleRate*u.timescale,Le.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",u);var f=this._mediaInfo;f.audioCodec=u.originalCodec,f.audioSampleRate=u.audioSampleRate,f.audioChannelCount=u.channelCount,f.hasVideo?null!=f.videoCodec&&(f.mimeType='video/x-flv; codecs="'+f.videoCodec+","+f.audioCodec+'"'):f.mimeType='video/x-flv; codecs="'+f.audioCodec+'"',f.isComplete()&&this._onMediaInfo(f)}else if(1===h.packetType){var p=this._timestampBase+i,m={unit:h.data,length:h.data.byteLength,dts:p,pts:p};c.samples.push(m),c.length+=h.data.length}else Le.e(this.TAG,"Flv: Unsupported AAC data type ".concat(h.packetType))}else if(2===s){if(!u.codec){var y=this._parseMP3AudioData(e,t+1,n-1,!0);if(null==y)return;u.audioSampleRate=y.samplingRate,u.channelCount=y.channelCount,u.codec=y.codec,u.originalCodec=y.originalCodec,u.refSampleDuration=1152/u.audioSampleRate*u.timescale,Le.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",u);var v=this._mediaInfo;v.audioCodec=u.codec,v.audioSampleRate=u.audioSampleRate,v.audioChannelCount=u.channelCount,v.audioDataRate=y.bitRate,v.hasVideo?null!=v.videoCodec&&(v.mimeType='video/x-flv; codecs="'+v.videoCodec+","+v.audioCodec+'"'):v.mimeType='video/x-flv; codecs="'+v.audioCodec+'"',v.isComplete()&&this._onMediaInfo(v)}var _=this._parseMP3AudioData(e,t+1,n-1,!1);if(null==_)return;var g=this._timestampBase+i,b={unit:_,length:_.byteLength,dts:g,pts:g};c.samples.push(b),c.length+=_.length}}else this._onError(ht,"Flv: Invalid audio sample rate idx: "+o)}else this._onError(ft,"Flv: Unsupported audio codec idx: "+s)}}},{key:"_parseAACAudioData",value:function(e,t,n){if(!(n<=1)){var i={},r=new Uint8Array(e,t,n);return i.packetType=r[0],0===r[0]?i.data=this._parseAACAudioSpecificConfig(e,t+1,n-1):i.data=r.subarray(1),i}Le.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")}},{key:"_parseAACAudioSpecificConfig",value:function(e,t,n){var i,r,s=new Uint8Array(e,t,n),a=null,o=0,l=null;if(o=i=s[0]>>>3,(r=(7&s[0])<<1|s[1]>>>7)<0||r>=this._mpegSamplingRates.length)this._onError(ht,"Flv: AAC invalid sampling frequency index!");else{var u=this._mpegSamplingRates[r],c=(120&s[1])>>>3;if(!(c<0||c>=8)){5===o&&(l=(7&s[1])<<1|s[2]>>>7,s[2]);var h=self.navigator.userAgent.toLowerCase();return-1!==h.indexOf("firefox")?r>=6?(o=5,a=new Array(4),l=r-3):(o=2,a=new Array(2),l=r):-1!==h.indexOf("android")?(o=2,a=new Array(2),l=r):(o=5,l=r,a=new Array(4),r>=6?l=r-3:1===c&&(o=2,a=new Array(2),l=r)),a[0]=o<<3,a[0]|=(15&r)>>>1,a[1]=(15&r)<<7,a[1]|=(15&c)<<3,5===o&&(a[1]|=(15&l)>>>1,a[2]=(1&l)<<7,a[2]|=8,a[3]=0),{config:a,samplingRate:u,channelCount:c,codec:"mp4a.40."+o,originalCodec:"mp4a.40."+i}}this._onError(ht,"Flv: AAC invalid channel configuration")}}},{key:"_parseMP3AudioData",value:function(e,t,n,i){if(!(n<4)){this._littleEndian;var r=new Uint8Array(e,t,n),s=null;if(i){if(255!==r[0])return;var a=r[1]>>>3&3,o=(6&r[1])>>1,l=(240&r[2])>>>4,u=(12&r[2])>>>2,c=3!=(r[3]>>>6&3)?2:1,h=0,d=0;switch(a){case 0:h=this._mpegAudioV25SampleRateTable[u];break;case 2:h=this._mpegAudioV20SampleRateTable[u];break;case 3:h=this._mpegAudioV10SampleRateTable[u]}switch(o){case 1:l<this._mpegAudioL3BitRateTable.length&&(d=this._mpegAudioL3BitRateTable[l]);break;case 2:l<this._mpegAudioL2BitRateTable.length&&(d=this._mpegAudioL2BitRateTable[l]);break;case 3:l<this._mpegAudioL1BitRateTable.length&&(d=this._mpegAudioL1BitRateTable[l])}s={bitRate:d,samplingRate:h,channelCount:c,codec:"mp3",originalCodec:"mp3"}}else s=r;return s}Le.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")}},{key:"_parseVideoData",value:function(e,t,n,i,r){if(n<=1)Le.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var s=new Uint8Array(e,t,n)[0],a=(240&s)>>>4,o=15&s;7===o?this._parseAVCVideoPacket(e,t+1,n-1,i,r,a):this._onError(ft,"Flv: Unsupported codec in video frame: ".concat(o))}}},{key:"_parseAVCVideoPacket",value:function(e,t,n,i,r,s){if(n<4)Le.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var a=this._littleEndian,o=new DataView(e,t,n),l=o.getUint8(0),u=(16777215&o.getUint32(0,!a))<<8>>8;if(0===l)this._parseAVCDecoderConfigurationRecord(e,t+4,n-4);else if(1===l)this._parseAVCVideoData(e,t+4,n-4,i,r,s,u);else if(2!==l)return void this._onError(ht,"Flv: Invalid video packet type ".concat(l))}}},{key:"_parseAVCDecoderConfigurationRecord",value:function(e,t,n){if(n<7)Le.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var i=this._videoMetadata,r=this._videoTrack,s=this._littleEndian,a=new DataView(e,t,n);i?void 0!==i.avcc&&Le.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(i=this._videoMetadata={}).type="video",i.id=r.id,i.timescale=this._timescale,i.duration=this._duration);var o=a.getUint8(0),l=a.getUint8(1);if(a.getUint8(2),a.getUint8(3),1===o&&0!==l)if(this._naluLengthSize=1+(3&a.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var u=31&a.getUint8(5);if(0!==u){u>1&&Le.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = ".concat(u));for(var c=6,h=0;h<u;h++){var d=a.getUint16(c,!s);if(c+=2,0!==d){var f=new Uint8Array(e,t+c,d);c+=d;var p=ct.parseSPS(f);if(0===h){i.codecWidth=p.codec_size.width,i.codecHeight=p.codec_size.height,i.presentWidth=p.present_size.width,i.presentHeight=p.present_size.height,i.profile=p.profile_string,i.level=p.level_string,i.bitDepth=p.bit_depth,i.chromaFormat=p.chroma_format,i.sarRatio=p.sar_ratio,i.frameRate=p.frame_rate,!1!==p.frame_rate.fixed&&0!==p.frame_rate.fps_num&&0!==p.frame_rate.fps_den||(i.frameRate=this._referenceFrameRate);var m=i.frameRate.fps_den,y=i.frameRate.fps_num;i.refSampleDuration=i.timescale*(m/y);for(var v=f.subarray(1,4),_="avc1.",g=0;g<3;g++){var b=v[g].toString(16);b.length<2&&(b="0"+b),_+=b}i.codec=_;var w=this._mediaInfo;w.width=i.codecWidth,w.height=i.codecHeight,w.fps=i.frameRate.fps,w.profile=i.profile,w.level=i.level,w.refFrames=p.ref_frames,w.chromaFormat=p.chroma_format_string,w.sarNum=i.sarRatio.width,w.sarDen=i.sarRatio.height,w.videoCodec=_,w.hasAudio?null!=w.audioCodec&&(w.mimeType='video/x-flv; codecs="'+w.videoCodec+","+w.audioCodec+'"'):w.mimeType='video/x-flv; codecs="'+w.videoCodec+'"',w.isComplete()&&this._onMediaInfo(w)}}}var k=a.getUint8(c);if(0!==k){k>1&&Le.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = ".concat(k)),c++;for(var S=0;S<k;S++){var E=a.getUint16(c,!s);c+=2,0!==E&&(c+=E)}i.avcc=new Uint8Array(n),i.avcc.set(new Uint8Array(e,t,n),0),Le.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",i)}else this._onError(ht,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(ht,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(ht,"Flv: Strange NaluLengthSizeMinusOne: ".concat(this._naluLengthSize-1));else this._onError(ht,"Flv: Invalid AVCDecoderConfigurationRecord")}}},{key:"_parseAVCVideoData",value:function(e,t,n,i,r,s,a){for(var o=this._littleEndian,l=new DataView(e,t,n),u=[],c=0,h=0,d=this._naluLengthSize,f=this._timestampBase+i,p=1===s;h<n;){if(h+4>=n){Le.w(this.TAG,"Malformed Nalu near timestamp ".concat(f,", offset = ").concat(h,", dataSize = ").concat(n));break}var m=l.getUint32(h,!o);if(3===d&&(m>>>=8),m>n-d)return void Le.w(this.TAG,"Malformed Nalus near timestamp ".concat(f,", NaluSize > DataSize!"));var y=31&l.getUint8(h+d);5===y&&(p=!0);var v=new Uint8Array(e,t+h,d+m),_={type:y,data:v};u.push(_),c+=v.byteLength,h+=d+m}if(u.length){var g=this._videoTrack,b={units:u,length:c,isKeyframe:p,dts:f,cts:a,pts:f+a};p&&(b.fileposition=r),g.samples.push(b),g.length+=c}}},{key:"onTrackMetadata",get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e}},{key:"onMediaInfo",get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e}},{key:"onMetaDataArrived",get:function(){return this._onMetaDataArrived},set:function(e){this._onMetaDataArrived=e}},{key:"onScriptDataArrived",get:function(){return this._onScriptDataArrived},set:function(e){this._onScriptDataArrived=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onDataAvailable",get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e}},{key:"timestampBase",get:function(){return this._timestampBase},set:function(e){this._timestampBase=e}},{key:"overridedDuration",get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e}},{key:"overridedHasAudio",set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e}},{key:"overridedHasVideo",set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e}}],[{key:"probe",value:function(e){var t=new Uint8Array(e),n={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return n;var i,r=(4&t[4])>>>2!=0,s=0!=(1&t[4]),a=(i=t)[5]<<24|i[6]<<16|i[7]<<8|i[8];return a<9?n:{match:!0,consumed:a,dataOffset:a,hasAudioTrack:r,hasVideoTrack:s}}}]),e}();var mt=function(){function e(){t(this,e)}return s(e,null,[{key:"init",value:function(){for(var t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=e.constants={};n.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),n.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),n.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),n.STSC=n.STCO=n.STTS,n.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),n.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),n.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),n.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}},{key:"box",value:function(e){for(var t=8,n=null,i=Array.prototype.slice.call(arguments,1),r=i.length,s=0;s<r;s++)t+=i[s].byteLength;(n=new Uint8Array(t))[0]=t>>>24&255,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n.set(e,4);for(var a=8,o=0;o<r;o++)n.set(i[o],a),a+=i[o].byteLength;return n}},{key:"generateInitSegment",value:function(t){var n=e.box(e.types.ftyp,e.constants.FTYP),i=e.moov(t),r=new Uint8Array(n.byteLength+i.byteLength);return r.set(n,0),r.set(i,n.byteLength),r}},{key:"moov",value:function(t){var n=e.mvhd(t.timescale,t.duration),i=e.trak(t),r=e.mvex(t);return e.box(e.types.moov,n,i,r)}},{key:"mvhd",value:function(t,n){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"tkhd",value:function(t){var n=t.id,i=t.duration,r=t.presentWidth,s=t.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,255&r,0,0,s>>>8&255,255&s,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t),e.hdlr(t),e.minf(t))}},{key:"mdhd",value:function(t){var n=t.timescale,i=t.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,i>>>24&255,i>>>16&255,i>>>8&255,255&i,85,196,0,0]))}},{key:"hdlr",value:function(t){var n;return n="audio"===t.type?e.constants.HDLR_AUDIO:e.constants.HDLR_VIDEO,e.box(e.types.hdlr,n)}},{key:"minf",value:function(t){var n;return n="audio"===t.type?e.box(e.types.smhd,e.constants.SMHD):e.box(e.types.vmhd,e.constants.VMHD),e.box(e.types.minf,n,e.dinf(),e.stbl(t))}},{key:"dinf",value:function(){return e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF))}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO))}},{key:"stsd",value:function(t){return"audio"===t.type?"mp3"===t.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp3(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(t))}},{key:"mp3",value:function(t){var n=t.channelCount,i=t.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return e.box(e.types[".mp3"],r)}},{key:"mp4a",value:function(t){var n=t.channelCount,i=t.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return e.box(e.types.mp4a,r,e.esds(t))}},{key:"esds",value:function(t){var n=t.config||[],i=n.length,r=new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(n).concat([6,1,2]));return e.box(e.types.esds,r)}},{key:"avc1",value:function(t){var n=t.avcc,i=t.codecWidth,r=t.codecHeight,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>>8&255,255&i,r>>>8&255,255&r,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.avc1,s,e.box(e.types.avcC,n))}},{key:"mvex",value:function(t){return e.box(e.types.mvex,e.trex(t))}},{key:"trex",value:function(t){var n=t.id,i=new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,i)}},{key:"moof",value:function(t,n){return e.box(e.types.moof,e.mfhd(t.sequenceNumber),e.traf(t,n))}},{key:"mfhd",value:function(t){var n=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return e.box(e.types.mfhd,n)}},{key:"traf",value:function(t,n){var i=t.id,r=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i])),s=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n])),a=e.sdtp(t),o=e.trun(t,a.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,r,s,o,a)}},{key:"sdtp",value:function(t){for(var n=t.samples||[],i=n.length,r=new Uint8Array(4+i),s=0;s<i;s++){var a=n[s].flags;r[s+4]=a.isLeading<<6|a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy}return e.box(e.types.sdtp,r)}},{key:"trun",value:function(t,n){var i=t.samples||[],r=i.length,s=12+16*r,a=new Uint8Array(s);n+=8+s,a.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0);for(var o=0;o<r;o++){var l=i[o].duration,u=i[o].size,c=i[o].flags,h=i[o].cts;a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.isNonSync,0,0,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*o)}return e.box(e.types.trun,a)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}}]),e}();mt.init();const yt=mt,vt=function(){function e(){t(this,e)}return s(e,null,[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();var _t=function e(n,i,r,s,a){t(this,e),this.dts=n,this.pts=i,this.duration=r,this.originalDts=s,this.isSyncPoint=a,this.fileposition=null},gt=function(){function e(){t(this,e),this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return s(e,[{key:"appendSyncPoint",value:function(e){e.isSyncPoint=!0,this.syncPoints.push(e)}}]),e}(),bt=function(){function e(){t(this,e),this._list=[]}return s(e,[{key:"clear",value:function(){this._list=[]}},{key:"appendArray",value:function(e){var t=this._list;0!==e.length&&(t.length>0&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))}},{key:"getLastSyncPointBeforeDts",value:function(e){if(0==this._list.length)return null;var t=this._list,n=0,i=t.length-1,r=0,s=0,a=i;for(e<t[0].dts&&(n=0,s=a+1);s<=a;){if((r=s+Math.floor((a-s)/2))===i||e>=t[r].dts&&e<t[r+1].dts){n=r;break}t[r].dts<e?s=r+1:a=r-1}return this._list[n]}}]),e}(),wt=function(){function e(n){t(this,e),this._type=n,this._list=[],this._lastAppendLocation=-1}return s(e,[{key:"isEmpty",value:function(){return 0===this._list.length}},{key:"clear",value:function(){this._list=[],this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function(e){var t=this._list;if(0===t.length)return-2;var n=t.length-1,i=0,r=0,s=n,a=0;if(e<t[0].originalBeginDts)return-1;for(;r<=s;){if((i=r+Math.floor((s-r)/2))===n||e>t[i].lastSample.originalDts&&e<t[i+1].originalBeginDts){a=i;break}t[i].originalBeginDts<e?r=i+1:s=i-1}return a}},{key:"_searchNearestSegmentAfter",value:function(e){return this._searchNearestSegmentBefore(e)+1}},{key:"append",value:function(e){var t=this._list,n=e,i=this._lastAppendLocation,r=0;-1!==i&&i<t.length&&n.originalBeginDts>=t[i].lastSample.originalDts&&(i===t.length-1||i<t.length-1&&n.originalBeginDts<t[i+1].originalBeginDts)?r=i+1:t.length>0&&(r=this._searchNearestSegmentBefore(n.originalBeginDts)+1),this._lastAppendLocation=r,this._list.splice(r,0,n)}},{key:"getLastSegmentBefore",value:function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null}},{key:"getLastSampleBefore",value:function(e){var t=this.getLastSegmentBefore(e);return null!=t?t.lastSample:null}},{key:"getLastSyncPointBefore",value:function(e){for(var t=this._searchNearestSegmentBefore(e),n=this._list[t].syncPoints;0===n.length&&t>0;)t--,n=this._list[t].syncPoints;return n.length>0?n[n.length-1]:null}},{key:"type",get:function(){return this._type}},{key:"length",get:function(){return this._list.length}}]),e}();const kt=function(){function e(n){t(this,e),this.TAG="MP4Remuxer",this._config=n,this._isLive=!0===n.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new wt("audio"),this._videoSegmentInfoList=new wt("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!Ne.chrome||!(Ne.version.major<50||50===Ne.version.major&&Ne.version.build<2661)),this._fillSilentAfterSeek=Ne.msedge||Ne.msie,this._mp3UseMpegAudio=!Ne.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return s(e,[{key:"destroy",value:function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null}},{key:"bindDataSource",value:function(e){return e.onDataAvailable=this.remux.bind(this),e.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this}},{key:"insertDiscontinuity",value:function(){this._audioNextDts=this._videoNextDts=void 0}},{key:"seek",value:function(e){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()}},{key:"remux",value:function(e,t){if(!this._onMediaSegment)throw new De("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)}},{key:"_onTrackMetadataReceived",value:function(e,t){var n=null,i="mp4",r=t.codec;if("audio"===e)this._audioMeta=t,"mp3"===t.codec&&this._mp3UseMpegAudio?(i="mpeg",r="",n=new Uint8Array):n=yt.generateInitSegment(t);else{if("video"!==e)return;this._videoMeta=t,n=yt.generateInitSegment(t)}if(!this._onInitSegment)throw new De("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(e,{type:e,data:n.buffer,codec:r,container:"".concat(e,"/").concat(i),mediaDuration:t.duration})}},{key:"_calculateDtsBase",value:function(e,t){this._dtsBaseInited||(e.samples&&e.samples.length&&(this._audioDtsBase=e.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)}},{key:"flushStashedSamples",value:function(){var e=this._videoStashedLastSample,t=this._audioStashedLastSample,n={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=e&&(n.samples.push(e),n.length=e.length);var i={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=t&&(i.samples.push(t),i.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(n,!0),this._remuxAudio(i,!0)}},{key:"_remuxAudio",value:function(e,t){if(null!=this._audioMeta){var n,i=e,r=i.samples,s=void 0,a=-1,o=this._audioMeta.refSampleDuration,l="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,u=this._dtsBaseInited&&void 0===this._audioNextDts,c=!1;if(r&&0!==r.length&&(1!==r.length||t)){var h=0,d=null,f=0;l?(h=0,f=i.length):(h=8,f=8+i.length);var p=null;if(r.length>1&&(f-=(p=r.pop()).length),null!=this._audioStashedLastSample){var m=this._audioStashedLastSample;this._audioStashedLastSample=null,r.unshift(m),f+=m.length}null!=p&&(this._audioStashedLastSample=p);var y=r[0].dts-this._dtsBase;if(this._audioNextDts)s=y-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())s=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(c=!0);else{var v=this._audioSegmentInfoList.getLastSampleBefore(y);if(null!=v){var _=y-(v.originalDts+v.duration);_<=3&&(_=0),s=y-(v.dts+v.duration+_)}else s=0}if(c){var g=y-s,b=this._videoSegmentInfoList.getLastSegmentBefore(y);if(null!=b&&b.beginDts<g){var w=vt.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(w){var k=b.beginDts,S=g-b.beginDts;Le.v(this.TAG,"InsertPrefixSilentAudio: dts: ".concat(k,", duration: ").concat(S)),r.unshift({unit:w,dts:k,pts:k}),f+=w.byteLength}}else c=!1}for(var E=[],A=0;A<r.length;A++){var L=r[A],C=L.unit,T=L.dts-this._dtsBase,x=T-s;-1===a&&(a=x);var R=0,D=!1,O=null;if((R=A!==r.length-1?r[A+1].dts-this._dtsBase-s-x:null!=p?p.dts-this._dtsBase-s-x:E.length>=1?E[E.length-1].duration:Math.floor(o))>1.5*o&&"mp3"!==this._audioMeta.codec&&this._fillAudioTimestampGap&&!Ne.safari){D=!0;var M=Math.abs(R-o),P=Math.ceil(M/o),B=x+o;Le.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\n"+"dts: ".concat(x+R," ms, expected: ").concat(x+Math.round(o)," ms, ")+"delta: ".concat(Math.round(M)," ms, generate: ").concat(P," frames"));var I=vt.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);null==I&&(Le.w(this.TAG,"Unable to generate silent frame for "+"".concat(this._audioMeta.originalCodec," with ").concat(this._audioMeta.channelCount," channels, repeat last frame")),I=C),O=[];for(var U=0;U<P;U++){var F=Math.round(B);if(O.length>0){var N=O[O.length-1];N.duration=F-N.dts}var j={dts:F,pts:F,cts:0,unit:I,size:I.byteLength,duration:0,originalDts:T,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};O.push(j),f+=j.size,B+=o}var z=O[O.length-1];z.duration=x+R-z.dts,R=Math.round(o)}E.push({dts:x,pts:x,cts:0,unit:L.unit,size:L.unit.byteLength,duration:R,originalDts:T,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),D&&E.push.apply(E,O)}l?d=new Uint8Array(f):((d=new Uint8Array(f))[0]=f>>>24&255,d[1]=f>>>16&255,d[2]=f>>>8&255,d[3]=255&f,d.set(yt.types.mdat,4));for(var $=0;$<E.length;$++){var V=E[$].unit;d.set(V,h),h+=V.byteLength}var G=E[E.length-1];n=G.dts+G.duration,this._audioNextDts=n;var W=new gt;W.beginDts=a,W.endDts=n,W.beginPts=a,W.endPts=n,W.originalBeginDts=E[0].originalDts,W.originalEndDts=G.originalDts+G.duration,W.firstSample=new _t(E[0].dts,E[0].pts,E[0].duration,E[0].originalDts,!1),W.lastSample=new _t(G.dts,G.pts,G.duration,G.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(W),i.samples=E,i.sequenceNumber++;var H;H=l?new Uint8Array:yt.moof(i,a),i.samples=[],i.length=0;var q={type:"audio",data:this._mergeBoxes(H,d).buffer,sampleCount:E.length,info:W};l&&u&&(q.timestampOffset=a),this._onMediaSegment("audio",q)}}}},{key:"_remuxVideo",value:function(e,t){if(null!=this._videoMeta){var n,i,r=e,s=r.samples,a=void 0,o=-1,l=-1;if(s&&0!==s.length&&(1!==s.length||t)){var u=8,c=null,h=8+e.length,d=null;if(s.length>1&&(h-=(d=s.pop()).length),null!=this._videoStashedLastSample){var f=this._videoStashedLastSample;this._videoStashedLastSample=null,s.unshift(f),h+=f.length}null!=d&&(this._videoStashedLastSample=d);var p=s[0].dts-this._dtsBase;if(this._videoNextDts)a=p-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())a=0;else{var m=this._videoSegmentInfoList.getLastSampleBefore(p);if(null!=m){var y=p-(m.originalDts+m.duration);y<=3&&(y=0),a=p-(m.dts+m.duration+y)}else a=0}for(var v=new gt,_=[],g=0;g<s.length;g++){var b=s[g],w=b.dts-this._dtsBase,k=b.isKeyframe,S=w-a,E=b.cts,A=S+E;-1===o&&(o=S,l=A);var L=0;if(L=g!==s.length-1?s[g+1].dts-this._dtsBase-a-S:null!=d?d.dts-this._dtsBase-a-S:_.length>=1?_[_.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),k){var C=new _t(S,A,L,b.dts,!0);C.fileposition=b.fileposition,v.appendSyncPoint(C)}_.push({dts:S,pts:A,cts:E,units:b.units,size:b.length,isKeyframe:k,duration:L,originalDts:w,flags:{isLeading:0,dependsOn:k?2:1,isDependedOn:k?1:0,hasRedundancy:0,isNonSync:k?0:1}})}(c=new Uint8Array(h))[0]=h>>>24&255,c[1]=h>>>16&255,c[2]=h>>>8&255,c[3]=255&h,c.set(yt.types.mdat,4);for(var T=0;T<_.length;T++)for(var x=_[T].units;x.length;){var R=x.shift().data;c.set(R,u),u+=R.byteLength}var D=_[_.length-1];if(n=D.dts+D.duration,i=D.pts+D.duration,this._videoNextDts=n,v.beginDts=o,v.endDts=n,v.beginPts=l,v.endPts=i,v.originalBeginDts=_[0].originalDts,v.originalEndDts=D.originalDts+D.duration,v.firstSample=new _t(_[0].dts,_[0].pts,_[0].duration,_[0].originalDts,_[0].isKeyframe),v.lastSample=new _t(D.dts,D.pts,D.duration,D.originalDts,D.isKeyframe),this._isLive||this._videoSegmentInfoList.append(v),r.samples=_,r.sequenceNumber++,this._forceFirstIDR){var O=_[0].flags;O.dependsOn=2,O.isNonSync=0}var M=yt.moof(r,o);r.samples=[],r.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(M,c).buffer,sampleCount:_.length,info:v})}}}},{key:"_mergeBoxes",value:function(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(e,0),n.set(t,e.byteLength),n}},{key:"onInitSegment",get:function(){return this._onInitSegment},set:function(e){this._onInitSegment=e}},{key:"onMediaSegment",get:function(){return this._onMediaSegment},set:function(e){this._onMediaSegment=e}}]),e}(),St="io_error",Et="demux_error",At="init_segment",Lt="media_segment",Ct="loading_complete",Tt="recovered_early_eof",xt="media_info",Rt="metadata_arrived",Dt="scriptdata_arrived",Ot="statistics_info",Mt="recommend_seekpoint",Pt=function(){function e(n,i){t(this,e),this.TAG="TransmuxingController",this._emitter=new(Ee()),this._config=i,n.segments||(n.segments=[{duration:n.duration,filesize:n.filesize,url:n.url}]),"boolean"!=typeof n.cors&&(n.cors=!0),"boolean"!=typeof n.withCredentials&&(n.withCredentials=!1),this._mediaDataSource=n,this._currentSegmentIndex=0;var r=0;this._mediaDataSource.segments.forEach((function(e){e.timestampBase=r,r+=e.duration,e.cors=n.cors,e.withCredentials=n.withCredentials,i.referrerPolicy&&(e.referrerPolicy=i.referrerPolicy)})),isNaN(r)||this._mediaDataSource.duration===r||(this._mediaDataSource.duration=r),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return s(e,[{key:"destroy",value:function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"start",value:function(){this._loadSegment(0),this._enableStatisticsReporter()}},{key:"_loadSegment",value:function(e,t){this._currentSegmentIndex=e;var n=this._mediaDataSource.segments[e],i=this._ioctl=new Xe(n,this._config,e);i.onError=this._onIOException.bind(this),i.onSeeked=this._onIOSeeked.bind(this),i.onComplete=this._onIOComplete.bind(this),i.onRedirect=this._onIORedirect.bind(this),i.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),t?this._demuxer.bindDataSource(this._ioctl):i.onDataArrival=this._onInitChunkArrival.bind(this),i.open(t)}},{key:"stop",value:function(){this._internalAbort(),this._disableStatisticsReporter()}},{key:"_internalAbort",value:function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)}},{key:"pause",value:function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())}},{key:"resume",value:function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())}},{key:"seek",value:function(e){if(null!=this._mediaInfo&&this._mediaInfo.isSeekable()){var t=this._searchSegmentIndexContains(e);if(t===this._currentSegmentIndex){var n=this._mediaInfo.segments[t];if(null==n)this._pendingSeekTime=e;else{var i=n.getNearestKeyframe(e);this._remuxer.seek(i.milliseconds),this._ioctl.seek(i.fileposition),this._pendingResolveSeekPoint=i.milliseconds}}else{var r=this._mediaInfo.segments[t];if(null==r)this._pendingSeekTime=e,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(t);else{var s=r.getNearestKeyframe(e);this._internalAbort(),this._remuxer.seek(e),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[t].timestampBase,this._loadSegment(t,s.fileposition),this._pendingResolveSeekPoint=s.milliseconds,this._reportSegmentMediaInfo(t)}}this._enableStatisticsReporter()}}},{key:"_searchSegmentIndexContains",value:function(e){for(var t=this._mediaDataSource.segments,n=t.length-1,i=0;i<t.length;i++)if(e<t[i].timestampBase){n=i-1;break}return n}},{key:"_onInitChunkArrival",value:function(e,t){var n=this,i=null,r=0;if(t>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,r=this._demuxer.parseChunks(e,t);else if((i=pt.probe(e)).match){this._demuxer=new pt(i,this._config),this._remuxer||(this._remuxer=new kt(this._config));var s=this._mediaDataSource;null==s.duration||isNaN(s.duration)||(this._demuxer.overridedDuration=s.duration),"boolean"==typeof s.hasAudio&&(this._demuxer.overridedHasAudio=s.hasAudio),"boolean"==typeof s.hasVideo&&(this._demuxer.overridedHasVideo=s.hasVideo),this._demuxer.timestampBase=s.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),r=this._demuxer.parseChunks(e,t)}else i=null,Le.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then((function(){n._internalAbort()})),this._emitter.emit(Et,dt,"Non-FLV, Unsupported media type"),r=0;return r}},{key:"_onMediaInfo",value:function(e){var t=this;null==this._mediaInfo&&(this._mediaInfo=Object.assign({},e),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,it.prototype));var n=Object.assign({},e);Object.setPrototypeOf(n,it.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=n,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&Promise.resolve().then((function(){var e=t._pendingSeekTime;t._pendingSeekTime=null,t.seek(e)}))}},{key:"_onMetaDataArrived",value:function(e){this._emitter.emit(Rt,e)}},{key:"_onScriptDataArrived",value:function(e){this._emitter.emit(Dt,e)}},{key:"_onIOSeeked",value:function(){this._remuxer.insertDiscontinuity()}},{key:"_onIOComplete",value:function(e){var t=e+1;t<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(t)):(this._remuxer.flushStashedSamples(),this._emitter.emit(Ct),this._disableStatisticsReporter())}},{key:"_onIORedirect",value:function(e){var t=this._ioctl.extraData;this._mediaDataSource.segments[t].redirectedURL=e}},{key:"_onIORecoveredEarlyEof",value:function(){this._emitter.emit(Tt)}},{key:"_onIOException",value:function(e,t){Le.e(this.TAG,"IOException: type = ".concat(e,", code = ").concat(t.code,", msg = ").concat(t.msg)),this._emitter.emit(St,e,t),this._disableStatisticsReporter()}},{key:"_onDemuxException",value:function(e,t){Le.e(this.TAG,"DemuxException: type = ".concat(e,", info = ").concat(t)),this._emitter.emit(Et,e,t)}},{key:"_onRemuxerInitSegmentArrival",value:function(e,t){this._emitter.emit(At,e,t)}},{key:"_onRemuxerMediaSegmentArrival",value:function(e,t){if(null==this._pendingSeekTime&&(this._emitter.emit(Lt,e,t),null!=this._pendingResolveSeekPoint&&"video"===e)){var n=t.info.syncPoints,i=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,Ne.safari&&n.length>0&&n[0].originalDts===i&&(i=n[0].pts),this._emitter.emit(Mt,i)}}},{key:"_enableStatisticsReporter",value:function(){null==this._statisticsReporter&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))}},{key:"_disableStatisticsReporter",value:function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"_reportSegmentMediaInfo",value:function(e){var t=this._mediaInfo.segments[e],n=Object.assign({},t);n.duration=this._mediaInfo.duration,n.segmentCount=this._mediaInfo.segmentCount,delete n.segments,delete n.keyframesIndex,this._emitter.emit(xt,n)}},{key:"_reportStatisticsInfo",value:function(){var e={};e.url=this._ioctl.currentURL,e.hasRedirect=this._ioctl.hasRedirect,e.hasRedirect&&(e.redirectedURL=this._ioctl.currentRedirectedURL),e.speed=this._ioctl.currentSpeed,e.loaderType=this._ioctl.loaderType,e.currentSegmentIndex=this._currentSegmentIndex,e.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(Ot,e)}}]),e}(),Bt=function(e){var t=null,n=function(t,n){e.postMessage({msg:"logcat_callback",data:{type:t,logcat:n}})}.bind(this);function i(t,n){var i={msg:At,data:{type:t,data:n}};e.postMessage(i,[n.data])}function r(t,n){var i={msg:Lt,data:{type:t,data:n}};e.postMessage(i,[n.data])}function s(){var t={msg:Ct};e.postMessage(t)}function a(){var t={msg:Tt};e.postMessage(t)}function o(t){var n={msg:xt,data:t};e.postMessage(n)}function l(t){var n={msg:Rt,data:t};e.postMessage(n)}function u(t){var n={msg:Dt,data:t};e.postMessage(n)}function c(t){var n={msg:Ot,data:t};e.postMessage(n)}function h(t,n){e.postMessage({msg:St,data:{type:t,info:n}})}function d(t,n){e.postMessage({msg:Et,data:{type:t,info:n}})}function f(t){e.postMessage({msg:Mt,data:t})}ke.install(),e.addEventListener("message",(function(p){switch(p.data.cmd){case"init":(t=new Pt(p.data.param[0],p.data.param[1])).on(St,h.bind(this)),t.on(Et,d.bind(this)),t.on(At,i.bind(this)),t.on(Lt,r.bind(this)),t.on(Ct,s.bind(this)),t.on(Tt,a.bind(this)),t.on(xt,o.bind(this)),t.on(Rt,l.bind(this)),t.on(Dt,u.bind(this)),t.on(Ot,c.bind(this)),t.on(Mt,f.bind(this));break;case"destroy":t&&(t.destroy(),t=null),e.postMessage({msg:"destroyed"});break;case"start":t.start();break;case"stop":t.stop();break;case"seek":t.seek(p.data.param);break;case"pause":t.pause();break;case"resume":t.resume();break;case"logging_config":var m=p.data.param;nt.applyConfig(m),!0===m.enableCallback?nt.addLogListener(n):nt.removeLogListener(n)}}))},It=function(){function e(i,r){if(t(this,e),this.TAG="Transmuxer",this._emitter=new(Ee()),r.enableWorker&&"undefined"!=typeof Worker)try{var s=n(396);this._worker=s(Bt),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[i,r]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},nt.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:nt.getConfig()})}catch(e){Le.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new Pt(i,r)}else this._controller=new Pt(i,r);if(this._controller){var a=this._controller;a.on(St,this._onIOError.bind(this)),a.on(Et,this._onDemuxError.bind(this)),a.on(At,this._onInitSegment.bind(this)),a.on(Lt,this._onMediaSegment.bind(this)),a.on(Ct,this._onLoadingComplete.bind(this)),a.on(Tt,this._onRecoveredEarlyEof.bind(this)),a.on(xt,this._onMediaInfo.bind(this)),a.on(Rt,this._onMetaDataArrived.bind(this)),a.on(Dt,this._onScriptDataArrived.bind(this)),a.on(Ot,this._onStatisticsInfo.bind(this)),a.on(Mt,this._onRecommendSeekpoint.bind(this))}}return s(e,[{key:"destroy",value:function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),nt.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"hasWorker",value:function(){return null!=this._worker}},{key:"open",value:function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()}},{key:"close",value:function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()}},{key:"seek",value:function(e){this._worker?this._worker.postMessage({cmd:"seek",param:e}):this._controller.seek(e)}},{key:"pause",value:function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()}},{key:"resume",value:function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()}},{key:"_onInitSegment",value:function(e,t){var n=this;Promise.resolve().then((function(){n._emitter.emit(At,e,t)}))}},{key:"_onMediaSegment",value:function(e,t){var n=this;Promise.resolve().then((function(){n._emitter.emit(Lt,e,t)}))}},{key:"_onLoadingComplete",value:function(){var e=this;Promise.resolve().then((function(){e._emitter.emit(Ct)}))}},{key:"_onRecoveredEarlyEof",value:function(){var e=this;Promise.resolve().then((function(){e._emitter.emit(Tt)}))}},{key:"_onMediaInfo",value:function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(xt,e)}))}},{key:"_onMetaDataArrived",value:function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(Rt,e)}))}},{key:"_onScriptDataArrived",value:function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(Dt,e)}))}},{key:"_onStatisticsInfo",value:function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(Ot,e)}))}},{key:"_onIOError",value:function(e,t){var n=this;Promise.resolve().then((function(){n._emitter.emit(St,e,t)}))}},{key:"_onDemuxError",value:function(e,t){var n=this;Promise.resolve().then((function(){n._emitter.emit(Et,e,t)}))}},{key:"_onRecommendSeekpoint",value:function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(Mt,e)}))}},{key:"_onLoggingConfigChanged",value:function(e){this._worker&&this._worker.postMessage({cmd:"logging_config",param:e})}},{key:"_onWorkerMessage",value:function(e){var t=e.data,n=t.data;if("destroyed"===t.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(t.msg){case At:case Lt:this._emitter.emit(t.msg,n.type,n.data);break;case Ct:case Tt:this._emitter.emit(t.msg);break;case xt:Object.setPrototypeOf(n,it.prototype),this._emitter.emit(t.msg,n);break;case Rt:case Dt:case Ot:this._emitter.emit(t.msg,n);break;case St:case Et:this._emitter.emit(t.msg,n.type,n.info);break;case Mt:this._emitter.emit(t.msg,n);break;case"logcat_callback":Le.emitter.emit("log",n.type,n.logcat)}}}]),e}(),Ut="error",Ft="source_open",Nt="update_end",jt="buffer_full",zt=function(){function e(n){t(this,e),this.TAG="MSEController",this._config=n,this._emitter=new(Ee()),this._config.isLive&&null==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new bt}return s(e,[{key:"destroy",value:function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){if(this._mediaSource)throw new De("MediaSource has been attached to an HTMLMediaElement!");var t=this._mediaSource=new window.MediaSource;t.addEventListener("sourceopen",this.e.onSourceOpen),t.addEventListener("sourceended",this.e.onSourceEnded),t.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=e,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL}},{key:"detachMediaElement",value:function(){if(this._mediaSource){var e=this._mediaSource;for(var t in this._sourceBuffers){var n=this._pendingSegments[t];n.splice(0,n.length),this._pendingSegments[t]=null,this._pendingRemoveRanges[t]=null,this._lastInitSegments[t]=null;var i=this._sourceBuffers[t];if(i){if("closed"!==e.readyState){try{e.removeSourceBuffer(i)}catch(e){Le.e(this.TAG,e.message)}i.removeEventListener("error",this.e.onSourceBufferError),i.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[t]=null,this._sourceBuffers[t]=null}}if("open"===e.readyState)try{e.endOfStream()}catch(e){Le.e(this.TAG,e.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)}},{key:"appendInitSegment",value:function(e,t){if(!this._mediaSource||"open"!==this._mediaSource.readyState)return this._pendingSourceBufferInit.push(e),void this._pendingSegments[e.type].push(e);var n=e,i="".concat(n.container);n.codec&&n.codec.length>0&&(i+=";codecs=".concat(n.codec));var r=!1;if(Le.v(this.TAG,"Received Initialization Segment, mimeType: "+i),this._lastInitSegments[n.type]=n,i!==this._mimeTypes[n.type]){if(this._mimeTypes[n.type])Le.v(this.TAG,"Notice: ".concat(n.type," mimeType changed, origin: ").concat(this._mimeTypes[n.type],", target: ").concat(i));else{r=!0;try{var s=this._sourceBuffers[n.type]=this._mediaSource.addSourceBuffer(i);s.addEventListener("error",this.e.onSourceBufferError),s.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(e){return Le.e(this.TAG,e.message),void this._emitter.emit(Ut,{code:e.code,msg:e.message})}}this._mimeTypes[n.type]=i}t||this._pendingSegments[n.type].push(n),r||this._sourceBuffers[n.type]&&!this._sourceBuffers[n.type].updating&&this._doAppendSegments(),Ne.safari&&"audio/mpeg"===n.container&&n.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=n.mediaDuration/1e3,this._updateMediaSourceDuration())}},{key:"appendMediaSegment",value:function(e){var t=e;this._pendingSegments[t.type].push(t),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var n=this._sourceBuffers[t.type];!n||n.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()}},{key:"seek",value:function(e){for(var t in this._sourceBuffers)if(this._sourceBuffers[t]){var n=this._sourceBuffers[t];if("open"===this._mediaSource.readyState)try{n.abort()}catch(e){Le.e(this.TAG,e.message)}this._idrList.clear();var i=this._pendingSegments[t];if(i.splice(0,i.length),"closed"!==this._mediaSource.readyState){for(var r=0;r<n.buffered.length;r++){var s=n.buffered.start(r),a=n.buffered.end(r);this._pendingRemoveRanges[t].push({start:s,end:a})}if(n.updating||this._doRemoveRanges(),Ne.safari){var o=this._lastInitSegments[t];o&&(this._pendingSegments[t].push(o),n.updating||this._doAppendSegments())}}}}},{key:"endOfStream",value:function(){var e=this._mediaSource,t=this._sourceBuffers;e&&"open"===e.readyState?t.video&&t.video.updating||t.audio&&t.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,e.endOfStream()):e&&"closed"===e.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0)}},{key:"getNearestKeyframe",value:function(e){return this._idrList.getLastSyncPointBeforeDts(e)}},{key:"_needCleanupSourceBuffer",value:function(){if(!this._config.autoCleanupSourceBuffer)return!1;var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var n=this._sourceBuffers[t];if(n){var i=n.buffered;if(i.length>=1&&e-i.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1}},{key:"_doCleanupSourceBuffer",value:function(){var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var n=this._sourceBuffers[t];if(n){for(var i=n.buffered,r=!1,s=0;s<i.length;s++){var a=i.start(s),o=i.end(s);if(a<=e&&e<o+3){if(e-a>=this._config.autoCleanupMaxBackwardDuration){r=!0;var l=e-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[t].push({start:a,end:l})}}else o<e&&(r=!0,this._pendingRemoveRanges[t].push({start:a,end:o}))}r&&!n.updating&&this._doRemoveRanges()}}}},{key:"_updateMediaSourceDuration",value:function(){var e=this._sourceBuffers;if(0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState&&!(e.video&&e.video.updating||e.audio&&e.audio.updating)){var t=this._mediaSource.duration,n=this._pendingMediaDuration;n>0&&(isNaN(t)||n>t)&&(Le.v(this.TAG,"Update MediaSource duration from ".concat(t," to ").concat(n)),this._mediaSource.duration=n),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}}},{key:"_doRemoveRanges",value:function(){for(var e in this._pendingRemoveRanges)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating)for(var t=this._sourceBuffers[e],n=this._pendingRemoveRanges[e];n.length&&!t.updating;){var i=n.shift();t.remove(i.start,i.end)}}},{key:"_doAppendSegments",value:function(){var e=this._pendingSegments;for(var t in e)if(this._sourceBuffers[t]&&!this._sourceBuffers[t].updating&&e[t].length>0){var n=e[t].shift();if(n.timestampOffset){var i=this._sourceBuffers[t].timestampOffset,r=n.timestampOffset/1e3;Math.abs(i-r)>.1&&(Le.v(this.TAG,"Update MPEG audio timestampOffset from ".concat(i," to ").concat(r)),this._sourceBuffers[t].timestampOffset=r),delete n.timestampOffset}if(!n.data||0===n.data.byteLength)continue;try{this._sourceBuffers[t].appendBuffer(n.data),this._isBufferFull=!1,"video"===t&&n.hasOwnProperty("info")&&this._idrList.appendArray(n.info.syncPoints)}catch(e){this._pendingSegments[t].unshift(n),22===e.code?(this._isBufferFull||this._emitter.emit(jt),this._isBufferFull=!0):(Le.e(this.TAG,e.message),this._emitter.emit(Ut,{code:e.code,msg:e.message}))}}}},{key:"_onSourceOpen",value:function(){if(Le.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var e=this._pendingSourceBufferInit;e.length;){var t=e.shift();this.appendInitSegment(t,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(Ft)}},{key:"_onSourceEnded",value:function(){Le.v(this.TAG,"MediaSource onSourceEnded")}},{key:"_onSourceClose",value:function(){Le.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))}},{key:"_hasPendingSegments",value:function(){var e=this._pendingSegments;return e.video.length>0||e.audio.length>0}},{key:"_hasPendingRemoveRanges",value:function(){var e=this._pendingRemoveRanges;return e.video.length>0||e.audio.length>0}},{key:"_onSourceBufferUpdateEnd",value:function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(Nt)}},{key:"_onSourceBufferError",value:function(e){Le.e(this.TAG,"SourceBuffer Error: ".concat(e))}}]),e}();var $t={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},Vt={NETWORK_EXCEPTION:Be.EXCEPTION,NETWORK_STATUS_CODE_INVALID:Be.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:Be.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:Be.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:ht,MEDIA_FORMAT_UNSUPPORTED:dt,MEDIA_CODEC_UNSUPPORTED:ft};const Gt=function(){function e(n,i){if(t(this,e),this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(Ee()),this._config=Ze(),"object"===l(i)&&Object.assign(this._config,i),"flv"!==n.type.toLowerCase())throw new Oe("FlvPlayer requires an flv MediaDataSource input!");!0===n.isLive&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=n,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var r=Ne.chrome&&(Ne.version.major<50||50===Ne.version.major&&Ne.version.build<2661);this._alwaysSeekKeyframe=!!(r||Ne.msedge||Ne.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return s(e,[{key:"destroy",value:function(){null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){var n=this;e===et.MEDIA_INFO?null!=this._mediaInfo&&Promise.resolve().then((function(){n._emitter.emit(et.MEDIA_INFO,n.mediaInfo)})):e===et.STATISTICS_INFO&&null!=this._statisticsInfo&&Promise.resolve().then((function(){n._emitter.emit(et.STATISTICS_INFO,n.statisticsInfo)})),this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){var t=this;if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),e.addEventListener("seeking",this.e.onvSeeking),e.addEventListener("canplay",this.e.onvCanPlay),e.addEventListener("stalled",this.e.onvStalled),e.addEventListener("progress",this.e.onvProgress),this._msectl=new zt(this._config),this._msectl.on(Nt,this._onmseUpdateEnd.bind(this)),this._msectl.on(jt,this._onmseBufferFull.bind(this)),this._msectl.on(Ft,(function(){t._mseSourceOpened=!0,t._hasPendingLoad&&(t._hasPendingLoad=!1,t.load())})),this._msectl.on(Ut,(function(e){t._emitter.emit(et.ERROR,$t.MEDIA_ERROR,Vt.MEDIA_MSE_ERROR,e)})),this._msectl.attachMediaElement(e),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}}},{key:"detachMediaElement",value:function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)}},{key:"load",value:function(){var e=this;if(!this._mediaElement)throw new De("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new De("FlvPlayer.load() has been called, please call unload() first!");this._hasPendingLoad||(this._config.deferLoadAfterSourceOpen&&!1===this._mseSourceOpened?this._hasPendingLoad=!0:(this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new It(this._mediaDataSource,this._config),this._transmuxer.on(At,(function(t,n){e._msectl.appendInitSegment(n)})),this._transmuxer.on(Lt,(function(t,n){if(e._msectl.appendMediaSegment(n),e._config.lazyLoad&&!e._config.isLive){var i=e._mediaElement.currentTime;n.info.endDts>=1e3*(i+e._config.lazyLoadMaxDuration)&&null==e._progressChecker&&(Le.v(e.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),e._suspendTransmuxer())}})),this._transmuxer.on(Ct,(function(){e._msectl.endOfStream(),e._emitter.emit(et.LOADING_COMPLETE)})),this._transmuxer.on(Tt,(function(){e._emitter.emit(et.RECOVERED_EARLY_EOF)})),this._transmuxer.on(St,(function(t,n){e._emitter.emit(et.ERROR,$t.NETWORK_ERROR,t,n)})),this._transmuxer.on(Et,(function(t,n){e._emitter.emit(et.ERROR,$t.MEDIA_ERROR,t,{code:-1,msg:n})})),this._transmuxer.on(xt,(function(t){e._mediaInfo=t,e._emitter.emit(et.MEDIA_INFO,Object.assign({},t))})),this._transmuxer.on(Rt,(function(t){e._emitter.emit(et.METADATA_ARRIVED,t)})),this._transmuxer.on(Dt,(function(t){e._emitter.emit(et.SCRIPTDATA_ARRIVED,t)})),this._transmuxer.on(Ot,(function(t){e._statisticsInfo=e._fillStatisticsInfo(t),e._emitter.emit(et.STATISTICS_INFO,Object.assign({},e._statisticsInfo))})),this._transmuxer.on(Mt,(function(t){e._mediaElement&&!e._config.accurateSeek&&(e._requestSetTime=!0,e._mediaElement.currentTime=t/1e3)})),this._transmuxer.open()))}},{key:"unload",value:function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)}},{key:"play",value:function(){return this._mediaElement.play()}},{key:"pause",value:function(){this._mediaElement.pause()}},{key:"_fillStatisticsInfo",value:function(e){if(e.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,n=0,i=0;if(this._mediaElement.getVideoPlaybackQuality){var r=this._mediaElement.getVideoPlaybackQuality();n=r.totalVideoFrames,i=r.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(n=this._mediaElement.webkitDecodedFrameCount,i=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=n,e.droppedFrames=i),e}},{key:"_onmseUpdateEnd",value:function(){if(this._config.lazyLoad&&!this._config.isLive){for(var e=this._mediaElement.buffered,t=this._mediaElement.currentTime,n=0,i=0;i<e.length;i++){var r=e.start(i),s=e.end(i);if(r<=t&&t<s){n=s;break}}n>=t+this._config.lazyLoadMaxDuration&&null==this._progressChecker&&(Le.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}}},{key:"_onmseBufferFull",value:function(){Le.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),null==this._progressChecker&&this._suspendTransmuxer()}},{key:"_suspendTransmuxer",value:function(){this._transmuxer&&(this._transmuxer.pause(),null==this._progressChecker&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))}},{key:"_checkProgressAndResume",value:function(){for(var e=this._mediaElement.currentTime,t=this._mediaElement.buffered,n=!1,i=0;i<t.length;i++){var r=t.start(i),s=t.end(i);if(e>=r&&e<s){e>=s-this._config.lazyLoadRecoverDuration&&(n=!0);break}}n&&(window.clearInterval(this._progressChecker),this._progressChecker=null,n&&(Le.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))}},{key:"_isTimepointBuffered",value:function(e){for(var t=this._mediaElement.buffered,n=0;n<t.length;n++){var i=t.start(n),r=t.end(n);if(e>=i&&e<r)return!0}return!1}},{key:"_internalSeek",value:function(e){var t=this._isTimepointBuffered(e),n=!1,i=0;if(e<1&&this._mediaElement.buffered.length>0){var r=this._mediaElement.buffered.start(0);(r<1&&e<r||Ne.safari)&&(n=!0,i=Ne.safari?.1:r)}if(n)this._requestSetTime=!0,this._mediaElement.currentTime=i;else if(t){if(this._alwaysSeekKeyframe){var s=this._msectl.getNearestKeyframe(Math.floor(1e3*e));this._requestSetTime=!0,this._mediaElement.currentTime=null!=s?s.dts/1e3:e}else this._requestSetTime=!0,this._mediaElement.currentTime=e;null!=this._progressChecker&&this._checkProgressAndResume()}else null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e)}},{key:"_checkAndApplyUnbufferedSeekpoint",value:function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var e=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(e)||(null!=this._progressChecker&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},{key:"_checkAndResumeStuckPlayback",value:function(e){var t=this._mediaElement;if(e||!this._receivedCanPlay||t.readyState<2){var n=t.buffered;n.length>0&&t.currentTime<n.start(0)&&(Le.w(this.TAG,"Playback seems stuck at ".concat(t.currentTime,", seek to ").concat(n.start(0))),this._requestSetTime=!0,this._mediaElement.currentTime=n.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)}},{key:"_onvLoadedMetadata",value:function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)}},{key:"_onvSeeking",value:function(e){var t=this._mediaElement.currentTime,n=this._mediaElement.buffered;if(this._requestSetTime)this._requestSetTime=!1;else{if(t<1&&n.length>0){var i=n.start(0);if(i<1&&t<i||Ne.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=Ne.safari?.1:i)}if(this._isTimepointBuffered(t)){if(this._alwaysSeekKeyframe){var r=this._msectl.getNearestKeyframe(Math.floor(1e3*t));null!=r&&(this._requestSetTime=!0,this._mediaElement.currentTime=r.dts/1e3)}null!=this._progressChecker&&this._checkProgressAndResume()}else this._seekpointRecord={seekPoint:t,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}}},{key:"_onvCanPlay",value:function(e){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)}},{key:"_onvStalled",value:function(e){this._checkAndResumeStuckPlayback(!0)}},{key:"_onvProgress",value:function(e){this._checkAndResumeStuckPlayback()}},{key:"type",get:function(){return this._type}},{key:"buffered",get:function(){return this._mediaElement.buffered}},{key:"duration",get:function(){return this._mediaElement.duration}},{key:"volume",get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e}},{key:"muted",get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e}},{key:"currentTime",get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._internalSeek(e):this._pendingSeekTime=e}},{key:"mediaInfo",get:function(){return Object.assign({},this._mediaInfo)}},{key:"statisticsInfo",get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)}}]),e}(),Wt=function(){function e(n,i){if(t(this,e),this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(Ee()),this._config=Ze(),"object"===l(i)&&Object.assign(this._config,i),"flv"===n.type.toLowerCase())throw new Oe("NativePlayer does't support flv MediaDataSource input!");if(n.hasOwnProperty("segments"))throw new Oe("NativePlayer(".concat(n.type,") doesn't support multipart playback!"));this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=n,this._mediaElement=null}return s(e,[{key:"destroy",value:function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){var n=this;e===et.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){n._emitter.emit(et.MEDIA_INFO,n.mediaInfo)})):e===et.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){n._emitter.emit(et.STATISTICS_INFO,n.statisticsInfo)})),this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}}},{key:"detachMediaElement",value:function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"load",value:function(){if(!this._mediaElement)throw new De("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)}},{key:"unload",value:function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"play",value:function(){return this._mediaElement.play()}},{key:"pause",value:function(){this._mediaElement.pause()}},{key:"_onvLoadedMetadata",value:function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(et.MEDIA_INFO,this.mediaInfo)}},{key:"_reportStatisticsInfo",value:function(){this._emitter.emit(et.STATISTICS_INFO,this.statisticsInfo)}},{key:"type",get:function(){return this._type}},{key:"buffered",get:function(){return this._mediaElement.buffered}},{key:"duration",get:function(){return this._mediaElement.duration}},{key:"volume",get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e}},{key:"muted",get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e}},{key:"currentTime",get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._mediaElement.currentTime=e:this._pendingSeekTime=e}},{key:"mediaInfo",get:function(){var e={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(e.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(e.width=this._mediaElement.videoWidth,e.height=this._mediaElement.videoHeight)),e}},{key:"statisticsInfo",get:function(){var e={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,n=0,i=0;if(this._mediaElement.getVideoPlaybackQuality){var r=this._mediaElement.getVideoPlaybackQuality();n=r.totalVideoFrames,i=r.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(n=this._mediaElement.webkitDecodedFrameCount,i=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=n,e.droppedFrames=i),e}}]),e}();ke.install();var Ht={createPlayer:function(e,t){var n=e;if(null==n||"object"!==l(n))throw new Oe("MediaDataSource must be an javascript object!");if(!n.hasOwnProperty("type"))throw new Oe("MediaDataSource must has type field to indicate video file type!");switch(n.type){case"flv":return new Gt(n,t);default:return new Wt(n,t)}},isSupported:function(){return Qe.supportMSEH264Playback()},getFeatureList:function(){return Qe.getFeatureList()}};Ht.BaseLoader=Ie,Ht.LoaderStatus=Pe,Ht.LoaderErrors=Be,Ht.Events=et,Ht.ErrorTypes=$t,Ht.ErrorDetails=Vt,Ht.FlvPlayer=Gt,Ht.NativePlayer=Wt,Ht.LoggingControl=nt,Object.defineProperty(Ht,"version",{enumerable:!0,get:function(){return"__VERSION__"}});const qt=Ht;var Kt=function(){function e(n){var i=this;if(t(this,e),this.flv=n,this.playTimer=null,this.playInter=null,this.speedTimer=null,this.playing=!1,this.loading=!1,this.rtspurl=!1,this.checkTime=-1,this._ws=null,this._shutter=this.flv.options.url.indexOf("/id")>-1,this.command=null,this.autoRestTimer=null,this._muted=this.flv.options.muted,this._volume=this.flv.options.volume,this._hasAudio=this.flv.options.hasAudio,!this.flv.options.live&&((this.flv.options.url.indexOf("/play_back_rtspurl")>-1||this._shutter)&&(this.rtspurl=!0),this.currentTime=0,this.seekTime=0,this.offseTime=0,this.speed=this.flv.options.speed,!this._shutter)){var r=this.flv.options.url.slice(-39).split("/");this.startTime=ce()(r[0]),this.endTime=ce()(r[1])}this.record=new T(n,this),n.on("ready",(function(){console.log("ready")})),n.on("setHasAudio",(function(e){console.log("setHasAudio",e),i.hasAudio=e})),n.on("setvolume",(function(e){e>0&&(i.muted=!1),i.volume=e})),n.on("destroy",(function(){i.destroy()})),n.on("timeupdate",(function(e){!n.options.live&&e>=i.duration&&(n.options.loop?i.seeked(0):n.emit("ended"))})),n.on("ended",(function(){i.pause()})),n.on("seekedTo",(function(e){null!=e&&i.seeked(e)})),this.flv.options.autoPlay&&this.play()}return s(e,[{key:"flvPause",value:function(){this.flvPlayer&&(this.flvPlayer.pause(),this.flvPlayer.unload(),this.flvPlayer.detachMediaElement(),this.flvPlayer.destroy(),this.flvPlayer=null),this.flv.emit("pause"),this.playing=!1,this.flv.control.loading=!1,this.loading=!1}},{key:"flvPlay",value:function(e){var t=this;this.flv.control.loading=!0,this.loading=!0,this.createPlayer(e);try{clearTimeout(this.playTimer),this.playTimer=setTimeout((function(){t.flvPlayer.play().then((function(){t.flv.emit("play"),t.flv.control.loading=!1,t.loading=!1})).catch((function(){t.flv.control.loading=!1,t.loading=!1}))}),500)}catch(e){console.log(e)}}},{key:"destroy",value:function(){this.flvPlayer&&(this.flvPlayer.pause(),this.flvPlayer.unload(),this.flvPlayer.detachMediaElement(),this.flvPlayer.destroy(),this.flvPlayer=null,this.playing=!1),clearInterval(this.speedTimer),clearInterval(this.playInter)}},{key:"autoRestPlay",value:function(){console.log("autoRestPlay",this.flv.options.url),this.pause(),this.play()}},{key:"checkEnd",value:function(){this.currentTime>=.8*this.duration||this.duration<=30?this.flv.emit("ended"):this.seeked(this.currentTime)}},{key:"createPlayer",value:function(e){var t=this;this.flvPlayer=qt.createPlayer({type:"flv",isLive:this.flv.options.live,hasAudio:this._hasAudio,hasVideo:!0,url:this.flv.options.url},{lazyLoad:!1,autoCleanupSourceBuffer:!0,autoCleanupMaxBackwardDuration:10,autoCleanupMinBackwardDuration:5,decoder:this,ioCallback:function(n,i){console.log(n,i),"open"===n?(t._ws=i,e&&e(t._ws)):"ready"===n&&(0===i?t.flv.emit("ready"):(t.flv.options.live&&t.autoRestPlay(),t.flv.emit("error",i)))}}),this.flvPlayer.attachMediaElement(this.flv.player.$canvas),this.flvPlayer.load(),console.log("播放地址",this.flv.options.url),this.flv.options.live||(this.flvPlayer._mediaElement.ontimeupdate=function(){t.flvPlayer&&t.speed<4&&(t.currentTime=t.seekTime+(t.flvPlayer.currentTime-t.offseTime),t.flv.emit("timeupdate",t.currentTime))},this.flvPlayer._mediaElement.ondurationchange=function(){console.log("duration",t.flvPlayer.duration),t.flv.emit("updateDuration",t.flvPlayer.duration)},this.flvPlayer._mediaElement.onplaying=function(){console.log("onplaying"),t.playing=!0,t.setSpeedIntered||t.setSpeedInter()}),this.flvPlayer.muted=this._muted,this.flvPlayer.volume=this._volume,this.flvPlayer.on("loading_complete",(function(){t.playing&&(t.flv.options.live?t.autoRestPlay():t.checkEnd())})),this.flvPlayer.on("error",(function(e,n,i){console.log("flvPlayer error",e,n,i),t.flv.options.live?t.autoRestPlay():t.currentTime>=t.duration/2?t.flv.emit("ended"):t.autoRestPlay()}))}},{key:"checkIsPlay",value:function(){var e=this;this.flvPlayer&&this.flvPlayer.currentTime>0&&(this.checkTime===this.flvPlayer.currentTime&&(console.log("视频已经卡住了,重新加载播放器！"),this.checkTime=-1,this.flv.options.live?(this.flvPause(),this.flvPlay()):this.rtspurl||(this.flvPause(),this.updateCurrentTime(this.currentTime),this.flvPlay((function(t){t.send(JSON.stringify({SN:"1",Ack:"0",FC:"FC_WS_STREAM_CONTINUE",param:{}})),e.setSpeed(e.speed)})))),this.checkTime=this.flvPlayer.currentTime)}},{key:"updateCurrentTime",value:function(e){var t=this.startTime.add(e,"second").format("YYYY-MM-DDTHH:mm:ss"),n=this.endTime.format("YYYY-MM-DDTHH:mm:ss"),i=this.flv.options.url.slice(0,-40);this.flv.options.url="".concat(i,"/").concat(t,"/").concat(n),this.seekTime=e,this.offseTime=0}},{key:"play",value:function(){var e=this;this.loading||(this.flv.options.live?this.flvPlay((function(){e.playRealInter()})):(this.rtspurl||this.updateCurrentTime(this.currentTime),this.flvPlay((function(t){t.send(JSON.stringify({SN:"1",Ack:"0",FC:"FC_WS_STREAM_CONTINUE",param:{}})),e.setSpeed(e.speed),e.playBackInter()}))))}},{key:"playBackInter",value:function(){var e=this;clearInterval(this.playInter),this.playInter=setInterval((function(){e.checkIsPlay()}),5e3)}},{key:"playRealInter",value:function(){var e=this;clearInterval(this.playInter),this.playInter=setInterval((function(){e.checkIsPlay(),e.flvPlayer&&e.flvPlayer.buffered&&e.flvPlayer.buffered.length&&e.flvPlayer.buffered.end(0)-e.flvPlayer.currentTime>=10&&(e.flvPlayer.currentTime=e.flvPlayer.buffered.end(0))}),1e4)}},{key:"pause",value:function(){clearInterval(this.playInter),this.flvPause()}},{key:"flow",value:function(e){var t=this;return new Promise((function(n,i){t.flv.options.live?(t.flv.options.url=t.flv.options.url.slice(0,-1)+e,t.autoRestPlay(0),n(!0)):i("当前不是预览流，无法切换主子流！")})).catch((function(e){console.log(e)}))}},{key:"setTimes",value:function(e,t){var n=this;return console.log("setTimes",e,t),new Promise((function(i,r){if(n.flv.options.live)r("当前不是回放流，无法重设时间！");else{n.flvPause(),n.currentTime=0,n.seekTime=0;var s=n.flv.options.url.slice(0,-40);n.flv.options.url="".concat(s,"/").concat(e,"/").concat(t),n.flvPlay((function(e){e.send(JSON.stringify({SN:"1",Ack:"0",FC:"FC_WS_STREAM_CONTINUE",param:{}})),i(!0)}))}})).catch((function(e){}))}},{key:"setSpeed",value:function(e){"number"==typeof e&&(this.flv.options.live||(e<4&&this.speed>2&&(this.seekTime=this.currentTime,this.offseTime=this.flvPlayer.currentTime),this.speed=e,this._ws.send(JSON.stringify({SN:"4",Ack:"0",FC:"FC_WS_STREAM_FORWARD",param:{speed:e}})),this.flvPlayer._mediaElement.playbackRate=e,this.setSpeedInter()))}},{key:"setSpeedInter",value:function(){var e=this;clearInterval(this.speedTimer),this.playing?(this.setSpeedIntered=!0,this.speed>2&&(console.log("setSpeed start speedTimer"),this.speedTimer=setInterval((function(){e.currentTime+=1,e.flv.emit("timeupdate",e.currentTime)}),1e3/this.speed))):this.setSpeedIntered=!1}},{key:"seeked",value:function(e){var t=this;this.flv.options.live||(this.rtspurl?(this.seekTime=e,this.offseTime=0,this.pause(),this.flvPlay((function(){t._ws.send(JSON.stringify({SN:"1",Ack:"0",FC:"FC_WS_STREAM_CONTINUE",param:{}})),t.ws.send(JSON.stringify({SN:"3",Ack:"0",FC:"FC_WS_STREAM_SEEK",param:{time_pos:1e3*e}})),t.setSpeed(t.speed)}))):(this.updateCurrentTime(e),this.pause(),this.flvPlay((function(){t._ws.send(JSON.stringify({SN:"1",Ack:"0",FC:"FC_WS_STREAM_CONTINUE",param:{}})),t.setSpeed(t.speed)}))))}},{key:"downloadFile",value:function(e){var t=document.createElement("a"),n=this.base64ToBlob(e);document.createEvent("HTMLEvents").initEvent("click",!0,!0),t.download="".concat(ce()().format("YYYYMMDDHHmmss"),".jpg"),t.href=URL.createObjectURL(n),t.click(),t.remove()}},{key:"base64ToBlob",value:function(e){for(var t=e.split(";base64,"),n=t[0].split(":")[1],i=window.atob(t[1]),r=i.length,s=new Uint8Array(r),a=0;a<r;++a)s[a]=i.charCodeAt(a);return new Blob([s],{type:n})}},{key:"duration",get:function(){return this.flvPlayer.duration}},{key:"volume",get:function(){return this._volume},set:function(e){this._volume=e,this.flvPlayer&&(this.flvPlayer.volume=e)}},{key:"muted",get:function(){return this._muted},set:function(e){this._muted=e,this.flvPlayer&&(this.flvPlayer.muted=e)}},{key:"hasAudio",get:function(){return this._hasAudio},set:function(e){this._hasAudio=e,this.autoRestPlay()}}]),e}();function Yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Xt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yt(Object(n),!0).forEach((function(t){x(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Jt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}var Zt=0,Qt=function(n){D(a,n);var i,r=(i=a,function(){var e,t=P(i);if(Jt()){var n=P(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return M(this,e)});function a(e){var n;return t(this,a),(n=r.call(this)).options=I()(Xt(Xt({},a.options),e),a.scheme),"string"==typeof n.options.container&&(n.options.container=document.querySelector(n.options.container)),n.init(),n}return s(a,[{key:"init",value:function(){this.isDestroy=!1,this.autoSized=!this.options.filled,this.isMobile=u(),this.isWechat=c(),this.debug=new G(this),this.events=new W(this),this.player=new H(this),this.control=new le(this),C()?this.decoder=new be(this):(this.decoder=new Kt(this),this.options.width=this.player.width,this.options.height=this.player.height),S(this,this.player),S(this,this.control),Zt+=1,this.id=Zt,a.instances.push(this)}},{key:"destroy",value:function(){this.isDestroy=!0,this.emit("destroy"),a.instances.splice(a.instances.indexOf(this),1)}}],[{key:"options",get:function(){return{url:"",container:"",poster:"",debug:!0,live:!0,loop:!1,autoPlay:!0,hasAudio:!0,control:!0,muted:!1,cors:!0,volume:.7,width:400,height:300,duration:0,screenshot:!1,decoderURL:"./decoder.c",delay:1,speed:1,filled:!1,hasAudioIcon:!1,mitm:""}}},{key:"scheme",get:function(){return{url:"string|file",container:"string|htmldivelement",poster:"string",debug:"boolean",live:"boolean",loop:"boolean",autoPlay:"boolean",hasAudio:"boolean",control:"boolean",muted:"boolean",cors:"boolean",volume:"number",width:"number",height:"number",duration:"number",decoderURL:"string",screenshot:"boolean",delay:"number",speed:"number",filled:"boolean",hasAudioIcon:"boolean",mitm:"string"}}},{key:"isSupported",get:function(){return U}},{key:"utils",get:function(){return e}}]),a}(F);Object.defineProperty(Qt,"instances",{value:[]});const en=Qt;window.HYPlayer=en,window.Recorder=T})(),i})()}));